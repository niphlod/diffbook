<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]><html class="ie ie6 ie-lte9 ie-lte8 ie-lte7 no-js" lang="en-us"> <![endif]-->
<!--[if IE 7]><html class="ie ie7 ie-lte9 ie-lte8 ie-lte7 no-js" lang="en-us"> <![endif]-->
<!--[if IE 8]><html class="ie ie8 ie-lte9 ie-lte8 no-js" lang="en-us"> <![endif]-->
<!--[if IE 9]><html class="ie9 ie-lte9 no-js" lang="en-us"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js" lang="en-us"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <!-- www.phpied.com/conditional-comments-block-downloads/ -->
  <!-- Always force latest IE rendering engine
       (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <![endif]-->

  <title>Diffbook</title>

  <!-- http://dev.w3.org/html5/markup/meta.name.html -->
  <meta name="application-name" content="diffbook" />

  <!-- Speaking of Google, don't forget to set your site up:
       http://google.com/webmasters -->
  <meta name="google-site-verification" content="" />

  <!--  Mobile Viewport Fix
        j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag
        device-width: Occupy full width of the screen in its current orientation
        initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
        user-scalable = yes allows the user to zoom in -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="shortcut icon" href="static/images/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="static/images/favicon.png">

  <!-- All JavaScript at the bottom, except for Modernizr which enables
       HTML5 elements & feature detects -->
  <script src="static/js/modernizr.custom.js"></script>

  <!-- include stylesheets -->
  

  <script type="text/javascript"><!--
    // These variables are used by the web2py_ajax_init function in web2py_ajax.js (which is loaded below).
    var w2p_ajax_confirm_message = "Are you sure you want to delete this object?";
    var w2p_ajax_date_format = "%Y-%m-%d";
    var w2p_ajax_datetime_format = "%Y-%m-%d %H:%M:%S";
    //--></script>

<meta name="keywords" content="web2py, python, framework" />
<meta name="description" content="a cool new app" />
<meta name="generator" content="Web2py Web Framework" />
<meta name="author" content="Your Name &lt;you@example.com&gt;" />
<script src="static/js/jquery.js" type="text/javascript"></script><link href="static/css/calendar.css" rel="stylesheet" type="text/css" /><script src="static/js/calendar.js" type="text/javascript"></script><script src="static/js/web2py.js" type="text/javascript"></script><link href="static/css/web2py.css" rel="stylesheet" type="text/css" /><link href="static/css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" /><link href="static/css/web2py_bootstrap.css" rel="stylesheet" type="text/css" />


  

  <!-- uncomment here to load jquery-ui
       <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" type="text/css" media="all" />
       <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
       uncomment to load jquery-ui //-->
  <noscript><link href="static/css/web2py_bootstrap_nojs.css" rel="stylesheet" type="text/css" /></noscript>
  
  <style type="text/css">

      /* Sticky footer styles
      -------------------------------------------------- */

      html,
      body {
        height: 100%;
        /* The html and body elements cannot have any padding or margin. */
      }

      /* Wrapper for page content to push down footer */
      #wrap {
        min-height: 100%;
        height: auto !important;
        height: 100%;
        /* Negative indent footer by it's height */
        margin: 0 auto -60px;
      }

      /* Set the fixed height of the footer here */
      #push,
      #footer {
        height: 60px;
      }
      #footer {
        background-color: #f5f5f5;
      }

      /* Lastly, apply responsive CSS fixes as necessary */
      @media (max-width: 767px) {
        #footer {
          margin-left: -20px;
          margin-right: -20px;
          padding-left: 20px;
          padding-right: 20px;
        }
      }



      /* Custom page CSS
      -------------------------------------------------- */
      /* Not required for template or sticky footer method. */

      .container {
        width: auto;
        max-width: 680px;
      }
      .container .credit {
        margin: 20px 0;
      }

    </style>
</head>

<body>
  
  <body>


    <!-- Part 1: Wrap all page content here -->
    <div id="wrap">

      <!-- Begin page content -->
      <div class="container-fluid">
        <div class="page-header">
          	<h1>
              Diffbook
              <small>easy? diffbook</small>
            </h1>
        </div>
        
        


<div class="pagination">
  <ul>

      <li><a href="/diffbook/0.html">Chapter 0</a></li>

      <li><a href="/diffbook/1.html">Chapter 1</a></li>

      <li><a href="/diffbook/2.html">Chapter 2</a></li>

      <li><a href="/diffbook/3.html">Chapter 3</a></li>

      <li><a href="/diffbook/4.html">Chapter 4</a></li>

      <li><a href="/diffbook/5.html">Chapter 5</a></li>

      <li><a href="/diffbook/6.html">Chapter 6</a></li>

      <li><a href="/diffbook/7.html">Chapter 7</a></li>

      <li><a href="/diffbook/8.html">Chapter 8</a></li>

      <li><a href="/diffbook/9.html">Chapter 9</a></li>

      <li><a href="/diffbook/10.html">Chapter 10</a></li>

      <li><a href="/diffbook/11.html">Chapter 11</a></li>

      <li><a href="/diffbook/12.html">Chapter 12</a></li>

  </ul>
</div>

<div class="pagination">
  <ul>

      
      <li><a href="#com_c0fdfb8d03d1a68aa9d95c2e26257b742d910eb5">c0fdfb8</a></li>
      

      
      <li><a href="#com_3b9c5efc20fecd8865a697a763846df5d29b699d">3b9c5ef</a></li>
      

      
      <li><a href="#com_7b57169401fb6f08d5110c74b928a675b3696ce4">7b57169</a></li>
      

      
      <li><a href="#com_2bf934556ad3ba5b9f3111fc290d77d9a05da832">2bf9345</a></li>
      

      
      <li><a href="#com_55edada7925165852699bac1ab7119c11820c7b3">55edada</a></li>
      

      
      <li><a href="#com_c357939fa69ee446bd98fe8333e0a8cf31a0245a">c357939</a></li>
      

      
      <li><a href="#com_0636efe87d592a2cdbdde3222617646d73808203">0636efe</a></li>
      

      
      <li><a href="#com_ac1aa03a9873b8ac62b463fba9a0d4c81bef7cc4">ac1aa03</a></li>
      

      
      <li><a href="#com_b498c5c3b9092a1b7d0007315399d52d89448269">b498c5c</a></li>
      

      
      <li><a href="#com_fa574110b856cb493ae8ca7ea7458d352f05fccf">fa57411</a></li>
      

      
      <li><a href="#com_2649834845e8cb63b1275f3160f4d3affd77cb52">2649834</a></li>
      

      
      <li><a href="#com_1984ff40c73c6da17ff268090c8526e3375314b5">1984ff4</a></li>
      

      
      <li><a href="#com_813ebbccbc784173d2f634c41e32b45a231245c6">813ebbc</a></li>
      

      
      <li><a href="#com_058dd9281691238b9e64d56eb54500d832776e5e">058dd92</a></li>
      

      
      <li><a href="#com_25e3abec41038a0cc99606f0d583da8f2a51379d">25e3abe</a></li>
      

      
      <li><a href="#com_e5611a6dba6591818e1bf179fa07a78b48bfd8f0">e5611a6</a></li>
      

      
      <li><a href="#com_f9693576d1386245de5f75ce2b1d8cfc1bd8295d">f969357</a></li>
      

      
      <li><a href="#com_2f79eddadfd38544b418fdef58c4d79a15b3e58b">2f79edd</a></li>
      

      
      <li><a href="#com_b2593fc1ec6a75073993e7ebdef68133fd41495e">b2593fc</a></li>
      

      
      <li><a href="#com_8b28bd0fbec5d28a791572393467e5d593ce409a">8b28bd0</a></li>
      

      
      <li><a href="#com_11ea57f066366c70e4d3496e98227888aa145534">11ea57f</a></li>
      

      
      <li><a href="#com_2923b14b2707fe6e12ff6c83f85cc55d748d7df5">2923b14</a></li>
      

      
      <li><a href="#com_f715fbf519725513052183444e977da2d4a0fadd">f715fbf</a></li>
      

      
      <li><a href="#com_b8030dd3c795f05392f2074845f657dc60670702">b8030dd</a></li>
      

      
      <li><a href="#com_eeabc3206531300cbbff92d92b4420b3a98512a5">eeabc32</a></li>
      

      
      <li><a href="#com_67961abf844c1076bc877583cf42b9720d89eeed">67961ab</a></li>
      

      
      <li><a href="#com_c81e1ffcfdbc8a5cf0f6c48033b0582781d38f7f">c81e1ff</a></li>
      

      
      <li><a href="#com_e4e22c48906a0057c9a3854f837594e8c31d3539">e4e22c4</a></li>
      

      
      <li><a href="#com_5ebcc42a6693401b956821b9bcae4a94afa3f869">5ebcc42</a></li>
      

      
      <li><a href="#com_94a462df41e3ab93353a4762c01f3bb827637579">94a462d</a></li>
      

      
      <li><a href="#com_a5582c25e72bb1b9e7e61ec40bb11a1ad6ab30b3">a5582c2</a></li>
      

      
      <li><a href="#com_1970e6f5596a96358cbcba2202bc1fa69211a389">1970e6f</a></li>
      

      
      <li><a href="#com_de5bac8c4346c1a5dc33dea9e20875e087ab4727">de5bac8</a></li>
      

      
      <li><a href="#com_739a4c66c06a1aa5de5f4bd07b49e2f04ec30290">739a4c6</a></li>
      

      

      
      <li><a href="#com_9ca549ebbdf32a059b682fa3299049073a1ee27d">9ca549e</a></li>
      

      
      <li><a href="#com_bd59eba2e974f5812ef1a16eeb67c6e70f1be664">bd59eba</a></li>
      

      
      <li><a href="#com_b5ec2af9b064c76ede72c312a0520bda83fa6c97">b5ec2af</a></li>
      

      
      <li><a href="#com_d864cef3b68d807ffe8dbc10c26845734fefb97b">d864cef</a></li>
      

      
      <li><a href="#com_588bb98fc4707b9e90172a5490f44644e776f0a0">588bb98</a></li>
      

      
      <li><a href="#com_77e0846262922b8d1f776f23ca079114677b4048">77e0846</a></li>
      

      
      <li><a href="#com_c482e34c27660c375ad9174f7c87d3df40a6eb62">c482e34</a></li>
      

      
      <li><a href="#com_a6910f421c90f921dd54c06026a1ea1177a416aa">a6910f4</a></li>
      

      
      <li><a href="#com_097d699dc16179206ccb7e4aee863d6523cd471c">097d699</a></li>
      

      
      <li><a href="#com_49f38ab7ef56de1eb4ef48f68427ebf8a46b505d">49f38ab</a></li>
      

      
      <li><a href="#com_eaaa0e14bf17cdc4d0edd2ea9daa9af5f3484c09">eaaa0e1</a></li>
      

      
      <li><a href="#com_77c615188200e8a913f15370ef4b371c94908182">77c6151</a></li>
      

      
      <li><a href="#com_89985891355b955b825fd874d470a5e6f09e8d92">8998589</a></li>
      

      
      <li><a href="#com_94fc4e6bc3687fcf3cacb3a587bb3e0b2b71cfd0">94fc4e6</a></li>
      

      
      <li><a href="#com_82dc64e7baa231edd3896ca7a0d41393e426f123">82dc64e</a></li>
      

      
      <li><a href="#com_704f1913e25162dcf68e21710945bd58d04b0b85">704f191</a></li>
      

      
      <li><a href="#com_2ed9a599998afba93644ff8a38f44b3b5bb4468e">2ed9a59</a></li>
      

      
      <li><a href="#com_5c22fefb0f31fbe2f9627b98ae4f95140d42a7a3">5c22fef</a></li>
      

      
      <li><a href="#com_c0da1a23055a3368a1a4b20f5e90fcd6ef18f4f8">c0da1a2</a></li>
      

      
      <li><a href="#com_be8da74855713dabb0c2a0a05a7d67002ace209b">be8da74</a></li>
      

      
      <li><a href="#com_ac4003f4349f9ee22c67309ceeb48de5539b0308">ac4003f</a></li>
      

      
      <li><a href="#com_93539678ed5ee942c5bd09736516134b7abd95fd">9353967</a></li>
      

      

  </ul>
</div>




<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/c0fdfb8d03d1a68aa9d95c2e26257b742d910eb5">c0fdfb8</a><ul><li>Date : 2014-05-05</li><li>Correct spaces in SQLFORM() signature</li></ul></li></ul>
<div class="row-fluid" id="com_c0fdfb8d03d1a68aa9d95c2e26257b742d910eb5">
    <div class="span6"><div class="diff"><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class="insert">+SQLFORM(table, record=None,</div><div class="insert">+        deletable=False, linkto=None,</div><div class="insert">+        upload=None, fields=None, labels=None,</div><div class="insert">+        col3={}, submit_button=&#x27;Submit&#x27;,</div><div class="insert">+        delete_label=&#x27;Check to delete:&#x27;,</div><div class="insert">+        showid=True, readonly=False,</div><div class="insert">+        comments=True, keepopts=[],</div><div class="insert">+        ignore_rw=False, record_id=None,</div><div class="insert">+        formstyle=&#x27;table3cols&#x27;,</div><div class="insert">+        buttons=[&#x27;submit&#x27;], separator=&#x27;: &#x27;,</div><div class="">         **attributes)</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class="delete">-SQLFORM(table, record = None,</div><div class="delete">-        deletable = False, linkto = None,</div><div class="delete">-        upload = None, fields = None, labels = None,</div><div class="delete">-        col3 = {}, submit_button = &#x27;Submit&#x27;,</div><div class="delete">-        delete_label = &#x27;Check to delete:&#x27;,</div><div class="delete">-        showid = True, readonly = False,</div><div class="delete">-        comments = True, keepopts = [],</div><div class="delete">-        ignore_rw = False, record_id = None,</div><div class="delete">-        formstyle = &#x27;table3cols&#x27;,</div><div class="delete">-        buttons = [&#x27;submit&#x27;], separator = &#x27;: &#x27;,</div><div class="">         **attributes)</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/3b9c5efc20fecd8865a697a763846df5d29b699d">3b9c5ef</a><ul><li>Date : 2014-04-10</li><li>minimal documentation to udpate the formstyle parameter to SQLFORM</li></ul></li></ul>
<div class="row-fluid" id="com_3b9c5efc20fecd8865a697a763846df5d29b699d">
    <div class="span6"><div class="diff"><div class="insert">- ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization), &quot;bootstrap&quot; which uses the bootstrap form class &quot;form-horizontal&quot;. ``formstyle`` can also be a function <span class="highlight">which generates everything inside the FORM tag. You pass to your form constructor function two arguments, form and fields. Hints can be found in the source code file sqlhtml.py (loo</span>k<span class="highlight"> for functions named formstyle</span>_<span class="highlight"></span>) <span class="highlight"></span></div><div class=""> - ``buttons``:inxx ``buttons`` is a list of ``INPUT``s or ``TAG.button``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go. </div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> or a button which links to another page:</div><div class=""> ``</div><div class=""> buttons = [..., A(&quot;Go to another page&quot;,_class=&#x27;btn&#x27;,_href=URL(&quot;default&quot;,&quot;anotherpage&quot;))]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">- ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization), &quot;bootstrap&quot; which uses the bootstrap form class &quot;form-horizontal&quot;. ``formstyle`` can also be a function <span class="highlight">that ta</span>k<span class="highlight">es (record</span>_<span class="highlight">id, field_label, field_widget, field_comment</span>) <span class="highlight">as attributes and returns a TR() object.</span></div><div class=""> - ``buttons``:inxx ``buttons`` is a list of ``INPUT``s or ``TAG.button``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go. </div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> or a button which links to another page:</div><div class=""> ``</div><div class=""> buttons = [..., A(&quot;Go to another page&quot;,_class=&#x27;btn&#x27;,_href=URL(&quot;default&quot;,&quot;anotherpage&quot;))]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/7b57169401fb6f08d5110c74b928a675b3696ce4">7b57169</a><ul><li>Date : 2014-03-30</li><li>multiple can take a (min,max) tuple.</li></ul></li></ul>
<div class="row-fluid" id="com_7b57169401fb6f08d5110c74b928a675b3696ce4">
    <div class="span6"><div class="diff"><div class="insert">The latter can be used to apply any validator to the individual items in the list.<span class="highlight"> ``multiple=(1,1000)`` requires a selection of between 1 and 1000 items. This enforces selection of at least one choice. </span></div><div class=""> </div><div class=""> #### Text format validators</div><div class=""> </div><div class=""> ##### ``IS_ALPHANUMERIC``</div><div class=""> ``IS_ALPHANUMERIC``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains only characters in the ranges a-z, A-Z, or 0-9.</div><div class=""> ``</div><div class=""> requires = IS_ALPHANUMERIC(error_message=&#x27;must be alphanumeric!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_LOWER``</div><div class=""> ``IS_LOWER``:inxx</div><div class=""> </div><div class=""> This validator never returns an error. It just converts the value to lower case.</div><div class=""> ``</div><div class=""> requires = IS_LOWER()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_UPPER``</div><div class=""> IS_NOT_IN_DB(dbset, field, error_message=&#x27;value already in database or empty&#x27;, a</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> [[validate_IS_IN_DB]]</div><div class=""> ######Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class="insert">``multiple=<span class="highlight"></span>`` is also possible if the field type is a list. The default is False.<span class="highlight"> It can be set to True or to a tuple (min,max) to restrict the number of values selected. So ``multiple=(1,10)`` enforces at least one and at most ten selections.</span></div></div></div>
    <div class="span6"><div class="diff"><div class="delete">The latter can be used to apply any validator to the individual items in the list.<span class="highlight"></span></div><div class=""> </div><div class=""> #### Text format validators</div><div class=""> </div><div class=""> ##### ``IS_ALPHANUMERIC``</div><div class=""> ``IS_ALPHANUMERIC``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains only characters in the ranges a-z, A-Z, or 0-9.</div><div class=""> ``</div><div class=""> requires = IS_ALPHANUMERIC(error_message=&#x27;must be alphanumeric!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_LOWER``</div><div class=""> ``IS_LOWER``:inxx</div><div class=""> </div><div class=""> This validator never returns an error. It just converts the value to lower case.</div><div class=""> ``</div><div class=""> requires = IS_LOWER()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_UPPER``</div><div class=""> IS_NOT_IN_DB(dbset, field, error_message=&#x27;value already in database or empty&#x27;, a</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> [[validate_IS_IN_DB]]</div><div class=""> ######Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class="delete">``multiple=<span class="highlight">True</span>`` is also possible if the field type is a list. The default is False.<span class="highlight"></span></div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/2bf934556ad3ba5b9f3111fc290d77d9a05da832">2bf9345</a><ul><li>Date : 2014-03-30</li><li>some small improvements to IS_IN_DB</li></ul></li></ul>
<div class="row-fluid" id="com_2bf934556ad3ba5b9f3111fc290d77d9a05da832">
    <div class="span6"><div class="diff"><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class="insert"><span class="highlight">######</span>Synopsis:</div><div class=""> ``IS_NOT_IN_DB(db|set, &#x27;table.field&#x27;)``</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. </div><div class=""> </div><div class=""> A set can be used instead of ``db``.</div><div class=""> </div><div class=""> As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In</div><div class=""> </div><div class=""> A complete argument list for ``IS_NOT_IN_DB()`` is as follows:</div><div class=""> ``</div><div class=""> IS_NOT_IN_DB(dbset, field, error_message=&#x27;value already in database or empty&#x27;, allowed_override=[],</div><div class="">     ignore_common_filters=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class="insert">+[[validate_IS_IN_DB]]</div><div class="insert">+######Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class="insert">+``multiple=True`` is also possible if the field type is a list. The default is False.</div><div class="insert">+</div><div class="insert">+Other optional arguments are discussed below.</div><div class="insert">+</div><div class="insert">+######Example</div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class="insert">*or<span class="highlight"> using a Set</span>*</div><div class=""> db.person.name.requires = IS_IN_DB(db(db.person.id&gt;10), &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">It is enforced at the level of dog INSERT/UPDATE/DELETE forms. <span class="highlight">This example</span> requires that a ``dog.owner`` be a valid id in the field ``person.id`` in the database ``db``. Because of this validator, the ``dog.owner`` field is represented as a drop-down list. The third argument of the validator is a string that describes the elements in the drop-down list. In the example you want to see the person ``%(name)s`` instead of the person ``%(id)s``. ``%(...)s`` is replaced by the value of the field in brackets for each record.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class="delete"><span class="highlight"></span>Synopsis:</div><div class=""> ``IS_NOT_IN_DB(db|set, &#x27;table.field&#x27;)``</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. </div><div class=""> </div><div class=""> A set can be used instead of ``db``.</div><div class=""> </div><div class=""> As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In</div><div class=""> </div><div class=""> A complete argument list for ``IS_NOT_IN_DB()`` is as follows:</div><div class=""> ``</div><div class=""> IS_NOT_IN_DB(dbset, field, error_message=&#x27;value already in database or empty&#x27;, allowed_override=[],</div><div class="">     ignore_common_filters=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class="delete">-Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class="delete">*or<span class="highlight"></span>*</div><div class=""> db.person.name.requires = IS_IN_DB(db(db.person.id&gt;10), &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">It is enforced at the level of dog INSERT/UPDATE/DELETE forms. <span class="highlight">It</span> requires that a ``dog.owner`` be a valid id in the field ``person.id`` in the database ``db``. Because of this validator, the ``dog.owner`` field is represented as a drop-down list. The third argument of the validator is a string that describes the elements in the drop-down list. In the example you want to see the person ``%(name)s`` instead of the person ``%(id)s``. ``%(...)s`` is replaced by the value of the field in brackets for each record.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/55edada7925165852699bac1ab7119c11820c7b3">55edada</a><ul><li>Date : 2014-03-25</li><li>typo</li></ul></li></ul>
<div class="row-fluid" id="com_55edada7925165852699bac1ab7119c11820c7b3">
    <div class="span6"><div class="diff"><div class=""> [[checkbox_validation]]</div><div class=""> ###### Checkbox validation</div><div class=""> To force a filled-in form checkbox (such as an acceptance of terms and conditions), use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div><div class="insert">###### Dictionaries and tuples with I<span class="highlight">S</span>_IN_SET</div><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class=""> Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div></div></div>
    <div class="span6"><div class="diff"><div class=""> [[checkbox_validation]]</div><div class=""> ###### Checkbox validation</div><div class=""> To force a filled-in form checkbox (such as an acceptance of terms and conditions), use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div><div class="delete">###### Dictionaries and tuples with I<span class="highlight">N</span>_IN_SET</div><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class=""> Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/c357939fa69ee446bd98fe8333e0a8cf31a0245a">c357939</a><ul><li>Date : 2014-03-13</li><li>show_if</li></ul></li></ul>
<div class="row-fluid" id="com_c357939fa69ee446bd98fe8333e0a8cf31a0245a">
    <div class="span6"><div class="diff"><div class="insert">+#### Conditional fields</div><div class="insert">+</div><div class="insert">+There are times when you only want a field to show up if a condition is met. For example, consider </div><div class="insert">+the following model:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+db.define_table(&#x27;purchase&#x27;, Field(&#x27;have_coupon&#x27;,&#x27;boolean&#x27;),Field(&#x27;coupon_code&#x27;))</div><div class="insert">+``</div><div class="insert">+</div><div class="insert">+You want to display the field ``coupon_code`` if and only if the ``have_coupon`` field is checked.</div><div class="insert">+This can be done in JavaScript. web2py can help you by genering that JavaScript for you. You just need to declare that the field is conditional to an expression using the field ``show_if`` attribute:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+def index():</div><div class="insert">+    db.purchase.coupon_code.show_if = (db.purchase.have_coupon==True)</div><div class="insert">+    form = SQLFORM(db.purchase).process()</div><div class="insert">+    return dict(form = form)</div><div class="insert">+``</div><div class="insert">+</div><div class="insert">+The value of ``show_if`` is a query and uses the same DAL syntax that you use for database queries. The difference is that this query not sent to the database but it is converted to JavaScript and sent to the browser where it is executed when the user edits the form.</div><div class="insert">+</div><div class=""> #### Hidden fields</div></div></div>
    <div class="span6"><div class="diff"><div class=""> #### Hidden fields</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/0636efe87d592a2cdbdde3222617646d73808203">0636efe</a><ul><li>Date : 2014-03-03</li><li>Further clarify SQLFORM.grid(..., args=...)</li></ul></li></ul>
<div class="row-fluid" id="com_0636efe87d592a2cdbdde3222617646d73808203">
    <div class="span6"><div class="diff"><div class="insert">+the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the ``grid``. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the ``grid``. So, ``args=request.args[:1]`` tells the grid to preserve the first URL argument in any links that it generates, appending any grid-specific arguments after that first argument.</div><div class="insert">+</div><div class=""> #### SQLFORM.grid signature</div><div class=""> The complete signature for the grid is the following:</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the ``grid``. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the ``grid``.</div><div class="delete">-</div><div class=""> #### SQLFORM.grid signature</div><div class=""> The complete signature for the grid is the following:</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/ac1aa03a9873b8ac62b463fba9a0d4c81bef7cc4">ac1aa03</a><ul><li>Date : 2014-03-03</li><li>Clarify usage of SQLFORM.grid(..., args=...)</li></ul></li></ul>
<div class="row-fluid" id="com_ac1aa03a9873b8ac62b463fba9a0d4c81bef7cc4">
    <div class="span6"><div class="diff"><div class="insert">the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the <span class="highlight">``grid``</span>. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the <span class="highlight">``grid``.</span></div></div></div>
    <div class="span6"><div class="diff"><div class="delete">the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the <span class="highlight">object</span>. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the <span class="highlight">object.</span></div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/b498c5c3b9092a1b7d0007315399d52d89448269">b498c5c</a><ul><li>Date : 2014-02-26</li><li>Errata per github issue #165</li></ul></li></ul>
<div class="row-fluid" id="com_b498c5c3b9092a1b7d0007315399d52d89448269">
    <div class="span6"><div class="diff"><div class="insert">+or a button which links to another page:</div><div class="insert">+``</div><div class="insert">+buttons = [..., A(&quot;Go to another page&quot;,_class=&#x27;btn&#x27;,_href=URL(&quot;default&quot;,&quot;anotherpage&quot;))]</div><div class="insert">+``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is a special ``hidden`` attribute. When a dictionary is passed as ``hidden``, its items are translated into &quot;hidden&quot; INPUT fields (see the example for the ``FORM`` helper in Chapter 5).</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(...,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class=""> form.vars. The reason is security. Hidden fields can be tampered with.</div><div class="insert">So you have t<span class="highlight"></span>o explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### The ``process`` method</div><div class=""> SQLFORM uses the process method (as do forms).</div><div class=""> </div><div class=""> If you want to use keepvalues with an SQLFORM, you pass an argument to the process method:</div><div class=""> </div><div class=""> ``if form.process(keepvalues=True).accepted:``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> </div><div class=""> ``SQLFORM`` creates a new db record when the form is accepted. Assuming ``form=SQLFORM(db.test)``:code, then the id of the last-created record will be accessible in ``myform.vars.id``.</div><div class=""> </div><div class=""> ``delete record``:inxx</div><div class=""> If you pass a record as the optional second argument to the ``SQLFORM`` constructor, the form becomes an UPDATE form for that record. This means that when the form is submitted the existing record is updated and no new record is inserted. If you set the argument ``deletable=True``, the UPDATE form displays a &quot;check to delete&quot; checkbox. If checked, the record is deleted.</div><div class=""> </div><div class=""> As the grid passes through different states, such as editing a row, a new reques</div><div class=""> </div><div class=""> ### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid object will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid object we need to understand how it works. The object looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the object links the same function (``manage_users`` in the above case) but passes different ``request.args``. </div><div class=""> </div><div class=""> #### login required by default for data updates</div><div class="insert">By default all the URL<span class="highlight">s</span> generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> </div><div class=""> #### Multiple grids per controller function</div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class=""> #### Using requests.args safely</div><div class=""> Because the controller function that contains the grid may itself manipulate the URL arguments (known in web2py as response.args and response.vars), the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> onupdate and oncreate are the same callbacks available to SQLFORM.process()</div><div class=""> ui = dict(</div><div class="">     widget=&#x27;&#x27;,</div><div class="">     header=&#x27;&#x27;,</div><div class="">     content=&#x27;&#x27;,</div><div class="">     default=&#x27;&#x27;,</div><div class="">     cornerall=&#x27;&#x27;,</div><div class="">     cornertop=&#x27;&#x27;,</div><div class="">     cornerbottom=&#x27;&#x27;,</div><div class="">     button=&#x27;button&#x27;,</div><div class="">     buttontext=&#x27;buttontext button&#x27;,</div><div class="">     buttonadd=&#x27;icon plus&#x27;,</div><div class="">     buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">     buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">     buttondelete=&#x27;icon trash&#x27;,</div><div class="">     buttonedit=&#x27;icon pen&#x27;,</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class="insert">- ``showbuttontext`` allows<span class="highlight"></span> buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``, ``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> def manage():</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### smartgrid signature</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class="insert">+- There is an extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class="insert">+- There is an extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> ### grid and smartgrid access control</div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### smartgrid plurals</div><div class="insert">The ``smartgrid`` is the only object in web2py that displays the table name and it need<span class="highlight">s</span> both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the<span class="highlight">m</span> explicitly:</div></div></div>
    <div class="span6"><div class="diff"><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is a special ``hidden`` attribute. When a dictionary is passed as ``hidden``, its items are translated into &quot;hidden&quot; INPUT fields (see the example for the ``FORM`` helper in Chapter 5).</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(...,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class=""> form.vars. The reason is security. Hidden fields can be tampered with.</div><div class="delete">So you have t<span class="highlight">o d</span>o explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### The ``process`` method</div><div class=""> SQLFORM uses the process method (as do forms).</div><div class=""> </div><div class=""> If you want to use keepvalues with an SQLFORM, you pass an argument to the process method:</div><div class=""> </div><div class=""> ``if form.process(keepvalues=True).accepted:``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> </div><div class=""> ``SQLFORM`` creates a new db record when the form is accepted. Assuming ``form=SQLFORM(db.test)``:code, then the id of the last-created record will be accessible in ``myform.vars.id``.</div><div class=""> </div><div class=""> ``delete record``:inxx</div><div class=""> If you pass a record as the optional second argument to the ``SQLFORM`` constructor, the form becomes an UPDATE form for that record. This means that when the form is submitted the existing record is updated and no new record is inserted. If you set the argument ``deletable=True``, the UPDATE form displays a &quot;check to delete&quot; checkbox. If checked, the record is deleted.</div><div class=""> </div><div class=""> As the grid passes through different states, such as editing a row, a new reques</div><div class=""> </div><div class=""> ### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid object will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid object we need to understand how it works. The object looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the object links the same function (``manage_users`` in the above case) but passes different ``request.args``. </div><div class=""> </div><div class=""> #### login required by default for data updates</div><div class="delete">By default all the URL<span class="highlight"></span> generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> </div><div class=""> #### Multiple grids per controller function</div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class=""> #### Using requests.args safely</div><div class=""> Because the controller function that contains the grid may itself manipulate the URL arguments (known in web2py as response.args and response.vars), the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> onupdate and oncreate are the same callbacks available to SQLFORM.process()</div><div class=""> ui = dict(</div><div class="">     widget=&#x27;&#x27;,</div><div class="">     header=&#x27;&#x27;,</div><div class="">     content=&#x27;&#x27;,</div><div class="">     default=&#x27;&#x27;,</div><div class="">     cornerall=&#x27;&#x27;,</div><div class="">     cornertop=&#x27;&#x27;,</div><div class="">     cornerbottom=&#x27;&#x27;,</div><div class="">     button=&#x27;button&#x27;,</div><div class="">     buttontext=&#x27;buttontext button&#x27;,</div><div class="">     buttonadd=&#x27;icon plus&#x27;,</div><div class="">     buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">     buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">     buttondelete=&#x27;icon trash&#x27;,</div><div class="">     buttonedit=&#x27;icon pen&#x27;,</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class="delete">- ``showbuttontext`` allows<span class="highlight"> to have</span> buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``, ``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> def manage():</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### smartgrid signature</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class="delete">-- There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class="delete">-- There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> ### grid and smartgrid access control</div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### smartgrid plurals</div><div class="delete">The ``smartgrid`` is the only object in web2py that displays the table name and it need<span class="highlight"></span> both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the<span class="highlight"></span> explicitly:</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/fa574110b856cb493ae8ca7ea7458d352f05fccf">fa57411</a><ul><li>Date : 2014-02-21</li><li>SQLFORM formstyle can also be bootstrap</li></ul></li></ul>
<div class="row-fluid" id="com_fa574110b856cb493ae8ca7ea7458d352f05fccf">
    <div class="span6"><div class="diff"><div class="insert">- ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization)<span class="highlight">, &quot;bootstrap&quot; which uses the bootstrap form class &quot;form-horizontal&quot;</span>. ``formstyle`` can also be a function that takes (record_id, field_label, field_widget, field_comment) as attributes and returns a TR() object.</div><div class=""> - ``buttons``:inxx ``buttons`` is a list of ``INPUT``s or ``TAG.button``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go. </div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">- ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization)<span class="highlight"></span>. ``formstyle`` can also be a function that takes (record_id, field_label, field_widget, field_comment) as attributes and returns a TR() object.</div><div class=""> - ``buttons``:inxx ``buttons`` is a list of ``INPUT``s or ``TAG.button``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go. </div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/2649834845e8cb63b1275f3160f4d3affd77cb52">2649834</a><ul><li>Date : 2014-02-16</li><li>ch7 validators organised by category for easier discovery. Correction to IS_IN_SET when combined with numerical validators, thanks Horst. Ch 6 Noted that del record with shortcut [id] doesn't work with versioning.</li></ul></li></ul>
<div class="row-fluid" id="com_2649834845e8cb63b1275f3160f4d3affd77cb52">
    <div class="span6"><div class="diff"><div class=""> Validators are classes used to validate input fields (including forms generated from database tables).</div><div class="insert">+With the advanced forms derived from SQLFORM, validators create widgets such as drop-down menus and lookups from other tables.</div><div class=""> </div><div class=""> Here is an example of using a validator with a ``FORM``:</div><div class=""> ``</div><div class=""> INPUT(_name=&#x27;a&#x27;, requires=IS_INT_IN_RANGE(0, 10))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is an example of how to require a validator for a table field:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_EMPTY()</div><div class=""> ``:code</div><div class=""> </div><div class=""> Validators are always assigned using the ``requires`` attribute of a field. A field can have a single validator or multiple validators. Multiple validators are made part of a list:</div><div class=""> ``</div><div class=""> db.person.name.requires = [IS_NOT_EMPTY(),</div><div class="">                            IS_NOT_IN_DB(db, &#x27;person.name&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> Normally validators are called automatically by the function ``accepts`` and ``process`` of a ``FORM`` or other HTML helper object that contains a form. They are called in the order in which they are listed.</div><div class=""> </div><div class=""> IS_NOT_EMPTY(error_message=&#x27;cannot be empty&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``error_message`` allows you to override the default error message for any validator.</div><div class=""> </div><div class=""> Here is an example of a validator on a database table:</div><div class=""> ``</div><div class=""> db.person.name.requires = IS_NOT_EMPTY(error_message=&#x27;fill this!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> where we have used the translation operator ``T`` to allow for internationalization. Notice that default error messages are not translated.</div><div class=""> </div><div class=""> Mind that the only validators that can be used with ``list:`` type fields are:</div><div class=""> </div><div class=""> - ``IS_IN_DB(...,multiple=True)``</div><div class=""> - ``IS_IN_SET(...,multiple=True)``</div><div class=""> - ``IS_NOT_EMPTY()``</div><div class=""> - ``IS_LIST_OF(...)``</div><div class=""> </div><div class=""> The latter can be used to apply any validator to the individual items in the list.</div><div class=""> </div><div class="insert">#### <span class="highlight">Text format v</span>alidators</div><div class=""> </div><div class=""> ##### ``IS_ALPHANUMERIC``</div><div class=""> ``IS_ALPHANUMERIC``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains only characters in the ranges a-z, A-Z, or 0-9.</div><div class=""> ``</div><div class=""> requires = IS_ALPHANUMERIC(error_message=&#x27;must be alphanumeric!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+##### ``IS_LOWER``</div><div class="insert">+``IS_LOWER``:inxx</div><div class="insert">+</div><div class="insert">+This validator never returns an error. It just converts the value to lower case.</div><div class="insert">+``</div><div class="insert">+requires = IS_LOWER()</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+##### ``IS_UPPER``</div><div class="insert">+``IS_UPPER``:inxx</div><div class="insert">+</div><div class="insert">+This validator never returns an error. It converts the value to upper case.</div><div class="insert">+``</div><div class="insert">+requires = IS_UPPER()</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+</div><div class="insert">+##### ``IS_EMAIL``</div><div class="insert">+``IS_EMAIL``:inxx</div><div class="insert">+</div><div class="insert">+It checks that the field value looks like an email address. It does not try to send email to confirm.</div><div class="insert">+``</div><div class="insert">+requires = IS_EMAIL(error_message=&#x27;invalid email!&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+##### ``IS_MATCH``</div><div class="insert">+``IS_MATCH``:inxx</div><div class="insert">+</div><div class="insert">+This validator matches the value against a regular expression and returns an error if it does not match.</div><div class="insert">+Here is an example of usage to validate a US zip code:</div><div class="insert">+``</div><div class="insert">+requires = IS_MATCH(&#x27;^\d{5}(-\d{4})?$&#x27;,</div><div class="insert">+         error_message=&#x27;not a zip code&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Here is an example of usage to validate an IPv4 address (note: the IS_IPV4 validator is more appropriate for this purpose):</div><div class="insert">+``</div><div class="insert">+requires = IS_MATCH(&#x27;^\d{1,3}(\.\d{1,3}){3}$&#x27;,</div><div class="insert">+         error_message=&#x27;not an IP address&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Here is an example of usage to validate a US phone number:</div><div class="insert">+``</div><div class="insert">+requires = IS_MATCH(&#x27;^1?((-)\d{3}-?|\(\d{3}\))\d{3}-?\d{4}$&#x27;,</div><div class="insert">+         error_message=&#x27;not a phone number&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+For more information on Python regular expressions, refer to the official Python documentation.</div><div class="insert">+</div><div class="insert">+``IS_MATCH`` takes an optional argument ``strict`` which defaults to ``False``. When set to ``True`` it only matches the beginning of the string:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+&gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;)(&#x27;ba&#x27;)</div><div class="insert">+(&#x27;ba&#x27;, &lt;lazyT &#x27;invalid expression&#x27;&gt;) # no pass</div><div class="insert">+&gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;,strict=False)(&#x27;ab&#x27;)</div><div class="insert">+(&#x27;a&#x27;, None)                          # pass!</div><div class="insert">+``</div><div class="insert">+</div><div class="insert">+``IS_MATCH`` takes an other optional argument ``search`` which defaults to ``False``. When set to ``True``, it uses regex method ``search`` instead of method ``match`` to validate the string.</div><div class="insert">+</div><div class="insert">+``IS_MATCH(&#x27;...&#x27;, extract=True)`` filters and extract only the first matching</div><div class="insert">+substring rather than the original value.</div><div class="insert">+</div><div class="insert">+##### ``IS_LENGTH``</div><div class="insert">+``IS_LENGTH``:inxx</div><div class="insert">+</div><div class="insert">+Checks if length of field&#x27;s value fits between given boundaries. Works</div><div class="insert">+for both text and file inputs.</div><div class="insert">+</div><div class="insert">+Its arguments are:</div><div class="insert">+- maxsize: the maximum allowed length / size (has default = 255)</div><div class="insert">+- minsize: the minimum allowed length / size</div><div class="insert">+</div><div class="insert">+Examples:</div><div class="insert">+Check if text string is shorter than 33 characters:</div><div class="insert">+``</div><div class="insert">+INPUT(_type=&#x27;text&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(32))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Check if password string is longer than 5 characters:</div><div class="insert">+``</div><div class="insert">+INPUT(_type=&#x27;password&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(minsize=6))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Check if uploaded file has size between 1KB and 1MB:</div><div class="insert">+``</div><div class="insert">+INPUT(_type=&#x27;file&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(1048576, 1024))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+For all field types except for files, it checks the length of the value. In the case of files, the value is a ``cookie.FieldStorage``, so it validates the length of the data in the file, which is the behavior one might intuitively expect.</div><div class="insert">+</div><div class="insert">+##### ``IS_URL``</div><div class="insert">+``IS_URL``:inxx</div><div class="insert">+</div><div class="insert">+Rejects a URL string if any of the following is true:</div><div class="insert">+- The string is empty or None</div><div class="insert">+- The string uses characters that are not allowed in a URL</div><div class="insert">+- The string breaks any of the HTTP syntactic rules</div><div class="insert">+- The URL scheme specified (if one is specified) is not &#x27;http&#x27; or &#x27;https&#x27;</div><div class="insert">+- The top-level domain (if a host name is specified) does not exist</div><div class="insert">+</div><div class="insert">+(These rules are based on RFC 2616``RFC2616``:cite )</div><div class="insert">+</div><div class="insert">+This function only checks the URL&#x27;s syntax. It does not check that the URL points to a real document,</div><div class="insert">+for example, or that it otherwise makes semantic sense. This function does automatically prepend</div><div class="insert">+&#x27;http://&#x27; in front of a URL in the case of an abbreviated URL (e.g. &#x27;google.ca&#x27;).</div><div class="insert">+</div><div class="insert">+If the parameter mode=&#x27;generic&#x27; is used, then this function&#x27;s behavior changes. It then rejects a URL string if any of the following is true:</div><div class="insert">+- The string is empty or None</div><div class="insert">+- The string uses characters that are not allowed in a URL</div><div class="insert">+- The URL scheme specified (if one is specified) is not valid</div><div class="insert">+</div><div class="insert">+(These rules are based on RFC 2396``RFC2396``:cite )</div><div class="insert">+</div><div class="insert">+The list of allowed schemes is customizable with the allowed_schemes parameter. If you exclude None from</div><div class="insert">+the list, then abbreviated URLs (lacking a scheme such as &#x27;http&#x27;) will be rejected.</div><div class="insert">+</div><div class="insert">+The default prepended scheme is customizable with the prepend_scheme parameter. If you set prepend_scheme</div><div class="insert">+to None, then prepending will be disabled. URLs that require prepending to parse will still be accepted,</div><div class="insert">+but the return value will not be modified.</div><div class="insert">+</div><div class="insert">+IS_URL is compatible with the Internationalized Domain Name (IDN) standard specified in RFC 3490``RFC3490``:cite ). As a result, URLs can be regular strings or unicode strings.</div><div class="insert">+If the URL&#x27;s domain component (e.g. google.ca) contains non-US-ASCII letters, then the domain will</div><div class="insert">+be converted into Punycode (defined in RFC 3492``RFC3492``:cite ). IS_URL goes a</div><div class="insert">+bit beyond the standards, and allows non-US-ASCII characters to be present in the path</div><div class="insert">+and query components of the URL as well. These non-US-ASCII characters will be encoded.</div><div class="insert">+For example, space will be encoded as&#x27;%20&#x27;. The unicode character with hex code 0x4e86</div><div class="insert">+will become &#x27;%4e%86&#x27;.</div><div class="insert">+</div><div class="insert">+Examples:</div><div class="insert">+``</div><div class="insert">+requires = IS_URL())</div><div class="insert">+requires = IS_URL(mode=&#x27;generic&#x27;)</div><div class="insert">+requires = IS_URL(allowed_schemes=[&#x27;https&#x27;])</div><div class="insert">+requires = IS_URL(prepend_scheme=&#x27;https&#x27;)</div><div class="insert">+requires = IS_URL(mode=&#x27;generic&#x27;,</div><div class="insert">+                  allowed_schemes=[&#x27;ftps&#x27;, &#x27;https&#x27;],</div><div class="insert">+                  prepend_scheme=&#x27;https&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+##### ``IS_SLUG``</div><div class="insert">+``IS_SLUG``:inxx</div><div class="insert">+``</div><div class="insert">+requires = IS_SLUG(maxlen=80, check=False, error_message=&#x27;must be slug&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+If ``check`` is set to ``True`` it check whether the validated value is a slug (allowing only alphanumeric characters and non-repeated dashes).</div><div class="insert">+</div><div class="insert">+If ``check`` is set to ``False`` (default) it converts the input value to a slug.</div><div class="insert">+</div><div class="insert">+#### Date and time validators</div><div class="insert">+</div><div class="insert">+##### ``IS_TIME``</div><div class="insert">+``IS_TIME``:inxx</div><div class="insert">+</div><div class="insert">+This validator checks that a field value contains a valid time in the specified format.</div><div class="insert">+``</div><div class="insert">+requires = IS_TIME(error_message=&#x27;must be HH:MM:SS!&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> ##### ``IS_DATE``</div><div class=""> ``IS_DATE``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains a valid date in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</div><div class=""> ``</div><div class=""> requires = IS_DATE(format=T(&#x27;%Y-%m-%d&#x27;),</div><div class="">                    error_message=&#x27;must be YYYY-MM-DD!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class=""> ##### ``IS_DATETIME``</div><div class=""> ``IS_DATETIME``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains a valid datetime in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</div><div class=""> ``</div><div class=""> requires = IS_DATETIME(format=T(&#x27;%Y-%m-%d %H:%M:%S&#x27;),</div><div class="">                        error_message=&#x27;must be YYYY-MM-DD HH:MM:SS!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following symbols can be used for the format string (this shows the symbol and an example string):</div><div class=""> ``</div><div class=""> %Y  &#x27;1963&#x27;</div><div class=""> %y  &#x27;63&#x27;</div><div class=""> %d  &#x27;28&#x27;</div><div class=""> %m  &#x27;08&#x27;</div><div class=""> %b  &#x27;Aug&#x27;</div><div class=""> %b  &#x27;August&#x27;</div><div class=""> %H  &#x27;14&#x27;</div><div class=""> %I  &#x27;02&#x27;</div><div class=""> %p  &#x27;PM&#x27;</div><div class=""> %M  &#x27;30&#x27;</div><div class=""> %S  &#x27;59&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+##### ``IS_DATE_IN_RANGE``</div><div class="insert">+``IS_DATE_IN_RANGE``:inxx</div><div class="insert">+</div><div class="insert">+Works very much like the previous validator but allows to specify a range:</div><div class="insert">+``</div><div class="insert">+requires = IS_DATE_IN_RANGE(format=T(&#x27;%Y-%m-%d&#x27;),</div><div class="insert">+                   minimum=datetime.date(2008,1,1),</div><div class="insert">+                   maximum=datetime.date(2009,12,31),</div><div class="insert">+                   error_message=&#x27;must be YYYY-MM-DD!&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> ##### ``IS_DATETIME_IN_RANGE``</div><div class=""> ``IS_DATETIME_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Works very much like the previous validator but allows to specify a range:</div><div class=""> ``</div><div class=""> requires = IS_DATETIME_IN_RANGE(format=T(&#x27;%Y-%m-%d %H:%M:%S&#x27;),</div><div class="">                        minimum=datetime.datetime(2008,1,1,10,30),</div><div class="">                        maximum=datetime.datetime(2009,12,31,11,45),</div><div class="">                        error_message=&#x27;must be YYYY-MM-DD HH:MM::SS!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class="insert">+#### Range, set and equality validators</div><div class="insert">+</div><div class="insert">+##### ``IS_EQUAL_TO``</div><div class="insert">+``IS_EQUEL_TO``:inxx</div><div class=""> </div><div class="insert">+Checks whether the validated value is equal to a given value (which can be a variable):</div><div class=""> ``</div><div class="insert">+requires = IS_EQUAL_TO(request.vars.password,</div><div class="insert">+                       error_message=&#x27;passwords do not match&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+##### ``IS_NOT_EMPTY``</div><div class="insert">+``IS_NOT_EMPTY``:inxx</div><div class=""> </div><div class="insert">+This validator checks that the content of the field value is not an empty string.</div><div class="insert">+``</div><div class="insert">+requires = IS_NOT_EMPTY(error_message=&#x27;cannot be empty!&#x27;)</div><div class="insert">+``:code</div><div class=""> </div><div class="insert">+##### ``IS_NULL_OR``</div><div class="insert">+``IS_NULL_OR``:inxx</div><div class=""> </div><div class="insert">+Deprecated, an alias for ``IS_EMPTY_OR`` described below.</div><div class=""> </div><div class="insert">+##### ``IS_EMPTY_OR``</div><div class="insert">+``IS_EMPTY_OR``:inxx</div><div class=""> </div><div class="insert">+Sometimes you need to allow empty values on a field along with other requirements. For example a field may be a date but it can also be empty.</div><div class="insert">+The ``IS_EMPTY_OR`` validator allows this:</div><div class=""> ``</div><div class="insert">requires = IS_EM<span class="highlight">PTY_OR(IS_D</span>A<span class="highlight">TE</span>(<span class="highlight"></span>)<span class="highlight">)</span></div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ##### ``IS_EXPR``</div><div class=""> ``IS_EXPR``:inxx</div><div class=""> </div><div class=""> Its first argument is a string containing a logical expression in terms of a variable value. It validates a field value if the expression evaluates to ``True``. For example:</div><div class=""> ``</div><div class=""> requires = IS_EXPR(&#x27;int(value)%3==0&#x27;,</div><div class="">                    error_message=&#x27;not divisible by 3&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> One should first check that the value is an integer so that an exception will not occur.</div><div class=""> ``</div><div class=""> requires = [IS_INT_IN_RANGE(0, 100), IS_EXPR(&#x27;value%3==0&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+</div><div class="insert">+##### ``IS_DECIMAL_IN_RANGE``</div><div class="insert">+``IS_DECIMAL_IN_RANGE``:inxx</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+INPUT(_type=&#x27;text&#x27;, _name=&#x27;name&#x27;, requires=IS_DECIMAL_IN_RANGE(0, 10, dot=&quot;.&quot;))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+It converts the input into a Python Decimal or generates an error if</div><div class="insert">+the decimal does not fall within the specified inclusive range.</div><div class="insert">+The comparison is made with Python Decimal arithmetic.</div><div class="insert">+</div><div class="insert">+The minimum and maximum limits can be None, meaning no lower or upper limit,</div><div class="insert">+respectively.</div><div class="insert">+</div><div class="insert">+The ``dot`` argument is optional and allows you to internationalize the symbol used to separate the decimals.</div><div class="insert">+</div><div class=""> ##### ``IS_FLOAT_IN_RANGE``</div><div class=""> ``IS_FLOAT_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Checks that the field value is a floating point number within a definite range, ``0 &lt;= value &lt;= 100`` in the following example:</div><div class=""> ``</div><div class=""> requires = IS_FLOAT_IN_RANGE(0, 100, dot=&quot;.&quot;,</div><div class="">          error_message=&#x27;too small or too large!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``dot`` argument is optional and allows you to internationalize the symbol used to separate the decimals.</div><div class=""> </div><div class=""> ##### ``IS_INT_IN_RANGE``</div><div class=""> ``IS_INT_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Checks that the field value is an integer number within a definite range,</div><div class="">  ``0 &lt;= value &lt; 100`` in the following example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = IS_INT_IN_RANGE(0, 100,</div><div class="">          error_message=&#x27;too small or too large!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_SET``</div><div class=""> ``IS_IN_SET``:inxx</div><div class=""> ``multiple``:inxx</div><div class=""> </div><div class="insert">+In SQLFORM (and the grids) this validator will automatically set the form field to an option field (ie, with a drop-down menu).</div><div class="insert">+</div><div class="insert">+``IS_IN_SET`` checks that the field values are in a set:</div><div class=""> ``</div><div class=""> requires = IS_IN_SET([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;],zero=T(&#x27;choose one&#x27;),</div><div class="">          error_message=&#x27;must be a or b or c&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The zero argument is optional and it determines the text of the option selected by default, an option which is not accepted by the ``IS_IN_SET`` validator itself. If you do not want a &quot;choose one&quot; option, set ``zero=None``.</div><div class=""> </div><div class="insert">The elements of the set <span class="highlight">can be combined with an n</span>u<span class="highlight">merical validator, as long as IS_IN_SET is first in the list. Doing so wil force conversion b</span>y<span class="highlight"> the validtor to the n</span>u<span class="highlight">merical type. So, IS_IN_SET can be followe</span>d<span class="highlight"></span> by<span class="highlight"> </span> ``IS_INT_IN_RANGE`` (which converts the value to int) or  ``IS_FLOAT_IN_RANGE`` (which converts the value to float). For example:</div><div class=""> ``</div><div class="insert">requires = [<span class="highlight"></span> IS_IN_SET([2, 3, 5, 7],<span class="highlight">IS_INT_IN_RANGE(0, 8),</span></div><div class="">           error_message=&#x27;must be prime and less than 10&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+[[checkbox_validation]]</div><div class="insert">+###### Checkbox validation</div><div class=""> To force a filled-in form checkbox (such as an acceptance of terms and conditions), use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div><div class="insert"><span class="highlight">###### Dictionaries and tuples with IN_IN_SET</span></div><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class="insert"><span class="highlight"></span>Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div><div class="insert">+</div><div class="insert">+List of tuples example:</div><div class=""> requires = IS_IN_SET([(&#x27;A&#x27;,&#x27;Apple&#x27;),(&#x27;B&#x27;,&#x27;Banana&#x27;),(&#x27;C&#x27;,&#x27;Cherry&#x27;)])</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ##### ``IS_IN_SET`` and Tagging</div><div class=""> </div><div class=""> The ``IS_IN_SET`` validator has an optional attribute ``multiple=False``. If set to True, multiple values can be stored in one field. The field should be of type ``list:integer`` or ``list:string``. ``multiple`` references are handled automatically in create and update forms, but they are transparent to the DAL. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</div><div class=""> </div><div class=""> ------</div><div class=""> Note that when ``multiple=True``, ``IS_IN_SET`` will accept ``zero`` or more values, i.e. it will accept the field when nothing has been selected. ``multiple`` can also be a tuple of the form ``(a,b)`` where ``a`` and ``b`` are the minimum and (exclusive) maximum number of items that can be selected respectively.</div><div class=""> ------</div><div class=""> </div><div class=""> </div><div class="insert">+#### Complexity and security validators</div><div class="insert">+##### ``IS_STRONG``</div><div class="insert">+``IS_STRONG``:inxx</div><div class=""> </div><div class="insert"><span class="highlight">Enforces complex</span>i<span class="highlight">ty requireme</span>n<span class="highlight">ts on a field (usually a password field)</span></div><div class=""> </div><div class="insert"><span class="highlight">E</span>xample<span class="highlight"></span>:</div><div class=""> ``</div><div class="insert">requires = IS_<span class="highlight"></span>ST<span class="highlight">R</span>O<span class="highlight"></span>NG<span class="highlight"></span>(<span class="highlight">min=1</span>0, <span class="highlight">special=2, upper=2</span>)<span class="highlight"></span></div><div class=""> ``:code</div><div class=""> </div><div class="insert">+where</div><div class="insert">+- min is minimum length of the value</div><div class="insert">+- special is the minimum number of required special characters special characters are any of the following ``!@#$%^&amp;*(){}[]-+``</div><div class="insert">+- upper is the minimum number of upper case characters</div><div class=""> </div><div class="insert">+##### ``CRYPT``</div><div class="insert">+``CRYPT``:inxx</div><div class=""> </div><div class="insert">This <span class="highlight"></span>i<span class="highlight"></span>s a<span class="highlight">lso</span> <span class="highlight">a filt</span>e<span class="highlight"></span>r. It <span class="highlight">performs a sec</span>u<span class="highlight">re ha</span>s<span class="highlight">h</span> <span class="highlight"></span>on<span class="highlight"></span> the <span class="highlight">input </span>a<span class="highlight">nd it is </span>u<span class="highlight">s</span>e<span class="highlight">d</span> to <span class="highlight">prevent passwords from being passed in the c</span>l<span class="highlight"></span>e<span class="highlight">a</span>r <span class="highlight">to the datab</span>ase.</div><div class=""> ``</div><div class="insert">requires = <span class="highlight">C</span>R<span class="highlight">YPT</span>()</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">By default, CRYPT uses 1000 iterations of the pbkdf2 algorithm </span>co<span class="highlight">mbined with SHA512 to produce a 20-byte-long hash. Older versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</span></div><div class=""> </div><div class="insert"><span class="highlight">If a key is specified, CRYPT uses the HMAC algorithm. The key may </span>co<span class="highlight">ntain a prefix that </span>de<span class="highlight">termines the algorithm to use with HMAC, for example SHA512:</span></div><div class=""> </div><div class=""> ``</div><div class="insert"><span class="highlight">r</span>e<span class="highlight">qui</span>r<span class="highlight"></span>es<span class="highlight"> = CRYPT(k</span>e<span class="highlight">y</span>=&#x27;<span class="highlight">sha512:</span>t<span class="highlight"></span>h<span class="highlight">isisth</span>e<span class="highlight">k</span>e<span class="highlight">y</span>&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">Thi</span>s<span class="highlight"> is the recommended syntax. The key m</span>u<span class="highlight">st </span>b<span class="highlight">e a unique </span>string <span class="highlight">associ</span>at<span class="highlight"></span>e<span class="highlight">d</span> <span class="highlight">wi</span>th<span class="highlight"></span> the <span class="highlight">database used. The key can never be changed. If y</span>o<span class="highlight">u lose the key, the p</span>r<span class="highlight">ev</span>i<span class="highlight">ously h</span>a<span class="highlight">shed</span> value<span class="highlight">s become useless</span>.</div><div class=""> </div><div class="insert"><span class="highlight">By default, CRY</span>PT<span class="highlight"> uses random salt, such that each result is different. To use a constant salt value, specify its value</span>:<span class="highlight"></span></div><div class=""> </div><div class=""> ``</div><div class="insert">requires = <span class="highlight">CRY</span>PT<span class="highlight"></span>(<span class="highlight"></span>sa<span class="highlight">lt</span>=&#x27;<span class="highlight">mys</span>a<span class="highlight">l</span>t<span class="highlight">valu</span>e<span class="highlight"></span>&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">Or, to use no salt</span>:<span class="highlight"></span></div><div class=""> </div><div class=""> ``</div><div class="insert">requires = <span class="highlight">CRYP</span>T<span class="highlight"></span>(<span class="highlight"></span>sa<span class="highlight">lt=Fals</span>e<span class="highlight"></span>)</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">The CRYPT validator hashes its input, and this makes it some</span>w<span class="highlight">hat special. If you need to validate a password field</span> be<span class="highlight">fore it is hashed, you </span>c<span class="highlight">an use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last</span>.<span class="highlight"> For example:</span></div><div class=""> </div><div class=""> ``</div><div class="insert"><span class="highlight"></span>re<span class="highlight">quir</span>e<span class="highlight">s = [IS</span>_<span class="highlight">STRONG(),CRYPT(key=&#x27;</span>s<span class="highlight">ha512:thisist</span>he<span class="highlight">k</span>e<span class="highlight">y</span>&#x27;)<span class="highlight">]</span></div><div class=""> ``:code</div><div class=""> </div><div class="insert">``<span class="highlight">CRYPT`` also takes a ``min_length`` argument, whi</span>c<span class="highlight">h </span>de<span class="highlight">faults to zero.</span></div><div class=""> </div><div class="insert"><span class="highlight">The resulting hash takes the </span>f<span class="highlight">orm ``alg$salt$hash``, where ``alg`` is the hash algorithm used, ``salt`` is the salt string (whi</span>ch<span class="highlight"> </span>c<span class="highlight">an be empty), and ``hash`` is the algorithm&#x27;s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without invalidating previous hashes. The </span>k<span class="highlight">ey, howe</span>v<span class="highlight">er, must remain the same</span>.</div><div class=""> </div><div class=""> </div><div class="insert"><span class="highlight">#### </span>S<span class="highlight">pec</span>i<span class="highlight">al type validators</span></div><div class=""> </div><div class="insert">+##### ``IS_LIST_OF``</div><div class="insert">+``IS_LIST_OF``:inxx</div><div class=""> </div><div class="insert"><span class="highlight">This is not properly a validator. Its intended use is to allow validations of fields that return multiple values. It is used in those rare cases when a form contains multiple fields with the same name or a multiple selection bo</span>x<span class="highlight">. Its only argument is another validator, and all it does is to apply the other validator to each element of the list. For example, the following expression checks that every item in a list is an integer in the range 0-10</span>:</div><div class=""> ``</div><div class="insert">requires = IS_<span class="highlight">LI</span>ST<span class="highlight">_OF(IS_INT_IN_</span>R<span class="highlight">A</span>NG<span class="highlight">E</span>(<span class="highlight"></span>0, <span class="highlight">10</span>)<span class="highlight">)</span></div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">It</span> <span class="highlight">nev</span>er <span class="highlight">returns an error and does not conta</span>i<span class="highlight">n an error message. The inner validator control</span>s the <span class="highlight"></span>er<span class="highlight">ror</span> <span class="highlight">gen</span>er<span class="highlight"></span>a<span class="highlight"></span>t<span class="highlight">ion.</span></div><div class=""> </div><div class=""> ##### ``IS_IMAGE``</div><div class=""> ``IS_IMAGE``:inxx</div><div class=""> </div><div class=""> This validator checks if a file uploaded through the file input was saved in one of the selected image formats and has dimensions (width and height) within given limits.</div><div class=""> </div><div class=""> It does not check for maximum file size (use IS_LENGTH for that). It returns</div><div class=""> a validation failure if no data was uploaded. It supports the file formats BMP, GIF, JPEG, PNG, and it does not require the Python Imaging Library.</div><div class=""> </div><div class=""> Code parts taken from ref.``source1``:cite</div><div class=""> </div><div class=""> It takes the following arguments:</div><div class=""> - extensions: iterable containing allowed image file extensions in lowercase</div><div class=""> - maxsize: iterable containing maximum width and height of the image</div><div class=""> - minsize: iterable containing minimum width and height of the image</div><div class=""> </div><div class=""> Use (-1, -1) as minsize to bypass the image-size check.</div><div class=""> </div><div class=""> Here are some Examples:</div><div class=""> - Check if uploaded file is in any of supported image formats:</div><div class=""> Its arguments are:</div><div class=""> - ``maxip`` highest allowed address; same as above</div><div class=""> </div><div class=""> All three example values are equal, since addresses are converted to</div><div class=""> integers for inclusion check with following function:</div><div class=""> ``</div><div class=""> number = 16777216 * IP[0] + 65536 * IP[1] + 256 * IP[2] + IP[3]</div><div class=""> ``:code</div><div class=""> </div><div class=""> Examples:</div><div class=""> </div><div class=""> Check for valid IPv4 address:</div><div class=""> ``</div><div class=""> requires = IS_IPV4()</div><div class=""> ``:code</div><div class=""> </div><div class=""> Check for valid private network IPv4 address:</div><div class=""> ``</div><div class=""> requires = IS_IPV4(minip=&#x27;192.168.0.1&#x27;, maxip=&#x27;192.168.255.255&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">#### Other validators</span></div><div class=""> ##### ``CLEANUP``</div><div class=""> ``CLEANUP``:inxx</div><div class=""> </div><div class=""> This is a filter. It never fails. It just removes all characters whose decimal ASCII codes are not in the list [10, 13, 32-127].</div><div class=""> ``</div><div class=""> requires = CLEANUP()</div><div class=""> ``:code</div><div class=""> </div></div></div>
    <div class="span6"><div class="diff"><div class=""> Validators are classes used to validate input fields (including forms generated from database tables).</div><div class=""> </div><div class=""> Here is an example of using a validator with a ``FORM``:</div><div class=""> ``</div><div class=""> INPUT(_name=&#x27;a&#x27;, requires=IS_INT_IN_RANGE(0, 10))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is an example of how to require a validator for a table field:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_EMPTY()</div><div class=""> ``:code</div><div class=""> </div><div class=""> Validators are always assigned using the ``requires`` attribute of a field. A field can have a single validator or multiple validators. Multiple validators are made part of a list:</div><div class=""> ``</div><div class=""> db.person.name.requires = [IS_NOT_EMPTY(),</div><div class="">                            IS_NOT_IN_DB(db, &#x27;person.name&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> Normally validators are called automatically by the function ``accepts`` and ``process`` of a ``FORM`` or other HTML helper object that contains a form. They are called in the order in which they are listed.</div><div class=""> </div><div class=""> IS_NOT_EMPTY(error_message=&#x27;cannot be empty&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``error_message`` allows you to override the default error message for any validator.</div><div class=""> </div><div class=""> Here is an example of a validator on a database table:</div><div class=""> ``</div><div class=""> db.person.name.requires = IS_NOT_EMPTY(error_message=&#x27;fill this!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> where we have used the translation operator ``T`` to allow for internationalization. Notice that default error messages are not translated.</div><div class=""> </div><div class=""> Mind that the only validators that can be used with ``list:`` type fields are:</div><div class=""> </div><div class=""> - ``IS_IN_DB(...,multiple=True)``</div><div class=""> - ``IS_IN_SET(...,multiple=True)``</div><div class=""> - ``IS_NOT_EMPTY()``</div><div class=""> - ``IS_LIST_OF(...)``</div><div class=""> </div><div class=""> The latter can be used to apply any validator to the individual items in the list.</div><div class=""> </div><div class="delete">#### <span class="highlight">V</span>alidators</div><div class=""> </div><div class=""> ##### ``IS_ALPHANUMERIC``</div><div class=""> ``IS_ALPHANUMERIC``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains only characters in the ranges a-z, A-Z, or 0-9.</div><div class=""> ``</div><div class=""> requires = IS_ALPHANUMERIC(error_message=&#x27;must be alphanumeric!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_DATE``</div><div class=""> ``IS_DATE``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains a valid date in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</div><div class=""> ``</div><div class=""> requires = IS_DATE(format=T(&#x27;%Y-%m-%d&#x27;),</div><div class="">                    error_message=&#x27;must be YYYY-MM-DD!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class="delete">-##### ``IS_DATE_IN_RANGE``</div><div class="delete">-``IS_DATE_IN_RANGE``:inxx</div><div class="delete">-</div><div class="delete">-Works very much like the previous validator but allows to specify a range:</div><div class="delete">-``</div><div class="delete">-requires = IS_DATE_IN_RANGE(format=T(&#x27;%Y-%m-%d&#x27;),</div><div class="delete">-                   minimum=datetime.date(2008,1,1),</div><div class="delete">-                   maximum=datetime.date(2009,12,31),</div><div class="delete">-                   error_message=&#x27;must be YYYY-MM-DD!&#x27;)</div><div class="delete">-``:code</div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class=""> ##### ``IS_DATETIME``</div><div class=""> ``IS_DATETIME``:inxx</div><div class=""> </div><div class=""> This validator checks that a field value contains a valid datetime in the specified format. It is good practice to specify the format using the translation operator, in order to support different formats in different locales.</div><div class=""> ``</div><div class=""> requires = IS_DATETIME(format=T(&#x27;%Y-%m-%d %H:%M:%S&#x27;),</div><div class="">                        error_message=&#x27;must be YYYY-MM-DD HH:MM:SS!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The following symbols can be used for the format string (this shows the symbol and an example string):</div><div class=""> ``</div><div class=""> %Y  &#x27;1963&#x27;</div><div class=""> %y  &#x27;63&#x27;</div><div class=""> %d  &#x27;28&#x27;</div><div class=""> %m  &#x27;08&#x27;</div><div class=""> %b  &#x27;Aug&#x27;</div><div class=""> %b  &#x27;August&#x27;</div><div class=""> %H  &#x27;14&#x27;</div><div class=""> %I  &#x27;02&#x27;</div><div class=""> %p  &#x27;PM&#x27;</div><div class=""> %M  &#x27;30&#x27;</div><div class=""> %S  &#x27;59&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_DATETIME_IN_RANGE``</div><div class=""> ``IS_DATETIME_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Works very much like the previous validator but allows to specify a range:</div><div class=""> ``</div><div class=""> requires = IS_DATETIME_IN_RANGE(format=T(&#x27;%Y-%m-%d %H:%M:%S&#x27;),</div><div class="">                        minimum=datetime.datetime(2008,1,1,10,30),</div><div class="">                        maximum=datetime.datetime(2009,12,31,11,45),</div><div class="">                        error_message=&#x27;must be YYYY-MM-DD HH:MM::SS!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For the full description on % directives look under the IS_DATETIME validator.</div><div class=""> </div><div class="delete">-##### ``IS_DECIMAL_IN_RANGE``</div><div class="delete">-``IS_DECIMAL_IN_RANGE``:inxx</div><div class=""> </div><div class=""> ``</div><div class="delete">-INPUT(_type=&#x27;text&#x27;, _name=&#x27;name&#x27;, requires=IS_DECIMAL_IN_RANGE(0, 10, dot=&quot;.&quot;))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-It converts the input into a Python Decimal or generates an error if</div><div class="delete">-the decimal does not fall within the specified inclusive range.</div><div class="delete">-The comparison is made with Python Decimal arithmetic.</div><div class=""> </div><div class="delete">-The minimum and maximum limits can be None, meaning no lower or upper limit,</div><div class="delete">-respectively.</div><div class=""> </div><div class="delete">-The ``dot`` argument is optional and allows you to internationalize the symbol used to separate the decimals.</div><div class=""> </div><div class=""> </div><div class="delete">-##### ``IS_EMAIL``</div><div class="delete">-``IS_EMAIL``:inxx</div><div class=""> </div><div class="delete">-It checks that the field value looks like an email address. It does not try to send email to confirm.</div><div class=""> ``</div><div class="delete">requires = IS_EM<span class="highlight"></span>A<span class="highlight">IL</span>(<span class="highlight">error_message=&#x27;invalid email!&#x27;</span>)<span class="highlight"></span></div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_EQUAL_TO``</div><div class="delete">-``IS_EQUEL_TO``:inxx</div><div class="delete">-</div><div class="delete">-Checks whether the validated value is equal to a given value (which can be a variable):</div><div class="delete">-``</div><div class="delete">-requires = IS_EQUAL_TO(request.vars.password,</div><div class="delete">-                       error_message=&#x27;passwords do not match&#x27;)</div><div class="delete">-``:code</div><div class=""> </div><div class=""> ##### ``IS_EXPR``</div><div class=""> ``IS_EXPR``:inxx</div><div class=""> </div><div class=""> Its first argument is a string containing a logical expression in terms of a variable value. It validates a field value if the expression evaluates to ``True``. For example:</div><div class=""> ``</div><div class=""> requires = IS_EXPR(&#x27;int(value)%3==0&#x27;,</div><div class="">                    error_message=&#x27;not divisible by 3&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> One should first check that the value is an integer so that an exception will not occur.</div><div class=""> ``</div><div class=""> requires = [IS_INT_IN_RANGE(0, 100), IS_EXPR(&#x27;value%3==0&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_FLOAT_IN_RANGE``</div><div class=""> ``IS_FLOAT_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Checks that the field value is a floating point number within a definite range, ``0 &lt;= value &lt;= 100`` in the following example:</div><div class=""> ``</div><div class=""> requires = IS_FLOAT_IN_RANGE(0, 100, dot=&quot;.&quot;,</div><div class="">          error_message=&#x27;too small or too large!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``dot`` argument is optional and allows you to internationalize the symbol used to separate the decimals.</div><div class=""> </div><div class=""> ##### ``IS_INT_IN_RANGE``</div><div class=""> ``IS_INT_IN_RANGE``:inxx</div><div class=""> </div><div class=""> Checks that the field value is an integer number within a definite range,</div><div class="">  ``0 &lt;= value &lt; 100`` in the following example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = IS_INT_IN_RANGE(0, 100,</div><div class="">          error_message=&#x27;too small or too large!&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_SET``</div><div class=""> ``IS_IN_SET``:inxx</div><div class=""> ``multiple``:inxx</div><div class=""> </div><div class="delete">-Checks that the field values are in a set:</div><div class=""> ``</div><div class=""> requires = IS_IN_SET([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;],zero=T(&#x27;choose one&#x27;),</div><div class="">          error_message=&#x27;must be a or b or c&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The zero argument is optional and it determines the text of the option selected by default, an option which is not accepted by the ``IS_IN_SET`` validator itself. If you do not want a &quot;choose one&quot; option, set ``zero=None``.</div><div class=""> </div><div class="delete">-The ``zero`` option was introduced in revision (1.67.1). It did not break backward compatibility in the sense that it did not break applications but it did change their behavior since, before, there was no ``zero`` option.</div><div class="delete">-</div><div class="delete">The elements of the set <span class="highlight">m</span>u<span class="highlight">st alwa</span>y<span class="highlight">s be strings </span>u<span class="highlight">nless this vali</span>d<span class="highlight">ator is preceded</span> by<span class="highlight"></span> ``IS_INT_IN_RANGE`` (which converts the value to int) or  ``IS_FLOAT_IN_RANGE`` (which converts the value to float). For example:</div><div class=""> ``</div><div class="delete">requires = [<span class="highlight">IS_INT_IN_RANGE(0, 8),</span> IS_IN_SET([2, 3, 5, 7],<span class="highlight"></span></div><div class="">           error_message=&#x27;must be prime and less than 10&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> To force a filled-in form checkbox (such as an acceptance of terms and conditions), use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div><div class="delete"><span class="highlight"></span></div><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class="delete"><span class="highlight">#### </span>Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div><div class="delete">-#### List of tuples example:</div><div class=""> requires = IS_IN_SET([(&#x27;A&#x27;,&#x27;Apple&#x27;),(&#x27;B&#x27;,&#x27;Banana&#x27;),(&#x27;C&#x27;,&#x27;Cherry&#x27;)])</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ##### ``IS_IN_SET`` and Tagging</div><div class=""> </div><div class=""> The ``IS_IN_SET`` validator has an optional attribute ``multiple=False``. If set to True, multiple values can be stored in one field. The field should be of type ``list:integer`` or ``list:string``. ``multiple`` references are handled automatically in create and update forms, but they are transparent to the DAL. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</div><div class=""> </div><div class=""> ------</div><div class=""> Note that when ``multiple=True``, ``IS_IN_SET`` will accept ``zero`` or more values, i.e. it will accept the field when nothing has been selected. ``multiple`` can also be a tuple of the form ``(a,b)`` where ``a`` and ``b`` are the minimum and (exclusive) maximum number of items that can be selected respectively.</div><div class=""> ------</div><div class=""> </div><div class="delete">-##### ``IS_LENGTH``</div><div class="delete">-``IS_LENGTH``:inxx</div><div class="delete">-</div><div class="delete">-Checks if length of field&#x27;s value fits between given boundaries. Works</div><div class="delete">-for both text and file inputs.</div><div class="delete">-</div><div class="delete">-Its arguments are:</div><div class="delete">-- maxsize: the maximum allowed length / size (has default = 255)</div><div class="delete">-- minsize: the minimum allowed length / size</div><div class="delete">-</div><div class="delete">-Examples:</div><div class="delete">-Check if text string is shorter than 33 characters:</div><div class="delete">-``</div><div class="delete">-INPUT(_type=&#x27;text&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(32))</div><div class="delete">-``:code</div><div class=""> </div><div class="delete">-Check if password string is longer than 5 characters:</div><div class="delete">-``</div><div class="delete">-INPUT(_type=&#x27;password&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(minsize=6))</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-Check if uploaded file has size between 1KB and 1MB:</div><div class="delete">-``</div><div class="delete">-INPUT(_type=&#x27;file&#x27;, _name=&#x27;name&#x27;, requires=IS_LENGTH(1048576, 1024))</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-For all field types except for files, it checks the length of the value. In the case of files, the value is a ``cookie.FieldStorage``, so it validates the length of the data in the file, which is the behavior one might intuitively expect.</div><div class=""> </div><div class="delete">-##### ``IS_LIST_OF``</div><div class="delete"><span class="highlight">``IS_LIST_OF``:</span>i<span class="highlight"></span>n<span class="highlight">xx</span></div><div class=""> </div><div class="delete"><span class="highlight">This is not properly a validator. Its intended use is to allow validations of fields that return multiple values. It is used in those rare cases when a form contains multiple fields with the same name or a multiple selection box. Its only argument is another validator, and all it does is to apply the other validator to each element of the list. For e</span>xample<span class="highlight">, the following expression checks that every item in a list is an integer in the range 0-10</span>:</div><div class=""> ``</div><div class="delete">requires = IS_<span class="highlight">LI</span>ST<span class="highlight">_</span>O<span class="highlight">F(IS_INT_IN_RA</span>NG<span class="highlight">E</span>(<span class="highlight"></span>0, <span class="highlight">10</span>)<span class="highlight">)</span></div><div class=""> ``:code</div><div class=""> </div><div class="delete">-It never returns an error and does not contain an error message. The inner validator controls the error generation.</div><div class=""> </div><div class="delete">-##### ``IS_LOWER``</div><div class="delete">-``IS_LOWER``:inxx</div><div class=""> </div><div class="delete">This <span class="highlight">val</span>i<span class="highlight">dator never return</span>s a<span class="highlight">n</span> <span class="highlight"></span>e<span class="highlight">rro</span>r. It <span class="highlight">j</span>u<span class="highlight"></span>s<span class="highlight">t</span> <span class="highlight">c</span>on<span class="highlight">verts</span> the <span class="highlight">v</span>a<span class="highlight">l</span>u<span class="highlight"></span>e<span class="highlight"></span> to <span class="highlight"></span>l<span class="highlight">ow</span>e<span class="highlight"></span>r <span class="highlight">c</span>ase.</div><div class=""> ``</div><div class="delete">requires = <span class="highlight">IS_LOWE</span>R<span class="highlight"></span>()</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_MATCH``</div><div class="delete">-``IS_MATCH``:inxx</div><div class="delete">-</div><div class="delete">-This validator matches the value against a regular expression and returns an error if it does not match.</div><div class="delete">-Here is an example of usage to validate a US zip code:</div><div class="delete">-``</div><div class="delete">-requires = IS_MATCH(&#x27;^\d{5}(-\d{4})?$&#x27;,</div><div class="delete">-         error_message=&#x27;not a zip code&#x27;)</div><div class="delete"><span class="highlight">``:</span>co<span class="highlight">de</span></div><div class=""> </div><div class="delete">-Here is an example of usage to validate an IPv4 address (note: the IS_IPV4 validator is more appropriate for this purpose):</div><div class="delete">-``</div><div class="delete">-requires = IS_MATCH(&#x27;^\d{1,3}(\.\d{1,3}){3}$&#x27;,</div><div class="delete">-         error_message=&#x27;not an IP address&#x27;)</div><div class="delete"><span class="highlight">``:</span>co<span class="highlight"></span>de<span class="highlight"></span></div><div class=""> </div><div class="delete">-Here is an example of usage to validate a US phone number:</div><div class=""> ``</div><div class="delete">-requires = IS_MATCH(&#x27;^1?((-)\d{3}-?|\(\d{3}\))\d{3}-?\d{4}$&#x27;,</div><div class="delete"><span class="highlight">         </span>e<span class="highlight"></span>r<span class="highlight">ror_m</span>es<span class="highlight">sag</span>e<span class="highlight"></span>=&#x27;<span class="highlight">no</span>t<span class="highlight"> a p</span>h<span class="highlight">on</span>e<span class="highlight"> numb</span>e<span class="highlight">r</span>&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-For more information on Python regular expressions, refer to the official Python documentation.</div><div class="delete">-</div><div class="delete">-``IS_MATCH`` takes an optional argument ``strict`` which defaults to ``False``. When set to ``True`` it only matches the beginning of the string:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-&gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;)(&#x27;ba&#x27;)</div><div class="delete">-(&#x27;ba&#x27;, &lt;lazyT &#x27;invalid expression&#x27;&gt;) # no pass</div><div class="delete">-&gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;,strict=False)(&#x27;ab&#x27;)</div><div class="delete">-(&#x27;a&#x27;, None)                          # pass!</div><div class="delete">-``</div><div class="delete">-</div><div class="delete">-``IS_MATCH`` takes an other optional argument ``search`` which defaults to ``False``. When set to ``True``, it uses regex method ``search`` instead of method ``match`` to validate the string.</div><div class="delete">-</div><div class="delete">-``IS_MATCH(&#x27;...&#x27;, extract=True)`` filters and extract only the first matching</div><div class="delete"><span class="highlight"></span>s<span class="highlight"></span>u<span class="highlight"></span>b<span class="highlight"></span>string <span class="highlight">r</span>at<span class="highlight">h</span>e<span class="highlight">r</span> <span class="highlight"></span>th<span class="highlight">an</span> the <span class="highlight"></span>o<span class="highlight"></span>r<span class="highlight"></span>i<span class="highlight">gin</span>a<span class="highlight">l</span> value<span class="highlight"></span>.</div><div class=""> </div><div class="delete">-##### ``IS_NOT_EMPTY``</div><div class="delete"><span class="highlight">``IS_NOT_EM</span>PT<span class="highlight">Y``</span>:<span class="highlight">inxx</span></div><div class=""> </div><div class="delete">-This validator checks that the content of the field value is not an empty string.</div><div class=""> ``</div><div class="delete">requires = <span class="highlight">IS_NOT_EM</span>PT<span class="highlight">Y</span>(<span class="highlight">error_mes</span>sa<span class="highlight">ge</span>=&#x27;<span class="highlight">c</span>a<span class="highlight">nno</span>t<span class="highlight"> b</span>e<span class="highlight"> empty!</span>&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_TIME``</div><div class="delete"><span class="highlight">``IS_TIME``</span>:<span class="highlight">inxx</span></div><div class=""> </div><div class="delete">-This validator checks that a field value contains a valid time in the specified format.</div><div class=""> ``</div><div class="delete">requires = <span class="highlight">IS_</span>T<span class="highlight">IME</span>(<span class="highlight">error_mes</span>sa<span class="highlight">g</span>e<span class="highlight">=&#x27;must be HH:MM:SS!&#x27;</span>)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_URL``</div><div class="delete">-``IS_URL``:inxx</div><div class="delete">-</div><div class="delete">-Rejects a URL string if any of the following is true:</div><div class="delete">-- The string is empty or None</div><div class="delete">-- The string uses characters that are not allowed in a URL</div><div class="delete">-- The string breaks any of the HTTP syntactic rules</div><div class="delete">-- The URL scheme specified (if one is specified) is not &#x27;http&#x27; or &#x27;https&#x27;</div><div class="delete">-- The top-level domain (if a host name is specified) does not exist</div><div class="delete">-</div><div class="delete">-(These rules are based on RFC 2616``RFC2616``:cite )</div><div class="delete">-</div><div class="delete">-This function only checks the URL&#x27;s syntax. It does not check that the URL points to a real document,</div><div class="delete">-for example, or that it otherwise makes semantic sense. This function does automatically prepend</div><div class="delete">-&#x27;http://&#x27; in front of a URL in the case of an abbreviated URL (e.g. &#x27;google.ca&#x27;).</div><div class="delete">-</div><div class="delete">-If the parameter mode=&#x27;generic&#x27; is used, then this function&#x27;s behavior changes. It then rejects a URL string if any of the following is true:</div><div class="delete">-- The string is empty or None</div><div class="delete">-- The string uses characters that are not allowed in a URL</div><div class="delete">-- The URL scheme specified (if one is specified) is not valid</div><div class="delete">-</div><div class="delete">-(These rules are based on RFC 2396``RFC2396``:cite )</div><div class="delete">-</div><div class="delete">-The list of allowed schemes is customizable with the allowed_schemes parameter. If you exclude None from</div><div class="delete">-the list, then abbreviated URLs (lacking a scheme such as &#x27;http&#x27;) will be rejected.</div><div class="delete">-</div><div class="delete">-The default prepended scheme is customizable with the prepend_scheme parameter. If you set prepend_scheme</div><div class="delete">-to None, then prepending will be disabled. URLs that require prepending to parse will still be accepted,</div><div class="delete">-but the return value will not be modified.</div><div class="delete">-</div><div class="delete">-IS_URL is compatible with the Internationalized Domain Name (IDN) standard specified in RFC 3490``RFC3490``:cite ). As a result, URLs can be regular strings or unicode strings.</div><div class="delete">-If the URL&#x27;s domain component (e.g. google.ca) contains non-US-ASCII letters, then the domain will</div><div class="delete">-be converted into Punycode (defined in RFC 3492``RFC3492``:cite ). IS_URL goes a</div><div class="delete">-bit beyond the standards, and allows non-US-ASCII characters to be present in the path</div><div class="delete">-and query components of the URL as well. These non-US-ASCII characters will be encoded.</div><div class="delete">-For example, space will be encoded as&#x27;%20&#x27;. The unicode character with hex code 0x4e86</div><div class="delete"><span class="highlight"></span>w<span class="highlight">ill</span> be<span class="highlight"></span>c<span class="highlight">ome &#x27;%4e%86&#x27;</span>.<span class="highlight"></span></div><div class=""> </div><div class="delete">-Examples:</div><div class=""> ``</div><div class="delete">-requires = IS_URL())</div><div class="delete">-requires = IS_URL(mode=&#x27;generic&#x27;)</div><div class="delete">-requires = IS_URL(allowed_schemes=[&#x27;https&#x27;])</div><div class="delete">-requires = IS_URL(prepend_scheme=&#x27;https&#x27;)</div><div class="delete">-requires = IS_URL(mode=&#x27;generic&#x27;,</div><div class="delete">-                  allowed_schemes=[&#x27;ftps&#x27;, &#x27;https&#x27;],</div><div class="delete"><span class="highlight">                  p</span>re<span class="highlight">p</span>e<span class="highlight">nd</span>_<span class="highlight"></span>s<span class="highlight">c</span>he<span class="highlight">m</span>e<span class="highlight">=&#x27;https</span>&#x27;)<span class="highlight"></span></div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_SLUG``</div><div class="delete">-``IS_SLUG``:inxx</div><div class="delete">-``</div><div class="delete">-requires = IS_SLUG(maxlen=80, check=False, error_message=&#x27;must be slug&#x27;)</div><div class="delete">``<span class="highlight">:</span>c<span class="highlight">o</span>de<span class="highlight"></span></div><div class=""> </div><div class="delete"><span class="highlight">I</span>f<span class="highlight"> ``</span>ch<span class="highlight">e</span>c<span class="highlight"></span>k<span class="highlight">`` is set to ``True`` it check whether the </span>v<span class="highlight">alidated value is a slug (allowing only alphanumeric characters and non-repeated dashes)</span>.</div><div class=""> </div><div class="delete">-If ``check`` is set to ``False`` (default) it converts the input value to a slug.</div><div class=""> </div><div class="delete">-##### ``IS_STRONG``</div><div class="delete"><span class="highlight">``I</span>S<span class="highlight">_STRONG``:</span>i<span class="highlight">nxx</span></div><div class=""> </div><div class="delete">-Enforces complexity requirements on a field (usually a password field)</div><div class=""> </div><div class="delete"><span class="highlight">E</span>x<span class="highlight">ample</span>:</div><div class=""> ``</div><div class="delete">requires = IS_<span class="highlight"></span>ST<span class="highlight"></span>R<span class="highlight">O</span>NG<span class="highlight"></span>(<span class="highlight">min=1</span>0, <span class="highlight">special=2, upper=2</span>)<span class="highlight"></span></div><div class=""> ``:code</div><div class=""> </div><div class="delete">-where</div><div class="delete">-- min is minimum length of the value</div><div class="delete">-- special is the minimum number of required special characters special characters are any of the following ``!@#$%^&amp;*(){}[]-+``</div><div class="delete"><span class="highlight">-</span> <span class="highlight">upp</span>er <span class="highlight"></span>i<span class="highlight"></span>s the <span class="highlight">minimum numb</span>er<span class="highlight"></span> <span class="highlight">of upp</span>er<span class="highlight"> c</span>a<span class="highlight">se charac</span>t<span class="highlight">ers</span></div><div class=""> </div><div class=""> ##### ``IS_IMAGE``</div><div class=""> ``IS_IMAGE``:inxx</div><div class=""> </div><div class=""> This validator checks if a file uploaded through the file input was saved in one of the selected image formats and has dimensions (width and height) within given limits.</div><div class=""> </div><div class=""> It does not check for maximum file size (use IS_LENGTH for that). It returns</div><div class=""> a validation failure if no data was uploaded. It supports the file formats BMP, GIF, JPEG, PNG, and it does not require the Python Imaging Library.</div><div class=""> </div><div class=""> Code parts taken from ref.``source1``:cite</div><div class=""> </div><div class=""> It takes the following arguments:</div><div class=""> - extensions: iterable containing allowed image file extensions in lowercase</div><div class=""> - maxsize: iterable containing maximum width and height of the image</div><div class=""> - minsize: iterable containing minimum width and height of the image</div><div class=""> </div><div class=""> Use (-1, -1) as minsize to bypass the image-size check.</div><div class=""> </div><div class=""> Here are some Examples:</div><div class=""> - Check if uploaded file is in any of supported image formats:</div><div class=""> Its arguments are:</div><div class=""> - ``maxip`` highest allowed address; same as above</div><div class=""> </div><div class=""> All three example values are equal, since addresses are converted to</div><div class=""> integers for inclusion check with following function:</div><div class=""> ``</div><div class=""> number = 16777216 * IP[0] + 65536 * IP[1] + 256 * IP[2] + IP[3]</div><div class=""> ``:code</div><div class=""> </div><div class=""> Examples:</div><div class=""> </div><div class=""> Check for valid IPv4 address:</div><div class=""> ``</div><div class=""> requires = IS_IPV4()</div><div class=""> ``:code</div><div class=""> </div><div class=""> Check for valid private network IPv4 address:</div><div class=""> ``</div><div class=""> requires = IS_IPV4(minip=&#x27;192.168.0.1&#x27;, maxip=&#x27;192.168.255.255&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``IS_UPPER``</div><div class="delete">-``IS_UPPER``:inxx</div><div class="delete">-</div><div class="delete">-This validator never returns an error. It converts the value to upper case.</div><div class="delete">-``</div><div class="delete">-requires = IS_UPPER()</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-##### ``IS_NULL_OR``</div><div class="delete">-``IS_NULL_OR``:inxx</div><div class="delete">-</div><div class="delete">-Deprecated, an alias for ``IS_EMPTY_OR`` described below.</div><div class="delete">-</div><div class="delete">-##### ``IS_EMPTY_OR``</div><div class="delete">-``IS_EMPTY_OR``:inxx</div><div class="delete">-</div><div class="delete">-Sometimes you need to allow empty values on a field along with other requirements. For example a field may be a date but it can also be empty.</div><div class="delete">-The ``IS_EMPTY_OR`` validator allows this:</div><div class="delete">-``</div><div class="delete">-requires = IS_EMPTY_OR(IS_DATE())</div><div class="delete">-``:code</div><div class="delete"><span class="highlight"></span></div><div class=""> ##### ``CLEANUP``</div><div class=""> ``CLEANUP``:inxx</div><div class=""> </div><div class=""> This is a filter. It never fails. It just removes all characters whose decimal ASCII codes are not in the list [10, 13, 32-127].</div><div class=""> ``</div><div class=""> requires = CLEANUP()</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-##### ``CRYPT``</div><div class="delete">-``CRYPT``:inxx</div><div class="delete">-</div><div class="delete">-This is also a filter. It performs a secure hash on the input and it is used to prevent passwords from being passed in the clear to the database.</div><div class="delete">-``</div><div class="delete">-requires = CRYPT()</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-By default, CRYPT uses 1000 iterations of the pbkdf2 algorithm combined with SHA512 to produce a 20-byte-long hash. Older versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class="delete">-</div><div class="delete">-If a key is specified, CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-This is the recommended syntax. The key must be a unique string associated with the database used. The key can never be changed. If you lose the key, the previously hashed values become useless.</div><div class="delete">-</div><div class="delete">-By default, CRYPT uses random salt, such that each result is different. To use a constant salt value, specify its value:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-requires = CRYPT(salt=&#x27;mysaltvalue&#x27;)</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-Or, to use no salt:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-requires = CRYPT(salt=False)</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class="delete">-``:code</div><div class="delete">-</div><div class="delete">-``CRYPT`` also takes a ``min_length`` argument, which defaults to zero.</div><div class="delete">-</div><div class="delete">-The resulting hash takes the form ``alg$salt$hash``, where ``alg`` is the hash algorithm used, ``salt`` is the salt string (which can be empty), and ``hash`` is the algorithm&#x27;s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without invalidating previous hashes. The key, however, must remain the same.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/1984ff40c73c6da17ff268090c8526e3375314b5">1984ff4</a><ul><li>Date : 2014-02-11</li><li>Some typos and some proposals chapter 06 - 14.</li></ul></li></ul>
<div class="row-fluid" id="com_1984ff40c73c6da17ff268090c8526e3375314b5">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="insert">form = SQLFORM(...<span class="highlight"></span>,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class=""> form.vars. The reason is security. Hidden fields can be tampered with.</div><div class=""> So you have to do explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### The ``process`` method</div><div class=""> SQLFORM uses the process method (as do forms).</div><div class=""> </div><div class=""> If you want to use keepvalues with an SQLFORM, you pass an argument to the process method:</div><div class=""> </div><div class=""> ``if form.process(keepvalues=True).accepted:``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> If a form is created with SQLFORM, SQLFORM.factory or CRUD, there are multiple w</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;source&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="">     return dict(form=SQLFORM(db.image).process())</div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class="insert">+Name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class="insert">+File: &lt;div&gt;{{=form.custom.widget.source}}&lt;/div&gt;</div><div class="insert">+{{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class=""> A similar result could have been obtained without using a custom form:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM(...,formstyle=&#x27;table2cols&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or in case of CRUD forms with the following parameter:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> ``:code</div><div class=""> Or, to use no salt:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(salt=False)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument, which defaults to zero.</div><div class=""> </div><div class=""> The resulting hash takes the form ``alg$salt$hash``, where ``alg`` is the hash algorithm used, ``salt`` is the salt string (which can be empty), and ``hash`` is the algorithm&#x27;s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without invalidating previous hashes. The key, however, must remain the same.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> Synopsis:</div><div class="insert">``IS_NOT_IN_DB(db|set,<span class="highlight"> </span>&#x27;table.field&#x27;)``</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. </div><div class=""> </div><div class="insert">A set can be used instead of <span class="highlight">``</span>db<span class="highlight">``</span>.</div><div class=""> </div><div class=""> As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In the latter case, you would be checking only the set defined by the Set.</div><div class=""> </div><div class="insert">+A complete argument list for ``IS_NOT_IN_DB()`` is as follows:</div><div class="insert">+``</div><div class="insert">+IS_NOT_IN_DB(dbset, field, error_message=&#x27;value already in database or empty&#x27;, allowed_override=[],</div><div class="insert">+    ignore_common_filters=True)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> ui = dict(</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class="insert">- ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,<span class="highlight"> </span>``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="delete">form = SQLFORM(...<span class="highlight">.</span>,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class=""> form.vars. The reason is security. Hidden fields can be tampered with.</div><div class=""> So you have to do explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### The ``process`` method</div><div class=""> SQLFORM uses the process method (as do forms).</div><div class=""> </div><div class=""> If you want to use keepvalues with an SQLFORM, you pass an argument to the process method:</div><div class=""> </div><div class=""> ``if form.process(keepvalues=True).accepted:``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> If a form is created with SQLFORM, SQLFORM.factory or CRUD, there are multiple w</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;source&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="">     return dict(form=SQLFORM(db.image).process())</div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class="delete">-Image name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class="delete">-Image file: &lt;div&gt;{{=form.custom.widget.source}}&lt;/div&gt;</div><div class="delete">-Click here to upload: {{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class=""> A similar result could have been obtained without using a custom form:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM(...,formstyle=&#x27;table2cols&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or in case of CRUD forms with the following parameter:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> ``:code</div><div class=""> Or, to use no salt:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(salt=False)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument, which defaults to zero.</div><div class=""> </div><div class=""> The resulting hash takes the form ``alg$salt$hash``, where ``alg`` is the hash algorithm used, ``salt`` is the salt string (which can be empty), and ``hash`` is the algorithm&#x27;s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without invalidating previous hashes. The key, however, must remain the same.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> Synopsis:</div><div class="delete">``IS_NOT_IN_DB(db|set,<span class="highlight"></span>&#x27;table.field&#x27;)``</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. </div><div class=""> </div><div class="delete">A set can be used instead of <span class="highlight"></span>db<span class="highlight"></span>.</div><div class=""> </div><div class=""> As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In the latter case, you would be checking only the set defined by the Set.</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> Synopsis:</div><div class=""> ``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class=""> where the third and fourth arguments are optional.</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> ui = dict(</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class="delete">- ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,<span class="highlight"></span>``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/813ebbccbc784173d2f634c41e32b45a231245c6">813ebbc</a><ul><li>Date : 2014-02-10</li><li>Correct number of space for the example function</li></ul></li></ul>
<div class="row-fluid" id="com_813ebbccbc784173d2f634c41e32b45a231245c6">
    <div class="span6"><div class="diff"><div class=""> Now, edit the previous controller and add a new action:</div><div class=""> ``</div><div class=""> def display_manual_form():</div><div class="insert">+    form = SQLFORM(db.person)</div><div class="insert">+    if form.process(session=None, formname=&#x27;test&#x27;).accepted:</div><div class="insert">+        response.flash = &#x27;form accepted&#x27;</div><div class="insert">+    elif form.errors:</div><div class="insert">+        response.flash = &#x27;form has errors&#x27;</div><div class="insert">+    else:</div><div class="insert">+        response.flash = &#x27;please fill the form&#x27;</div><div class="insert">+    # Note: no form instance is passed to the view</div><div class="insert">+    return dict()</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> Now, edit the previous controller and add a new action:</div><div class=""> ``</div><div class=""> def display_manual_form():</div><div class="delete">-   form = SQLFORM(db.person)</div><div class="delete">-   if form.process(session=None, formname=&#x27;test&#x27;).accepted:</div><div class="delete">-       response.flash = &#x27;form accepted&#x27;</div><div class="delete">-   elif form.errors:</div><div class="delete">-       response.flash = &#x27;form has errors&#x27;</div><div class="delete">-   else:</div><div class="delete">-       response.flash = &#x27;please fill the form&#x27;</div><div class="delete">-   # Note: no form instance is passed to the view</div><div class="delete">-   return dict()</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/058dd9281691238b9e64d56eb54500d832776e5e">058dd92</a><ul><li>Date : 2014-02-07</li><li>better TOC and links for ch 6 DAL</li></ul></li></ul>
<div class="row-fluid" id="com_058dd9281691238b9e64d56eb54500d832776e5e">
    <div class="span6"><div class="diff"><div class="insert">The Field object in the SQLFORM.factory() constructor is fully documented in the <span class="highlight">[[</span>DAL chapter<span class="highlight"> </span>.<span class="highlight">./06#field_constructor]].</span></div><div class=""> A run-time construction technique for SQLFORM.factory() is</div><div class=""> ``</div><div class=""> fields = []</div><div class=""> fields.append(Field(...))</div><div class=""> form=SQLFORM.factory(*fields)</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">The Field object in the SQLFORM.factory() constructor is fully documented in the <span class="highlight"></span>DAL chapter<span class="highlight"></span>.<span class="highlight"></span></div><div class=""> A run-time construction technique for SQLFORM.factory() is</div><div class=""> ``</div><div class=""> fields = []</div><div class=""> fields.append(Field(...))</div><div class=""> form=SQLFORM.factory(*fields)</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/25e3abec41038a0cc99606f0d583da8f2a51379d">25e3abe</a><ul><li>Date : 2014-02-02</li><li>fix issue reported to github: showbutton does not exist SQLFORM.grid <a href="https://github.com/mdipierro/web2py-book/issues/140">https://github.com/mdipierro/web2py-book/issues/140</a></li></ul></li></ul>
<div class="row-fluid" id="com_25e3abec41038a0cc99606f0d583da8f2a51379d">
    <div class="span6"><div class="diff"><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div></div></div>
    <div class="span6"><div class="diff"><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class="delete">-- ``showbutton`` allows to turn off all buttons.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/e5611a6dba6591818e1bf179fa07a78b48bfd8f0">e5611a6</a><ul><li>Date : 2014-01-25</li><li>increased clarity around database validators</li></ul></li></ul>
<div class="row-fluid" id="com_e5611a6dba6591818e1bf179fa07a78b48bfd8f0">
    <div class="span6"><div class="diff"><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class="insert">+Synopsis:</div><div class="insert">+``IS_NOT_IN_DB(db|set,&#x27;table.field&#x27;)``</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. </div><div class="insert">+</div><div class="insert">+A set can be used instead of db.</div><div class="insert">+</div><div class="insert">+As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In the latter case, you would be checking only the set defined by the Set.</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class="insert">+Synopsis:</div><div class="insert">+``IS_IN_DB(db|set,&#x27;table.value_field&#x27;,&#x27;%(representing_field)s&#x27;,zero=&#x27;choose one&#x27;)``</div><div class="insert">+where the third and fourth arguments are optional.</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class="insert">+*or*</div><div class="insert">+db.person.name.requires = IS_IN_DB(db(db.person.id&gt;10), &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> The first argument of ``IS_NOT_IN_DB`` can be a database connection or a Set. In the latter case, you would be checking only the set defined by the Set.</div><div class=""> </div><div class=""> The following code, for example, does not allow registration of two persons with the same name within 10 days of each other:</div><div class=""> ``</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/f9693576d1386245de5f75ce2b1d8cfc1bd8295d">f969357</a><ul><li>Date : 2013-12-13</li><li>Updated docs: sqlform.grid selectable can take a list for multiple actions</li></ul></li></ul>
<div class="row-fluid" id="com_f9693576d1386245de5f75ce2b1d8cfc1bd8295d">
    <div class="span6"><div class="diff"><div class=""> ``:code</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="insert">+   selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))``:code</div><div class="insert">+or for multiple action buttons, use a list of tuples: </div><div class="insert">+`` selectable = [(&#x27;button label1&#x27;,lambda...),(&#x27;button label2&#x27;,lambda ...)]</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input, ondelete takes the table and the record id</div><div class=""> Because the edit/create form is an SQLFORM which extends FORM, these callbacks are essentially used in the same way as documented in the sections for FORM and SQLFORM.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``:code</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="delete">-   selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input, ondelete takes the table and the record id</div><div class=""> Because the edit/create form is an SQLFORM which extends FORM, these callbacks are essentially used in the same way as documented in the sections for FORM and SQLFORM.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/2f79eddadfd38544b418fdef58c4d79a15b3e58b">2f79edd</a><ul><li>Date : 2013-10-11</li><li>spell check. Added more subheadings to SQLFORM.grid content to make contents better. Some rewording. Replace "dropbox" with "drop-down".</li></ul></li></ul>
<div class="row-fluid" id="com_2f79eddadfd38544b418fdef58c4d79a15b3e58b">
    <div class="span6"><div class="diff"><div class="insert">The ``onvalidation`` argument can be ``None`` or can be a function that takes the form and returns nothing. Such a function would be called and passed the form, immediately after validation (if validation passes) and before anything else happens. Th<span class="highlight">is function has multiple purposes: for example, to perform additional checks on the form and eventually add errors to the form, or to compute the values of some fields</span> b<span class="highlight">ased on the values of other fields</span>, <span class="highlight">or</span> to trigger some action (like sending an email) before a record is created/updated.</div><div class=""> </div><div class=""> Here is an example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;numbers&#x27;,</div><div class="">     Field(&#x27;a&#x27;, &#x27;integer&#x27;),</div><div class="">     Field(&#x27;b&#x27;, &#x27;integer&#x27;),</div><div class="">     Field(&#x27;c&#x27;, &#x27;integer&#x27;, readable=False, writable=False))</div><div class=""> </div><div class=""> def my_form_processing(form):</div><div class="">     c = form.vars.a * form.vars.b</div><div class="">     if c &lt; 0:</div><div class="">        form.errors.b = &#x27;a*b cannot be negative&#x27;</div><div class="">     else:</div><div class="">        form.vars.c = c</div><div class=""> </div><div class=""> def insert_numbers():</div><div class="">    form = SQLFORM(db.numbers)</div><div class="">    if form.process(onvalidation=my_form_processing).accepted:</div><div class="">        session.flash = &#x27;record inserted&#x27;</div><div class="">        redirect(URL())</div><div class=""> In the new controller, you do not need to build a ``FORM``, since the ``SQLFORM`</div><div class="">     &lt;/tr&gt;</div><div class="">     &lt;tr id=&quot;submit_record__row&quot;&gt;</div><div class="">        &lt;td&gt;&lt;/td&gt;</div><div class="">        &lt;td&gt;&lt;input value=&quot;Submit&quot; type=&quot;submit&quot; /&gt;&lt;/td&gt;</div><div class="">        &lt;td&gt;&lt;/td&gt;</div><div class="">     &lt;/tr&gt;</div><div class="">   &lt;/table&gt;</div><div class="">   &lt;input value=&quot;9038845529&quot; type=&quot;hidden&quot; name=&quot;_formkey&quot; /&gt;</div><div class="">   &lt;input value=&quot;person&quot; type=&quot;hidden&quot; name=&quot;_formname&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> ``:code</div><div class=""> </div><div class=""> The automatically generated form is more complex than the previous low-level form. First of all, it contains a table of rows, and each row has three columns. The first column contains the field labels (as determined from the ``db.person``), the second column contains the input fields (and eventually error messages), and the third column is optional and therefore empty (it can be populated with the fields in the ``SQLFORM`` constructor).</div><div class=""> </div><div class=""> All tags in the form have names derived from the table and field name. This allows easy customization of the form using CSS and JavaScript. This capability is discussed in more detail in Chapter 11.</div><div class=""> </div><div class=""> More important is that now the ``accepts`` method does a lot more work for you. As in the previous case, it performs validation of the input, but additionally, if the input passes validation, it also performs a database insert of the new record and stores in ``form.vars.id`` the unique &quot;id&quot; of the new record.</div><div class=""> </div><div class=""> A ``SQLFORM`` object also deals automatically with &quot;upload&quot; fields by saving uploaded files in the &quot;uploads&quot; folder (after having them renamed safely to avoid conflicts and prevent directory traversal attacks) and stores their names (their new names) into the appropriate field in the database. After the form has been processed, the new filename is available in ``form.vars.fieldname`` (i.e., it replaces the ``cgi.FieldStorage`` object in ``request.vars.fieldname``), so you can easily reference the new name right after upload.</div><div class=""> </div><div class="insert">A ``SQLFORM`` displays &quot;boolean&quot; values with checkboxes, &quot;text&quot; values with textareas, values required to be in a definite set or a database with drop-<span class="highlight">down</span>s, and &quot;upload&quot; fields with links that allow users to download the uploaded files. It hides &quot;blob&quot; fields, since they are supposed to be handled differently, as discussed later.</div><div class=""> </div><div class=""> For example, consider the following model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;married&#x27;, &#x27;boolean&#x27;),</div><div class="">     Field(&#x27;gender&#x27;, requires=IS_IN_SET([&#x27;Male&#x27;, &#x27;Female&#x27;, &#x27;Other&#x27;])),</div><div class="">     Field(&#x27;profile&#x27;, &#x27;text&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case, ``SQLFORM(db.person)`` generates the form shown below:</div><div class=""> </div><div class=""> [[image @///image/en6200.png center 300px]]</div><div class=""> </div><div class=""> The ``SQLFORM`` constructor allows various customizations, such as displaying only a subset of the fields, changing the labels, adding values to the optional third column, or creating UPDATE and DELETE forms, as opposed to INSERT forms like the current one.</div><div class=""> ``SQLFORM`` is the single biggest time-saver object in web2py.</div><div class=""> </div><div class=""> The class ``SQLFORM`` is defined in &quot;gluon/sqlhtml.py&quot;. It can be easily extended by overriding its ``xml`` method, the method that serializes the objects, to change its output.</div><div class=""> </div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is a special ``hidden`` attribute. When a dictionary is passed as ``hidden``, its items are translated into &quot;hidden&quot; INPUT fields (see the example for the ``FORM`` helper in Chapter 5).</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(....,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class="insert">form.vars. The reason is security. <span class="highlight">H</span>idden fields can be tampered with.</div><div class=""> So you have to do explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> </div><div class=""> ``SQLFORM`` creates a new db record when the form is accepted. Assuming ``form=SQLFORM(db.test)``:code, then the id of the last-created record will be accessible in ``myform.vars.id``.</div><div class=""> </div><div class=""> ``delete record``:inxx</div><div class=""> If you pass a record as the optional second argument to the ``SQLFORM`` constructor, the form becomes an UPDATE form for that record. This means that when the form is submitted the existing record is updated and no new record is inserted. If you set the argument ``deletable=True``, the UPDATE form displays a &quot;check to delete&quot; checkbox. If checked, the record is deleted.</div><div class=""> </div><div class=""> ------</div><div class=""> If a form is submitted and the delete checkbox is checked the attribute</div><div class=""> ``form.deleted`` is set to ``True``.</div><div class=""> ------</div><div class=""> </div><div class=""> You can modify the controller of the previous example so that when we pass an additional integer argument in the URL path, as in:</div><div class=""> Normally uploaded files are stored into &quot;app/uploads&quot; but you can specify an alt</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadfolder=&#x27;...&#x27;)</div><div class=""> ``</div><div class=""> In most operating system, accessing the file system can become slow when there are many files in the same folder. If you plan to upload more than 1000 files you can ask web2py to organize the uploads in subfolders:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadseparate=True)</div><div class=""> ``</div><div class=""> </div><div class=""> </div><div class=""> #### Storing the original filename</div><div class=""> </div><div class=""> web2py automatically stores the original filename inside the new UUID filename and retrieves it when the file is downloaded. Upon download, the original filename is stored in the content-disposition header of the HTTP response. This is all done transparently without the need for programming.</div><div class=""> </div><div class=""> Occasionally you may want to store the original filename in a database field. In this case, you need to modify the model and add a field to store it in:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;image_filename&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+Then you need to modify the controller to handle it:</div><div class="insert">+</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">     record = db.person(request.args(0)) or redirect(URL(&#x27;index&#x27;))</div><div class="">     url = URL(&#x27;download&#x27;)</div><div class="">     form = SQLFORM(db.person, record, deletable=True,</div><div class="">                    upload=url, fields=[&#x27;name&#x27;, &#x27;image&#x27;])</div><div class="">     if request.vars.image!=None:</div><div class="">         form.vars.image_filename = request.vars.image.filename</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice that the ``SQLFORM`` does not display the &quot;image_filename&quot; field.</div><div class=""> The &quot;display_form&quot; action moves the filename of the ``request.vars.image``</div><div class=""> into the ``form.vars.image_filename``, so that it gets processed by ``accepts`` and</div><div class=""> stored in the database. The download function, before serving the file, checks in the database for the original filename and uses it in the content-disposition header.</div><div class=""> </div><div class=""> form.process(detect_record_change=True)``</div><div class=""> </div><div class=""> and it is set in:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.detect_record_change = True</div><div class=""> ``:code</div><div class=""> and it can be changed/disabled by setting the variable to ``False``.</div><div class=""> </div><div class=""> You can change the form style by</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle = &#x27;table3cols&#x27; or &#x27;table2cols&#x27; or &#x27;divs&#x27; or &#x27;ul&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can set the separator in all crud forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.label_separator = &#x27;:&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+#### captcha</div><div class="insert">+</div><div class=""> You can add captcha to forms, using the same convention explained for auth, with:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_captcha = None</div><div class=""> crud.settings.update_captcha = None</div><div class=""> crud.settings.captcha = None</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> #### Messages</div><div class=""> </div><div class=""> Here is a list of customizable messages:</div><div class=""> ``</div><div class=""> crud.messages.submit_button = &#x27;Submit&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> sets the text of the &quot;submit&quot; button for both create and update forms.</div><div class=""> ``</div><div class=""> crud.messages.delete_label = &#x27;Check to delete:&#x27;</div><div class=""> ``:code</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">It is enforced at the level of dog INSERT/UPDATE/DELETE forms. It requires that a ``dog.owner`` be a valid id in the field ``person.id`` in the database ``db``. Because of this validator, the ``dog.owner`` field is represented as a drop<span class="highlight">-down list</span>. The third argument of the validator is a string that describes the elements in the drop<span class="highlight">-down list</span>. In the example you want to see the person ``%(name)s`` instead of the person ``%(id)s``. ``%(...)s`` is replaced by the value of the field in brackets for each record.</div><div class=""> </div><div class=""> The ``zero`` option works very much like for the ``IS_IN_SET`` validator.</div><div class=""> </div><div class="insert">The first argument of the validator can be a database connection or a DAL Set, as in ``IS_NOT_IN_DB``. This can be useful for example when wishing to limit the records in the drop-down <span class="highlight">list</span>. In this example, we use ``IS_IN_DB`` in a controller to limit the records dynamically each time the controller is called:</div><div class=""> </div><div class=""> ``</div><div class=""> def index():</div><div class="">     (...)</div><div class="">     query = (db.table.field == &#x27;xyz&#x27;) #in practice &#x27;xyz&#x27; would be a variable</div><div class="">     db.table.field.requires=IS_IN_DB(db(query),....)</div><div class="">     form=SQLFORM(...)</div><div class="">     if form.process().accepted: ...</div><div class="">     (...)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">If you want the field validated, but you do not want a drop<span class="highlight">-d</span>o<span class="highlight">wn</span>, you must put the validator in a list.</div><div class=""> </div><div class=""> ``</div><div class=""> db.dog.owner.requires = [IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``_and``:inxx</div><div class="insert">Occasionally you want the drop-<span class="highlight">down</span> (so you do not want to use the list syntax above) yet you want to use additional validators. For this purpose the ``IS_IN_DB`` validator takes an extra argument ``_and`` that can point to a list of other validators applied if the validated value passes the ``IS_IN_DB`` validation. For example to validate all dog owners in db that are not in a subset:</div><div class=""> ``</div><div class=""> subset=db(db.person.id&gt;100)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  _and=IS_NOT_IN_DB(subset,&#x27;person.id&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">``IS_IN_DB`` has a boolean ``distinct`` argument which defaults to ``False``. When set to ``True`` it prevents repeated values in the drop<span class="highlight">-</span>down.</div><div class=""> </div><div class=""> ``IS_IN_DB`` also takes a ``cache`` argument that works like the ``cache`` argument of select.</div><div class=""> </div><div class=""> </div><div class=""> ##### ``IS_IN_DB`` and Tagging</div><div class=""> ``tags``:inxx</div><div class=""> ``multiple``:inxx</div><div class=""> </div><div class=""> The ``IS_IN_DB`` validator has an optional attribute ``multiple=False``. If set to ``True`` multiple values can be stored in one field. This field should be of type ``list:reference`` as discussed in Chapter 6. An explicit example of tagging is discussed there. ``multiple`` references are handled automatically in create and update forms, but they are transparent to the DAL. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</div><div class=""> </div><div class=""> #### Custom validators</div><div class=""> ``custom validator``:inxx</div><div class=""> </div><div class=""> All validators follow the prototype below:</div><div class=""> ``</div><div class=""> class sample_validator:</div><div class="">     def __init__(self, *a, error_message=&#x27;error&#x27;):</div><div class="">         self.a = a</div><div class="">         self.e = error_message</div><div class="">     def __call__(self, value):</div><div class=""> The first case is easy:</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class="insert"><span class="highlight"></span>## ``SQLFORM.grid`` and ``SQLFORM.smartgrid``</div><div class=""> </div><div class=""> -------</div><div class=""> Attention: grid and smartgrid were experimental prior web2py version 2.0 and were vulnerable to information leakage. The grid and smartgrid are no longer experimental, but we are still not promising backward compatibility of the presentation layer of the grid, only of its APIs.</div><div class=""> -------</div><div class=""> </div><div class=""> These are two high level objects that create complex CRUD controls. They provide pagination, the ability to browse, search, sort, create, update and delete records from a single object.</div><div class=""> </div><div class=""> Because web2py&#x27;s HTML objects build on the underlying, simpler objects, the grids create SQLFORMs for viewing, editing and creating its rows. Many of the arguments to the grids are passed through to this SQLFORM. This means the documentation for SQLFORM (and FORM) is relevant. For example, the grid takes an ``onvalidation`` callback. The processing logic of the grid ultimately passes this through to the underlying process() method of FORM, which means you should consult the documentation of ``onvalidation`` for FORMs.</div><div class=""> </div><div class=""> As the grid passes through different states, such as editing a row, a new request is generated. request.args has information about which state the grid is in.</div><div class=""> </div><div class=""> </div><div class="insert"><span class="highlight"></span>### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid object will provide access to records matching the query.</div><div class=""> </div><div class="insert">+Before we dive into the long list of arguments of the grid object we need to understand how it works. The object looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the object links the same function (``manage_users`` in the above case) but passes different ``request.args``. </div><div class="insert">+</div><div class="insert">+#### login required by default for data updates</div><div class="insert">+By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class="insert">+</div><div class="insert">+#### Multiple grids per controller function</div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="insert">+#### Using requests.args safely</div><div class="insert">+Because the controller function that contains the grid may itself manipulate the URL arguments (known in web2py as response.args and response.vars), the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the object. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the object.</div><div class=""> </div><div class="insert">+#### SQLFORM.grid signature</div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(</div><div class="">     query,</div><div class="">     fields=None,</div><div class="">     field_id=None,</div><div class="">     left=None,</div><div class="">     headers={},</div><div class="">     orderby=None,</div><div class="">     groupby=None,</div><div class="">     searchable=True,</div><div class="">     sortable=True,</div><div class="">     paginate=20,</div><div class="">     deletable=True,</div><div class="">     editable=True,</div><div class="">     details=True,</div><div class="">     selectable=None,</div><div class="">     create=True,</div><div class="">     csv=True,</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class="insert"><span class="highlight"></span>#### <span class="highlight">V</span>irtual fields in SQLFORM.grid and smartgrid<span class="highlight"></span></div><div class=""> In versions of web2py after 2.6, virtual fields are shown in grids like normal fields: either shown alongside all other fields by default, or by including them in the ``fields`` argument. However, virtual fields are not sortable. </div><div class=""> </div><div class=""> In older web2py versions, showing virtual fields in a grid requires use of the ``links`` argument. This is still supported for more recent versions. If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, do this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field 1&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="insert">In all cases, because t1.vfield depends on t1.field1 and t1.field2, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable att<span class="highlight">r</span>ibute to False. </div><div class=""> </div><div class=""> Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class=""> So for the example above, the virtual field may be defined like:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="">    Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="">   Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="">   ...)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+### SQLFORM.smartgrid</div><div class="insert">+</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> Also notice that when clicking on the &quot;children&quot; link for a given parent one onl</div><div class=""> @auth.requires_login():</div><div class=""> def manage():</div><div class="">     db.child.parent.writable = False</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+#### smartgrid signature</div><div class="insert">+</div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">F</span>or a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class="insert"><span class="highlight">### grid and smartgrid access control</span></div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+### smartgrid plurals</div><div class=""> The ``smartgrid`` is the only object in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">The ``onvalidation`` argument can be ``None`` or can be a function that takes the form and returns nothing. Such a function would be called and passed the form, immediately after validation (if validation passes) and before anything else happens. Th<span class="highlight">e purpose of this function is multifold. It can</span> b<span class="highlight">e used</span>, <span class="highlight">for example, to perform additional checks on the form and eventually add errors to the form. It can also be used to compute the values of some fields based on the values of other fields. It can be used</span> to trigger some action (like sending an email) before a record is created/updated.</div><div class=""> </div><div class=""> Here is an example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;numbers&#x27;,</div><div class="">     Field(&#x27;a&#x27;, &#x27;integer&#x27;),</div><div class="">     Field(&#x27;b&#x27;, &#x27;integer&#x27;),</div><div class="">     Field(&#x27;c&#x27;, &#x27;integer&#x27;, readable=False, writable=False))</div><div class=""> </div><div class=""> def my_form_processing(form):</div><div class="">     c = form.vars.a * form.vars.b</div><div class="">     if c &lt; 0:</div><div class="">        form.errors.b = &#x27;a*b cannot be negative&#x27;</div><div class="">     else:</div><div class="">        form.vars.c = c</div><div class=""> </div><div class=""> def insert_numbers():</div><div class="">    form = SQLFORM(db.numbers)</div><div class="">    if form.process(onvalidation=my_form_processing).accepted:</div><div class="">        session.flash = &#x27;record inserted&#x27;</div><div class="">        redirect(URL())</div><div class=""> In the new controller, you do not need to build a ``FORM``, since the ``SQLFORM`</div><div class="">     &lt;/tr&gt;</div><div class="">     &lt;tr id=&quot;submit_record__row&quot;&gt;</div><div class="">        &lt;td&gt;&lt;/td&gt;</div><div class="">        &lt;td&gt;&lt;input value=&quot;Submit&quot; type=&quot;submit&quot; /&gt;&lt;/td&gt;</div><div class="">        &lt;td&gt;&lt;/td&gt;</div><div class="">     &lt;/tr&gt;</div><div class="">   &lt;/table&gt;</div><div class="">   &lt;input value=&quot;9038845529&quot; type=&quot;hidden&quot; name=&quot;_formkey&quot; /&gt;</div><div class="">   &lt;input value=&quot;person&quot; type=&quot;hidden&quot; name=&quot;_formname&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> ``:code</div><div class=""> </div><div class=""> The automatically generated form is more complex than the previous low-level form. First of all, it contains a table of rows, and each row has three columns. The first column contains the field labels (as determined from the ``db.person``), the second column contains the input fields (and eventually error messages), and the third column is optional and therefore empty (it can be populated with the fields in the ``SQLFORM`` constructor).</div><div class=""> </div><div class=""> All tags in the form have names derived from the table and field name. This allows easy customization of the form using CSS and JavaScript. This capability is discussed in more detail in Chapter 11.</div><div class=""> </div><div class=""> More important is that now the ``accepts`` method does a lot more work for you. As in the previous case, it performs validation of the input, but additionally, if the input passes validation, it also performs a database insert of the new record and stores in ``form.vars.id`` the unique &quot;id&quot; of the new record.</div><div class=""> </div><div class=""> A ``SQLFORM`` object also deals automatically with &quot;upload&quot; fields by saving uploaded files in the &quot;uploads&quot; folder (after having them renamed safely to avoid conflicts and prevent directory traversal attacks) and stores their names (their new names) into the appropriate field in the database. After the form has been processed, the new filename is available in ``form.vars.fieldname`` (i.e., it replaces the ``cgi.FieldStorage`` object in ``request.vars.fieldname``), so you can easily reference the new name right after upload.</div><div class=""> </div><div class="delete">A ``SQLFORM`` displays &quot;boolean&quot; values with checkboxes, &quot;text&quot; values with textareas, values required to be in a definite set or a database with drop-<span class="highlight">boxe</span>s, and &quot;upload&quot; fields with links that allow users to download the uploaded files. It hides &quot;blob&quot; fields, since they are supposed to be handled differently, as discussed later.</div><div class=""> </div><div class=""> For example, consider the following model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;married&#x27;, &#x27;boolean&#x27;),</div><div class="">     Field(&#x27;gender&#x27;, requires=IS_IN_SET([&#x27;Male&#x27;, &#x27;Female&#x27;, &#x27;Other&#x27;])),</div><div class="">     Field(&#x27;profile&#x27;, &#x27;text&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case, ``SQLFORM(db.person)`` generates the form shown below:</div><div class=""> </div><div class=""> [[image @///image/en6200.png center 300px]]</div><div class=""> </div><div class=""> The ``SQLFORM`` constructor allows various customizations, such as displaying only a subset of the fields, changing the labels, adding values to the optional third column, or creating UPDATE and DELETE forms, as opposed to INSERT forms like the current one.</div><div class=""> ``SQLFORM`` is the single biggest time-saver object in web2py.</div><div class=""> </div><div class=""> The class ``SQLFORM`` is defined in &quot;gluon/sqlhtml.py&quot;. It can be easily extended by overriding its ``xml`` method, the method that serializes the objects, to change its output.</div><div class=""> </div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class=""> For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class=""> ``</div><div class=""> buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="">              TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class=""> ``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is a special ``hidden`` attribute. When a dictionary is passed as ``hidden``, its items are translated into &quot;hidden&quot; INPUT fields (see the example for the ``FORM`` helper in Chapter 5).</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(....,hidden=...)</div><div class=""> ``:code</div><div class=""> causes the hidden fields to be passed  with the submission, no more, no less.</div><div class=""> ``form.accepts(...)`` is not</div><div class=""> intended to read the received hidden fields and move them into</div><div class="delete">form.vars. The reason is security. <span class="highlight">h</span>idden fields can be tampered with.</div><div class=""> So you have to do explicitly move hidden fields from the request to the form:</div><div class=""> </div><div class=""> ``</div><div class=""> form.vars.a = request.vars.a</div><div class=""> form = SQLFORM(..., hidden=dict(a=&#x27;b&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div><div class=""> </div><div class=""> ``SQLFORM`` creates a new db record when the form is accepted. Assuming ``form=SQLFORM(db.test)``:code, then the id of the last-created record will be accessible in ``myform.vars.id``.</div><div class=""> </div><div class=""> ``delete record``:inxx</div><div class=""> If you pass a record as the optional second argument to the ``SQLFORM`` constructor, the form becomes an UPDATE form for that record. This means that when the form is submitted the existing record is updated and no new record is inserted. If you set the argument ``deletable=True``, the UPDATE form displays a &quot;check to delete&quot; checkbox. If checked, the record is deleted.</div><div class=""> </div><div class=""> ------</div><div class=""> If a form is submitted and the delete checkbox is checked the attribute</div><div class=""> ``form.deleted`` is set to ``True``.</div><div class=""> ------</div><div class=""> </div><div class=""> You can modify the controller of the previous example so that when we pass an additional integer argument in the URL path, as in:</div><div class=""> Normally uploaded files are stored into &quot;app/uploads&quot; but you can specify an alt</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadfolder=&#x27;...&#x27;)</div><div class=""> ``</div><div class=""> In most operating system, accessing the file system can become slow when there are many files in the same folder. If you plan to upload more than 1000 files you can ask web2py to organize the uploads in subfolders:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadseparate=True)</div><div class=""> ``</div><div class=""> </div><div class=""> </div><div class=""> #### Storing the original filename</div><div class=""> </div><div class=""> web2py automatically stores the original filename inside the new UUID filename and retrieves it when the file is downloaded. Upon download, the original filename is stored in the content-disposition header of the HTTP response. This is all done transparently without the need for programming.</div><div class=""> </div><div class=""> Occasionally you may want to store the original filename in a database field. In this case, you need to modify the model and add a field to store it in:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;image_filename&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-then you need to modify the controller to handle it:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">     record = db.person(request.args(0)) or redirect(URL(&#x27;index&#x27;))</div><div class="">     url = URL(&#x27;download&#x27;)</div><div class="">     form = SQLFORM(db.person, record, deletable=True,</div><div class="">                    upload=url, fields=[&#x27;name&#x27;, &#x27;image&#x27;])</div><div class="">     if request.vars.image!=None:</div><div class="">         form.vars.image_filename = request.vars.image.filename</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice that the ``SQLFORM`` does not display the &quot;image_filename&quot; field.</div><div class=""> The &quot;display_form&quot; action moves the filename of the ``request.vars.image``</div><div class=""> into the ``form.vars.image_filename``, so that it gets processed by ``accepts`` and</div><div class=""> stored in the database. The download function, before serving the file, checks in the database for the original filename and uses it in the content-disposition header.</div><div class=""> </div><div class=""> form.process(detect_record_change=True)``</div><div class=""> </div><div class=""> and it is set in:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.detect_record_change = True</div><div class=""> ``:code</div><div class=""> and it can be changed/disabled by setting the variable to ``False``.</div><div class=""> </div><div class=""> You can change the form style by</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle = &#x27;table3cols&#x27; or &#x27;table2cols&#x27; or &#x27;divs&#x27; or &#x27;ul&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can set the separator in all crud forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.label_separator = &#x27;:&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can add captcha to forms, using the same convention explained for auth, with:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_captcha = None</div><div class=""> crud.settings.update_captcha = None</div><div class=""> crud.settings.captcha = None</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> #### Messages</div><div class=""> </div><div class=""> Here is a list of customizable messages:</div><div class=""> ``</div><div class=""> crud.messages.submit_button = &#x27;Submit&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> sets the text of the &quot;submit&quot; button for both create and update forms.</div><div class=""> ``</div><div class=""> crud.messages.delete_label = &#x27;Check to delete:&#x27;</div><div class=""> ``:code</div><div class=""> import datetime</div><div class=""> now = datetime.datetime.today()</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;),</div><div class="">     Field(&#x27;registration_stamp&#x27;, &#x27;datetime&#x27;, default=now))</div><div class=""> recent = db(db.person.registration_stamp&gt;now-datetime.timedelta(10))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(recent, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``IS_IN_DB``</div><div class=""> ``IS_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following tables and requirement:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.define_table(&#x27;dog&#x27;, Field(&#x27;name&#x27;), Field(&#x27;owner&#x27;, db.person)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  zero=T(&#x27;choose one&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">It is enforced at the level of dog INSERT/UPDATE/DELETE forms. It requires that a ``dog.owner`` be a valid id in the field ``person.id`` in the database ``db``. Because of this validator, the ``dog.owner`` field is represented as a drop<span class="highlight">box</span>. The third argument of the validator is a string that describes the elements in the drop<span class="highlight">box</span>. In the example you want to see the person ``%(name)s`` instead of the person ``%(id)s``. ``%(...)s`` is replaced by the value of the field in brackets for each record.</div><div class=""> </div><div class=""> The ``zero`` option works very much like for the ``IS_IN_SET`` validator.</div><div class=""> </div><div class="delete">The first argument of the validator can be a database connection or a DAL Set, as in ``IS_NOT_IN_DB``. This can be useful for example when wishing to limit the records in the drop-down <span class="highlight">box</span>. In this example, we use ``IS_IN_DB`` in a controller to limit the records dynamically each time the controller is called:</div><div class=""> </div><div class=""> ``</div><div class=""> def index():</div><div class="">     (...)</div><div class="">     query = (db.table.field == &#x27;xyz&#x27;) #in practice &#x27;xyz&#x27; would be a variable</div><div class="">     db.table.field.requires=IS_IN_DB(db(query),....)</div><div class="">     form=SQLFORM(...)</div><div class="">     if form.process().accepted: ...</div><div class="">     (...)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">If you want the field validated, but you do not want a drop<span class="highlight">b</span>o<span class="highlight">x</span>, you must put the validator in a list.</div><div class=""> </div><div class=""> ``</div><div class=""> db.dog.owner.requires = [IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``_and``:inxx</div><div class="delete">Occasionally you want the drop-<span class="highlight">box</span> (so you do not want to use the list syntax above) yet you want to use additional validators. For this purpose the ``IS_IN_DB`` validator takes an extra argument ``_and`` that can point to a list of other validators applied if the validated value passes the ``IS_IN_DB`` validation. For example to validate all dog owners in db that are not in a subset:</div><div class=""> ``</div><div class=""> subset=db(db.person.id&gt;100)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  _and=IS_NOT_IN_DB(subset,&#x27;person.id&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">``IS_IN_DB`` has a boolean ``distinct`` argument which defaults to ``False``. When set to ``True`` it prevents repeated values in the drop<span class="highlight"></span>down.</div><div class=""> </div><div class=""> ``IS_IN_DB`` also takes a ``cache`` argument that works like the ``cache`` argument of select.</div><div class=""> </div><div class=""> </div><div class=""> ##### ``IS_IN_DB`` and Tagging</div><div class=""> ``tags``:inxx</div><div class=""> ``multiple``:inxx</div><div class=""> </div><div class=""> The ``IS_IN_DB`` validator has an optional attribute ``multiple=False``. If set to ``True`` multiple values can be stored in one field. This field should be of type ``list:reference`` as discussed in Chapter 6. An explicit example of tagging is discussed there. ``multiple`` references are handled automatically in create and update forms, but they are transparent to the DAL. We strongly suggest using the jQuery multiselect plugin to render multiple fields.</div><div class=""> </div><div class=""> #### Custom validators</div><div class=""> ``custom validator``:inxx</div><div class=""> </div><div class=""> All validators follow the prototype below:</div><div class=""> ``</div><div class=""> class sample_validator:</div><div class="">     def __init__(self, *a, error_message=&#x27;error&#x27;):</div><div class="">         self.a = a</div><div class="">         self.e = error_message</div><div class="">     def __call__(self, value):</div><div class=""> The first case is easy:</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class="delete"><span class="highlight">#</span>## ``SQLFORM.grid`` and ``SQLFORM.smartgrid``</div><div class=""> </div><div class=""> -------</div><div class=""> Attention: grid and smartgrid were experimental prior web2py version 2.0 and were vulnerable to information leakage. The grid and smartgrid are no longer experimental, but we are still not promising backward compatibility of the presentation layer of the grid, only of its APIs.</div><div class=""> -------</div><div class=""> </div><div class=""> These are two high level objects that create complex CRUD controls. They provide pagination, the ability to browse, search, sort, create, update and delete records from a single object.</div><div class=""> </div><div class=""> Because web2py&#x27;s HTML objects build on the underlying, simpler objects, the grids create SQLFORMs for viewing, editing and creating its rows. Many of the arguments to the grids are passed through to this SQLFORM. This means the documentation for SQLFORM (and FORM) is relevant. For example, the grid takes an ``onvalidation`` callback. The processing logic of the grid ultimately passes this through to the underlying process() method of FORM, which means you should consult the documentation of ``onvalidation`` for FORMs.</div><div class=""> </div><div class=""> As the grid passes through different states, such as editing a row, a new request is generated. request.args has information about which state the grid is in.</div><div class=""> </div><div class=""> </div><div class="delete"><span class="highlight">#</span>### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid object will provide access to records matching the query.</div><div class=""> </div><div class="delete">-Before we dive into the long list of arguments of the grid object we need to understand how it works. The object looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the object links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="delete">-Because the controller function that contains the grid may itself manipulate the URL agruments (known in web2py as response.args and response.vars), the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the object. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the object.</div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(</div><div class="">     query,</div><div class="">     fields=None,</div><div class="">     field_id=None,</div><div class="">     left=None,</div><div class="">     headers={},</div><div class="">     orderby=None,</div><div class="">     groupby=None,</div><div class="">     searchable=True,</div><div class="">     sortable=True,</div><div class="">     paginate=20,</div><div class="">     deletable=True,</div><div class="">     editable=True,</div><div class="">     details=True,</div><div class="">     selectable=None,</div><div class="">     create=True,</div><div class="">     csv=True,</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class="delete"><span class="highlight">#</span>#### <span class="highlight">``Showing v</span>irtual fields in SQLFORM.grid and smartgrid<span class="highlight">``</span></div><div class=""> In versions of web2py after 2.6, virtual fields are shown in grids like normal fields: either shown alongside all other fields by default, or by including them in the ``fields`` argument. However, virtual fields are not sortable. </div><div class=""> </div><div class=""> In older web2py versions, showing virtual fields in a grid requires use of the ``links`` argument. This is still supported for more recent versions. If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, do this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field 1&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="delete">In all cases, because t1.vfield depends on t1.field1 and t1.field2, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable att<span class="highlight"></span>ibute to False. </div><div class=""> </div><div class=""> Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class=""> So for the example above, the virtual field may be defined like:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="">    Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="">   Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="">   ...)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-#### ``SQLFORM.smartgrid``</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> Also notice that when clicking on the &quot;children&quot; link for a given parent one onl</div><div class=""> @auth.requires_login():</div><div class=""> def manage():</div><div class="">     db.child.parent.writable = False</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class="delete"><span class="highlight">f</span>or a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class="delete">-The grid and smartgrid objects are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class="delete">-</div><div class="delete"><span class="highlight"></span></div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` is the only object in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/b2593fc1ec6a75073993e7ebdef68133fd41495e">b2593fc</a><ul><li>Date : 2013-10-11</li><li>Improvements to SQLFORM.grid documentation</li></ul></li></ul>
<div class="row-fluid" id="com_b2593fc1ec6a75073993e7ebdef68133fd41495e">
    <div class="span6"><div class="diff"><div class="insert">+These are two high level objects that create complex CRUD controls. They provide pagination, the ability to browse, search, sort, create, update and delete records from a single object.</div><div class="insert">+</div><div class="insert">+Because web2py&#x27;s HTML objects build on the underlying, simpler objects, the grids create SQLFORMs for viewing, editing and creating its rows. Many of the arguments to the grids are passed through to this SQLFORM. This means the documentation for SQLFORM (and FORM) is relevant. For example, the grid takes an ``onvalidation`` callback. The processing logic of the grid ultimately passes this through to the underlying process() method of FORM, which means you should consult the documentation of ``onvalidation`` for FORMs.</div><div class="insert">+</div><div class="insert">+As the grid passes through different states, such as editing a row, a new request is generated. request.args has information about which state the grid is in.</div><div class="insert">+</div><div class=""> </div><div class=""> #### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class="insert">The first argument of ``SQLFORM.grid`` can be a table or a query. The grid <span class="highlight">obj</span>e<span class="highlight">c</span>t will provide access to records matching the query.</div><div class=""> </div><div class="insert">Before we dive into the long list of arguments of the grid <span class="highlight">objec</span>t we need to understand how it works. The <span class="highlight">objec</span>t looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the <span class="highlight">objec</span>t links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="insert">Because the <span class="highlight">controller </span>function that contains the grid may itself manipulate the <span class="highlight">URL agruments (known in web2py as response.args and response.vars)</span>, the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class="insert">the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the <span class="highlight">objec</span>t. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the <span class="highlight">object.</span></div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(</div><div class="">     query,</div><div class="">     fields=None,</div><div class="">     field_id=None,</div><div class="">     left=None,</div><div class="">     headers={},</div><div class="">     orderby=None,</div><div class="">     groupby=None,</div><div class="">     searchable=True,</div><div class="">     sortable=True,</div><div class="">     paginate=20,</div><div class="">     deletable=True,</div><div class="">     editable=True,</div><div class="">     details=True,</div><div class="">     selectable=None,</div><div class="">     create=True,</div><div class=""> SQLFORM.grid(</div><div class="">     showbuttontext=True,</div><div class="">     _class=&quot;web2py_grid&quot;,</div><div class="">     formname=&#x27;web2py_grid&#x27;,</div><div class="">     search_widget=&#x27;default&#x27;,</div><div class="">     ignore_rw = False,</div><div class="">     formstyle = &#x27;table3cols&#x27;,</div><div class="">     exportclasses = None,</div><div class="">     formargs={},</div><div class="">     createargs={},</div><div class="">     editargs={},</div><div class="">     viewargs={},</div><div class="">     buttons_placement = &#x27;right&#x27;,</div><div class="">     links_placement = &#x27;right&#x27;</div><div class="">     )</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view. However, it doesn&#x27;t control what is displayed in the separate form used to edit rows. For that, use the readable and writable attribute of the database fields. For example, in a editable grid, suppress updating of a field like this: before creating the SQLFORM.grid, set </div><div class=""> ``</div><div class=""> db.my_table.a_field.writable = False</div><div class=""> db.my_table.a_field.readable = False</div><div class="insert">+</div><div class=""> ``:code</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="">    selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input, ondelete takes the table and the record id</div><div class="insert">+Because the edit/create form is an SQLFORM which extends FORM, these callbacks are essentially used in the same way as documented in the sections for FORM and SQLFORM.</div><div class="insert">+</div><div class="insert">+Here is skeleton code:</div><div class="insert">+</div><div class=""> ``</div><div class=""> def myonvalidation(form):</div><div class="insert">    print <span class="highlight">&quot;In on</span>validat<span class="highlight">ion callback&quot;</span></div><div class="">     print form.vars</div><div class="insert">+    form.errors= True  #this prevents the submission from completing</div><div class="insert">+    </div><div class="insert">+    #...or to add messages to specific elements on the form</div><div class="insert">+    form.errors.first_name = &quot;Do not name your child after prominent deities&quot;	</div><div class="insert">+    form.errors.last_name = &quot;Last names must start with a letter&quot;</div><div class="insert">+    response.flash = &quot;I don&#x27;t like your submission&quot; </div><div class=""> </div><div class=""> def myoncreate(form):</div><div class="">     print &#x27;create!&#x27;</div><div class="">     print form.vars</div><div class=""> </div><div class=""> def myonupdate(form):</div><div class="">     print &#x27;update!&#x27;</div><div class="">     print form.vars</div><div class=""> </div><div class=""> def myondelete(table, id):</div><div class="">     print &#x27;delete!&#x27;</div><div class="">     print table, id</div><div class=""> ``:code</div><div class="insert">+</div><div class="insert">+onupdate and oncreate are the same callbacks available to SQLFORM.process()</div><div class="insert">+</div><div class=""> - ``sorter_icons`` is a list of two strings (or helpers) that will be used to represent the up and down sorting options for each field.</div><div class=""> - ``ui`` can be set equal to &#x27;web2py&#x27; and will generate web2py friendly class names, can be set equal to ``jquery-ui`` and will generate jquery UI friendly class names, but it can also be its own set of class names for the various grid components:</div><div class="">   ``</div><div class=""> ui = dict(</div><div class="">     widget=&#x27;&#x27;,</div><div class="">     header=&#x27;&#x27;,</div><div class="">     content=&#x27;&#x27;,</div><div class="">     default=&#x27;&#x27;,</div><div class="">     cornerall=&#x27;&#x27;,</div><div class="">     cornertop=&#x27;&#x27;,</div><div class="">     cornerbottom=&#x27;&#x27;,</div><div class="">     button=&#x27;button&#x27;,</div><div class="">     buttontext=&#x27;buttontext button&#x27;,</div><div class="">     buttonadd=&#x27;icon plus&#x27;,</div><div class="">     buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">     buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">     buttondelete=&#x27;icon trash&#x27;,</div><div class="">     buttonedit=&#x27;icon pen&#x27;,</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ui = dict(</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> ##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class="insert">In<span class="highlight"></span> versions of web2py<span class="highlight"> after 2.6</span>, virtual fields are shown in grids like normal fields: either shown alongside all other fields by default, or by including them in the ``fields`` argument. However, virtual fields are not sortable. </div><div class=""> </div><div class="insert">In older web2py versions<span class="highlight">, showing virtual fields in a grid requires use of the ``links`` argument. This is still s</span>up<span class="highlight">ported for </span>m<span class="highlight">ore recent versions</span>. If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, do this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="insert">   links = [dict(header=&#x27;Virtual Field<span class="highlight"> 1</span>&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class=""> In all cases, because t1.vfield depends on t1.field1 and t1.field2, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div><div class=""> </div><div class=""> Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class=""> So for the example above, the virtual field may be defined like:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="">    Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="">   Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="">   ...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### ``SQLFORM.smartgrid``</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent,left=db.child.on(db.child.parent==db.parent.id))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">With SQLFORM.smartgrid you can put all the data in one <span class="highlight">obj</span>e<span class="highlight">c</span>t that spawns both tables:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which looks like this:</div><div class=""> </div><div class=""> [[image @///image/en6800.png center 480px]]</div><div class=""> </div><div class="insert">Notice the extra &quot;children&quot; links. One could create the extra ``links`` using a regular ``grid`` but they would point to a different action. With a ``smartgrid`` they are created automatically and handled by the same <span class="highlight">objec</span>t.</div><div class=""> </div><div class="insert">Also notice that when clicking on the &quot;children&quot; link for a given parent one only gets the list of children for that parent (and that is obvious) but also notice that if one now tried to add a new child, the parent value for the new child is automatically set to the selected parent (displayed in the breadcrumbs associated to the <span class="highlight">objec</span>t). The value of this field can be overwritten. We can prevent this by making it readonly:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login():</div><div class=""> def manage():</div><div class="">     db.child.parent.writable = False</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some</div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> -------</div><div class="insert">The grid and smartgrid <span class="highlight">objec</span>ts are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">The ``smartgrid`` is the only <span class="highlight">objec</span>t in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-These are two high level gadgets that create complex CRUD controls. They provide pagination, the ability to browser, search, sort, create, update and delete records from a single gadgets.</div><div class=""> </div><div class=""> #### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class="delete">The first argument of ``SQLFORM.grid`` can be a table or a query. The grid <span class="highlight">gadg</span>e<span class="highlight"></span>t will provide access to records matching the query.</div><div class=""> </div><div class="delete">Before we dive into the long list of arguments of the grid <span class="highlight">gadge</span>t we need to understand how it works. The <span class="highlight">gadge</span>t looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the <span class="highlight">gadge</span>t links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="delete">Because the <span class="highlight"></span>function that contains the grid may itself manipulate the <span class="highlight">command line arguments</span>, the grid needs to know which args should be handled by the grid and which not. Here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class="delete">the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the <span class="highlight">gadge</span>t. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the <span class="highlight">gadget.</span></div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(</div><div class="">     query,</div><div class="">     fields=None,</div><div class="">     field_id=None,</div><div class="">     left=None,</div><div class="">     headers={},</div><div class="">     orderby=None,</div><div class="">     groupby=None,</div><div class="">     searchable=True,</div><div class="">     sortable=True,</div><div class="">     paginate=20,</div><div class="">     deletable=True,</div><div class="">     editable=True,</div><div class="">     details=True,</div><div class="">     selectable=None,</div><div class="">     create=True,</div><div class=""> SQLFORM.grid(</div><div class="">     showbuttontext=True,</div><div class="">     _class=&quot;web2py_grid&quot;,</div><div class="">     formname=&#x27;web2py_grid&#x27;,</div><div class="">     search_widget=&#x27;default&#x27;,</div><div class="">     ignore_rw = False,</div><div class="">     formstyle = &#x27;table3cols&#x27;,</div><div class="">     exportclasses = None,</div><div class="">     formargs={},</div><div class="">     createargs={},</div><div class="">     editargs={},</div><div class="">     viewargs={},</div><div class="">     buttons_placement = &#x27;right&#x27;,</div><div class="">     links_placement = &#x27;right&#x27;</div><div class="">     )</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view. However, it doesn&#x27;t control what is displayed in the separate form used to edit rows. For that, use the readable and writable attribute of the database fields. For example, in a editable grid, suppress updating of a field like this: before creating the SQLFORM.grid, set </div><div class=""> ``</div><div class=""> db.my_table.a_field.writable = False</div><div class=""> db.my_table.a_field.readable = False</div><div class=""> ``:code</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="">    selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input, ondelete takes the table and the record id</div><div class=""> ``</div><div class=""> def myonvalidation(form):</div><div class="delete">    print <span class="highlight">&#x27;</span>validat<span class="highlight">e!&#x27;</span></div><div class="">     print form.vars</div><div class=""> </div><div class=""> def myoncreate(form):</div><div class="">     print &#x27;create!&#x27;</div><div class="">     print form.vars</div><div class=""> </div><div class=""> def myonupdate(form):</div><div class="">     print &#x27;update!&#x27;</div><div class="">     print form.vars</div><div class=""> </div><div class=""> def myondelete(table, id):</div><div class="">     print &#x27;delete!&#x27;</div><div class="">     print table, id</div><div class=""> ``:code</div><div class=""> - ``sorter_icons`` is a list of two strings (or helpers) that will be used to represent the up and down sorting options for each field.</div><div class=""> - ``ui`` can be set equal to &#x27;web2py&#x27; and will generate web2py friendly class names, can be set equal to ``jquery-ui`` and will generate jquery UI friendly class names, but it can also be its own set of class names for the various grid components:</div><div class="">   ``</div><div class=""> ui = dict(</div><div class="">     widget=&#x27;&#x27;,</div><div class="">     header=&#x27;&#x27;,</div><div class="">     content=&#x27;&#x27;,</div><div class="">     default=&#x27;&#x27;,</div><div class="">     cornerall=&#x27;&#x27;,</div><div class="">     cornertop=&#x27;&#x27;,</div><div class="">     cornerbottom=&#x27;&#x27;,</div><div class="">     button=&#x27;button&#x27;,</div><div class="">     buttontext=&#x27;buttontext button&#x27;,</div><div class="">     buttonadd=&#x27;icon plus&#x27;,</div><div class="">     buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">     buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">     buttondelete=&#x27;icon trash&#x27;,</div><div class="">     buttonedit=&#x27;icon pen&#x27;,</div><div class="">     buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">     buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ui = dict(</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> ##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class="delete">In<span class="highlight"> recent</span> versions of web2py<span class="highlight"></span>, virtual fields are shown in grids like normal fields: either shown alongside all other fields by default, or by including them in the ``fields`` argument. However, virtual fields are not sortable. </div><div class=""> </div><div class="delete">In older web2py versions<span class="highlight"> (</span>up<span class="highlight"> to 2.4.7), showing virtual fields in a grid requires use of the ``links`` argu</span>m<span class="highlight">ent</span>. If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, do this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="delete">   links = [dict(header=&#x27;Virtual Field<span class="highlight"></span>&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class=""> In all cases, because t1.vfield depends on t1.field1 and t1.field2, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div><div class=""> </div><div class=""> Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class=""> So for the example above, the virtual field may be defined like:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="">    Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="">   Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="">   ...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### ``SQLFORM.smartgrid``</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent,left=db.child.on(db.child.parent==db.parent.id))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">With SQLFORM.smartgrid you can put all the data in one <span class="highlight">gadg</span>e<span class="highlight"></span>t that spawns both tables:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which looks like this:</div><div class=""> </div><div class=""> [[image @///image/en6800.png center 480px]]</div><div class=""> </div><div class="delete">Notice the extra &quot;children&quot; links. One could create the extra ``links`` using a regular ``grid`` but they would point to a different action. With a ``smartgrid`` they are created automatically and handled by the same <span class="highlight">gadge</span>t.</div><div class=""> </div><div class="delete">Also notice that when clicking on the &quot;children&quot; link for a given parent one only gets the list of children for that parent (and that is obvious) but also notice that if one now tried to add a new child, the parent value for the new child is automatically set to the selected parent (displayed in the breadcrumbs associated to the <span class="highlight">gadge</span>t). The value of this field can be overwritten. We can prevent this by making it readonly:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login():</div><div class=""> def manage():</div><div class="">     db.child.parent.writable = False</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some</div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> -------</div><div class="delete">The grid and smartgrid <span class="highlight">gadge</span>ts are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="delete">The ``smartgrid`` is the only <span class="highlight">gadge</span>t in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/8b28bd0fbec5d28a791572393467e5d593ce409a">8b28bd0</a><ul><li>Date : 2013-10-09</li><li>using keepvalues with SQLFORM</li></ul></li></ul>
<div class="row-fluid" id="com_8b28bd0fbec5d28a791572393467e5d593ce409a">
    <div class="span6"><div class="diff"><div class="insert">+#### The ``process`` method</div><div class="insert">+SQLFORM uses the process method (as do forms).</div><div class="insert">+</div><div class="insert">+If you want to use keepvalues with an SQLFORM, you pass an argument to the process method:</div><div class="insert">+</div><div class="insert">+``if form.process(keepvalues=True).accepted:``:code</div><div class="insert">+</div><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div></div></div>
    <div class="span6"><div class="diff"><div class=""> #### ``SQLFORM`` and ``insert``/``update``/``delete``</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/11ea57f066366c70e4d3496e98227888aa145534">11ea57f</a><ul><li>Date : 2013-09-21</li><li>Tips on suppressing fields in edit form of SQLFORM.grid using .writable &amp; .editable</li></ul></li></ul>
<div class="row-fluid" id="com_11ea57f066366c70e4d3496e98227888aa145534">
    <div class="span6"><div class="diff"><div class="insert">+- ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view. However, it doesn&#x27;t control what is displayed in the separate form used to edit rows. For that, use the readable and writable attribute of the database fields. For example, in a editable grid, suppress updating of a field like this: before creating the SQLFORM.grid, set </div><div class="insert">+``</div><div class="insert">+db.my_table.a_field.writable = False</div><div class="insert">+db.my_table.a_field.readable = False</div><div class="insert">+``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-- ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/2923b14b2707fe6e12ff6c83f85cc55d748d7df5">2923b14</a><ul><li>Date : 2013-09-10</li><li>grid callbacks, thanks Niphlod</li></ul></li></ul>
<div class="row-fluid" id="com_2923b14b2707fe6e12ff6c83f85cc55d748d7df5">
    <div class="span6"><div class="diff"><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view.</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="">    selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class="insert">+- ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input, ondelete takes the table and the record id</div><div class="insert">+``</div><div class="insert">+def myonvalidation(form):</div><div class="insert">+    print &#x27;validate!&#x27;</div><div class="insert">+    print form.vars</div><div class="insert">+</div><div class="insert">+def myoncreate(form):</div><div class="insert">+    print &#x27;create!&#x27;</div><div class="insert">+    print form.vars</div><div class="insert">+</div><div class="insert">+def myonupdate(form):</div><div class="insert">+    print &#x27;update!&#x27;</div><div class="insert">+    print form.vars</div><div class="insert">+</div><div class="insert">+def myondelete(table, id):</div><div class="insert">+    print &#x27;delete!&#x27;</div><div class="insert">+    print table, id</div><div class="insert">+``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view.</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class=""> - ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class=""> - ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class=""> - ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="">   ``</div><div class="">    selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class=""> ``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class=""> - ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class=""> - ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class=""> - ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class="delete">-- ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/f715fbf519725513052183444e977da2d4a0fadd">f715fbf</a><ul><li>Date : 2013-08-21</li><li>fixed a few typos thanks REM</li></ul></li></ul>
<div class="row-fluid" id="com_f715fbf519725513052183444e977da2d4a0fadd">
    <div class="span6"><div class="diff"><div class=""> If you pass a URL to the ``SQLFORM`` constructor via the upload argument, web2py uses the action at that URL to download the file. Consider the following actions:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="insert">   record = db.person(request.args(0))<span class="highlight"></span></div><div class="">    form = SQLFORM(db.person, record, deletable=True,</div><div class="">                   upload=URL(&#x27;download&#x27;))</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class="">    return dict(form=form)</div><div class=""> </div><div class=""> def download():</div><div class="">     return response.download(request, db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now, insert a new record at the URL:</div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/default/display_form</div><div class=""> ``:code</div><div class=""> </div><div class=""> Upload an image, submit the form, and then edit the newly created record</div><div class=""> by visiting:</div><div class=""> ``</div><div class=""> Here is the page:</div><div class=""> [[image @///image/en6400.png center 300px]]</div><div class=""> </div><div class=""> There is a link called &quot;dog.owner&quot;. The name of this link can be changed via the ``labels`` argument of the ``SQLFORM``, for example:</div><div class=""> ``</div><div class=""> labels = {&#x27;dog.owner&#x27;:&quot;This person&#x27;s dogs&quot;}</div><div class=""> ``:code</div><div class=""> </div><div class=""> If you click on the link you get directed to:</div><div class=""> ``</div><div class=""> /test/default/list_records/dog?query=db.dog.owner%3D%3D5</div><div class=""> ``:code</div><div class=""> </div><div class=""> &quot;list_records&quot; is the specified action, with ``request.args(0)`` set to the name of the referencing table and ``request.vars.query`` set to the SQL query string.</div><div class=""> The query string in the URL</div><div class=""> contains the value &quot;dog.owner=5&quot; appropriately url-encoded</div><div class=""> (web2py decodes this automatically when the URL is parsed).</div><div class=""> </div><div class=""> You can easily implement a very general &quot;list_records&quot; action as follows:</div><div class=""> ``</div><div class=""> def list_records():</div><div class="insert">+    import re</div><div class="">     REGEX = re.compile(&#x27;^(\w+)\.(\w+)\.(\w+)\=\=(\d+)$&#x27;)</div><div class="">     match = REGEX.match(request.vars.query)</div><div class="">     if not match:</div><div class="">         redirect(URL(&#x27;error&#x27;))</div><div class="">     table, field, id = match.group(2), match.group(3), match.group(4)</div><div class="">     records = db(db[table][field]==id).select()</div><div class="">     return dict(records=records)</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> If you pass a URL to the ``SQLFORM`` constructor via the upload argument, web2py uses the action at that URL to download the file. Consider the following actions:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="delete">   record = db.person(request.args(0))<span class="highlight"> or redirect(URL(&#x27;index&#x27;))</span></div><div class="">    form = SQLFORM(db.person, record, deletable=True,</div><div class="">                   upload=URL(&#x27;download&#x27;))</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class="">    return dict(form=form)</div><div class=""> </div><div class=""> def download():</div><div class="">     return response.download(request, db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now, insert a new record at the URL:</div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/default/display_form</div><div class=""> ``:code</div><div class=""> </div><div class=""> Upload an image, submit the form, and then edit the newly created record</div><div class=""> by visiting:</div><div class=""> ``</div><div class=""> Here is the page:</div><div class=""> [[image @///image/en6400.png center 300px]]</div><div class=""> </div><div class=""> There is a link called &quot;dog.owner&quot;. The name of this link can be changed via the ``labels`` argument of the ``SQLFORM``, for example:</div><div class=""> ``</div><div class=""> labels = {&#x27;dog.owner&#x27;:&quot;This person&#x27;s dogs&quot;}</div><div class=""> ``:code</div><div class=""> </div><div class=""> If you click on the link you get directed to:</div><div class=""> ``</div><div class=""> /test/default/list_records/dog?query=db.dog.owner%3D%3D5</div><div class=""> ``:code</div><div class=""> </div><div class=""> &quot;list_records&quot; is the specified action, with ``request.args(0)`` set to the name of the referencing table and ``request.vars.query`` set to the SQL query string.</div><div class=""> The query string in the URL</div><div class=""> contains the value &quot;dog.owner=5&quot; appropriately url-encoded</div><div class=""> (web2py decodes this automatically when the URL is parsed).</div><div class=""> </div><div class=""> You can easily implement a very general &quot;list_records&quot; action as follows:</div><div class=""> ``</div><div class=""> def list_records():</div><div class="">     REGEX = re.compile(&#x27;^(\w+)\.(\w+)\.(\w+)\=\=(\d+)$&#x27;)</div><div class="">     match = REGEX.match(request.vars.query)</div><div class="">     if not match:</div><div class="">         redirect(URL(&#x27;error&#x27;))</div><div class="">     table, field, id = match.group(2), match.group(3), match.group(4)</div><div class="">     records = db(db[table][field]==id).select()</div><div class="">     return dict(records=records)</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/b8030dd3c795f05392f2074845f657dc60670702">b8030dd</a><ul><li>Date : 2013-07-19</li><li>Fixed a display error for the documentation of the buttons argument to SQLFORM, and added a simple but useful example.</li></ul></li></ul>
<div class="row-fluid" id="com_b8030dd3c795f05392f2074845f657dc60670702">
    <div class="span6"><div class="diff"><div class=""> You can add more than one button to form. The arguments of ``add_button`` are the value of the button (its text) and the url where to redirect to.</div><div class="insert">+(See also the buttons argument for SQLFORM, which provides a more powerful approach)</div><div class=""> </div><div class=""> #### More about manipulation of FORMs</div><div class=""> As discussed in the Views chapter, a FORM is an HTML helper. Helpers can be manipulated as Python lists and as dictionaries, which enables run-time creation and modification.</div><div class=""> </div><div class=""> ### ``SQLFORM``</div><div class=""> </div><div class=""> We now move to the next level by providing the application with a model file:</div><div class=""> ``</div><div class=""> db = DAL(&#x27;sqlite://storage.sqlite&#x27;)</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Modify the controller as follows:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    form = SQLFORM(db.person)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class=""> SQLFORM(table, record = None,</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> ``:code</div><div class=""> - ``linkto`` and ``upload`` are optional URLs to user-defined controllers that allow the form to deal with reference fields. This is discussed in more detail later in the section.</div><div class=""> - ``readonly``. If set to True, displays the form as readonly</div><div class=""> - ``comments``. If set to False, does not display the col3 comments</div><div class=""> - ``ignore_rw``. Normally, for a create/update form, only fields marked as writable=True are shown, and for readonly forms, only fields marked as readable=True are shown. Setting ``ignore_rw=True`` causes those constraints to be ignored, and all fields are displayed. This is mostly used in the appadmin interface to display all fields for each table, overriding what the model indicates.</div><div class=""> - ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization). ``formstyle`` can also be a function that takes (record_id, field_label, field_widget, field_comment) as attributes and returns a TR() object.</div><div class="insert">+- ``buttons``:inxx ``buttons`` is a list of ``INPUT``s or ``TAG.button``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go. </div><div class="insert">+For example, adding a URL-based back-button (for a multi-page form) and a renamed submit button:</div><div class="insert">+``</div><div class="insert">+buttons = [TAG.button(&#x27;Back&#x27;,_type=&quot;button&quot;,_onClick = &quot;parent.location=&#x27;%s&#x27; &quot; % URL(...),</div><div class="insert">+             TAG.button(&#x27;Next&#x27;,_type=&quot;submit&quot;)]</div><div class="insert">+``:code</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> You can add more than one button to form. The arguments of ``add_button`` are the value of the button (its text) and the url where to redirect to.</div><div class=""> </div><div class=""> #### More about manipulation of FORMs</div><div class=""> As discussed in the Views chapter, a FORM is an HTML helper. Helpers can be manipulated as Python lists and as dictionaries, which enables run-time creation and modification.</div><div class=""> </div><div class=""> ### ``SQLFORM``</div><div class=""> </div><div class=""> We now move to the next level by providing the application with a model file:</div><div class=""> ``</div><div class=""> db = DAL(&#x27;sqlite://storage.sqlite&#x27;)</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Modify the controller as follows:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    form = SQLFORM(db.person)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class=""> SQLFORM(table, record = None,</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> ``:code</div><div class=""> - ``linkto`` and ``upload`` are optional URLs to user-defined controllers that allow the form to deal with reference fields. This is discussed in more detail later in the section.</div><div class=""> - ``readonly``. If set to True, displays the form as readonly</div><div class=""> - ``comments``. If set to False, does not display the col3 comments</div><div class=""> - ``ignore_rw``. Normally, for a create/update form, only fields marked as writable=True are shown, and for readonly forms, only fields marked as readable=True are shown. Setting ``ignore_rw=True`` causes those constraints to be ignored, and all fields are displayed. This is mostly used in the appadmin interface to display all fields for each table, overriding what the model indicates.</div><div class=""> - ``formstyle``:inxx ``formstyle`` determines the style to be used when serializing the form in html. It can be &quot;table3cols&quot; (default), &quot;table2cols&quot; (one row for label and comment, and one row for input), &quot;ul&quot; (makes an unordered list of input fields), &quot;divs&quot; (represents the form using css friendly divs, for arbitrary customization). ``formstyle`` can also be a function that takes (record_id, field_label, field_widget, field_comment) as attributes and returns a TR() object.</div><div class="delete">-- ``buttons``:inxx is a list of ``INPUT``s or ``TAG.BUTTON``s (though technically could be any combination of helpers) that will be added to a DIV where the submit button would go.</div><div class=""> - ``separator``:inxx ``separator`` sets the string that separates form labels from form input fields.</div><div class=""> - Optional ``attributes`` are arguments starting with underscore that you want to pass to the ``FORM`` tag that renders the ``SQLFORM`` object. Examples are:</div><div class=""> ``</div><div class=""> _action = &#x27;.&#x27;</div><div class=""> _method = &#x27;POST&#x27;</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/eeabc3206531300cbbff92d92b4420b3a98512a5">eeabc32</a><ul><li>Date : 2013-06-04</li><li>fixed form example in chap7, thanks Joe and Anthony</li></ul></li></ul>
<div class="row-fluid" id="com_eeabc3206531300cbbff92d92b4420b3a98512a5">
    <div class="span6"><div class="diff"><div class=""> and insert the form in the associated &quot;default/display_manual_form.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class="insert">&lt;form<span class="highlight"> action=&quot;#&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;</span>&gt;</div><div class=""> &lt;ul&gt;</div><div class="">   &lt;li&gt;Your name is &lt;input name=&quot;name&quot; /&gt;&lt;/li&gt;</div><div class=""> &lt;/ul&gt;</div><div class="">   &lt;input type=&quot;submit&quot; /&gt;</div><div class="">   &lt;input type=&quot;hidden&quot; name=&quot;_formname&quot; value=&quot;test&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> and insert the form in the associated &quot;default/display_manual_form.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class="delete">&lt;form<span class="highlight"></span>&gt;</div><div class=""> &lt;ul&gt;</div><div class="">   &lt;li&gt;Your name is &lt;input name=&quot;name&quot; /&gt;&lt;/li&gt;</div><div class=""> &lt;/ul&gt;</div><div class="">   &lt;input type=&quot;submit&quot; /&gt;</div><div class="">   &lt;input type=&quot;hidden&quot; name=&quot;_formname&quot; value=&quot;test&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/67961abf844c1076bc877583cf42b9720d89eeed">67961ab</a><ul><li>Date : 2013-06-04</li><li>Updated virtual fields to for changes of June 4</li></ul></li></ul>
<div class="row-fluid" id="com_67961abf844c1076bc877583cf42b9720d89eeed">
    <div class="span6"><div class="diff"><div class=""> ##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class="insert">+In recent versions of web2py, virtual fields are shown in grids like normal fields: either shown alongside all other fields by default, or by including them in the ``fields`` argument. However, virtual fields are not sortable. </div><div class=""> </div><div class="insert"><span class="highlight">In older web2py versions (up to 2.4.7), showing virtual fields in a grid requires use of the ``links`` argument. </span>If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, <span class="highlight">do</span> this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">In all </span>ca<span class="highlight">ses, beca</span>use t1.vfield depends on t1.field1 and t1.field2<span class="highlight"></span>, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div></div></div>
    <div class="span6"><div class="diff"><div class=""> ##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class=""> </div><div class="delete">-Virtual fields are calculated on-the-fly. Virtual fields are not currently genuine equivalents to fields. Showing virtual fields in a grid requires use of the ``links`` argument.</div><div class="delete">-</div><div class="delete"><span class="highlight"></span>If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, <span class="highlight">it can be shown in the SQLFORM.grid like</span> this:</div><div class=""> </div><div class=""> ``grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="delete"><span class="highlight">Be</span>ca<span class="highlight"></span>use t1.vfield depends on t1.field1 and t1.field2<span class="highlight"> for its value</span>, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/c81e1ffcfdbc8a5cf0f6c48033b0582781d38f7f">c81e1ff</a><ul><li>Date : 2013-06-04</li><li>fixes markup error caused by my last commit.</li></ul></li></ul>
<div class="row-fluid" id="com_c81e1ffcfdbc8a5cf0f6c48033b0582781d38f7f">
    <div class="span6"><div class="diff"><div class="insert"><span class="highlight">``</span>grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete"><span class="highlight"></span>grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/e4e22c48906a0057c9a3854f837594e8c31d3539">e4e22c4</a><ul><li>Date : 2013-06-04</li><li>Fewer words required for the ti[ps on showing virtual fields in a grid</li></ul></li></ul>
<div class="row-fluid" id="com_e4e22c48906a0057c9a3854f837594e8c31d3539">
    <div class="span6"><div class="diff"><div class="insert">+Virtual fields are calculated on-the-fly. Virtual fields are not currently genuine equivalents to fields. Showing virtual fields in a grid requires use of the ``links`` argument.</div><div class="insert">+</div><div class="insert">+If table db.t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, it can be shown in the SQLFORM.grid like this:</div><div class=""> </div><div class=""> grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight">B</span>ecause t1.vfield depends on t1.field1 and t1.field2 for its value, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-Virtual fields are calculated on-the-fly. Virtual fields would cause difficulties if they were treated as genuine equivalents to fields. For instance, grid fields are sortable by the user. Offering this on virtual fields would require expensive computation. Showing virtual fields in a grid requires use of the ``links`` argument.</div><div class=""> </div><div class="delete">-For example, if table t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, it can be shown in the SQLFORM.grid like this:</div><div class="delete">-``</div><div class=""> grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="">    links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class=""> ``:code</div><div class=""> </div><div class="delete"><span class="highlight">Note that b</span>ecause t1.vfield depends on t1.field1 and t1.field2 for its value, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/5ebcc42a6693401b956821b9bcae4a94afa3f869">5ebcc42</a><ul><li>Date : 2013-06-04</li><li>Explain the use of links to display virtual fields in grids</li></ul></li></ul>
<div class="row-fluid" id="com_5ebcc42a6693401b956821b9bcae4a94afa3f869">
    <div class="span6"><div class="diff"><div class="insert">+#### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class="insert">+##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class="insert">+</div><div class="insert">+Virtual fields are calculated on-the-fly. Virtual fields would cause difficulties if they were treated as genuine equivalents to fields. For instance, grid fields are sortable by the user. Offering this on virtual fields would require expensive computation. Showing virtual fields in a grid requires use of the ``links`` argument.</div><div class="insert">+</div><div class="insert">+For example, if table t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, it can be shown in the SQLFORM.grid like this:</div><div class="insert">+``</div><div class="insert">+grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="insert">+   links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Note that because t1.vfield depends on t1.field1 and t1.field2 for its value, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div><div class="insert">+</div><div class="insert">+Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class="insert">+So for the example above, the virtual field may be defined like:</div><div class="insert">+``</div><div class="insert">+db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="insert">+   Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="insert">+  Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="insert">+  ...)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+#### ``SQLFORM.smartgrid``</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/94a462df41e3ab93353a4762c01f3bb827637579">94a462d</a><ul><li>Date : 2013-06-04</li><li>Explain the use of links to display virtual fields in grids</li></ul></li></ul>
<div class="row-fluid" id="com_94a462df41e3ab93353a4762c01f3bb827637579">
    <div class="span6"><div class="diff"><div class="insert">+#### ``SQLFORM.grid`` </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class="insert">+##### ``Showing virtual fields in SQLFORM.grid and smartgrid``</div><div class="insert">+</div><div class="insert">+Virtual fields are calculated on-the-fly. Virtual fields would cause difficulties if they were treated as genuine equivalents to fields. For instance, grid fields are sortable by the user. Offering this on virtual fields would require expensive computation. Showing virtual fields in a grid requires use of the ``links`` argument.</div><div class="insert">+</div><div class="insert">+For example, if table t1 has a field called t1.vfield which is based on the values of t1.field1 and t1.field2, it can be shown in the SQLFORM.grid like this:</div><div class="insert">+``</div><div class="insert">+grid = SQLFORM.grid(db.t1, ..., fields = [t1.field1, t1.field2,...], </div><div class="insert">+   links = [dict(header=&#x27;Virtual Field&#x27;,body=lamba row:row.vfield),...] )</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Note that because t1.vfield depends on t1.field1 and t1.field2 for its value, these fields must be present in the row. In the example above, this is guaranteed by including t1.field1 and t1.field2 in the fields argument. Alternatively, showing all fields will also work. You can suppress a field from displaying by setting the readable attibute to False. </div><div class="insert">+</div><div class="insert">+Note that when defining the virtual field, the lambda function must qualify fields with the database name, but in the links argument, this is not necessary.</div><div class="insert">+So for the example above, the virtual field may be defined like:</div><div class="insert">+``</div><div class="insert">+db.define_table(&#x27;t1&#x27;,Field(&#x27;field1&#x27;,&#x27;string&#x27;),</div><div class="insert">+   Field(&#x27;field2&#x27;,&#x27;string&#x27;),</div><div class="insert">+  Field.Virtual(&#x27;virtual1&#x27;, lambda row: row.t1.field1 + row.t1.field2),</div><div class="insert">+  ...)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+#### ``SQLFORM.smartgrid``</div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class=""> ui = dict(</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as</div><div class=""> </div><div class=""> ``</div><div class=""> csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class=""> csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class=""> xml=(ExporterXML, &#x27;XML&#x27;),</div><div class=""> html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class=""> tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class=""> tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class=""> </div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/a5582c25e72bb1b9e7e61ec40bb11a1ad6ab30b3">a5582c2</a><ul><li>Date : 2013-04-29</li><li>Further minor improvements to using IS_IN_SET to force a checkbox to be ticked</li></ul></li></ul>
<div class="row-fluid" id="com_a5582c25e72bb1b9e7e61ec40bb11a1ad6ab30b3">
    <div class="span6"><div class="diff"><div class="insert"><span class="highlight">To f</span>or<span class="highlight">ce</span> a<span class="highlight"> filled-in</span> form checkbox<span class="highlight"> (such as an acceptance of terms and conditions)</span>, use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class="delete"><span class="highlight">F</span>or<span class="highlight"></span> a<span class="highlight"></span> form checkbox<span class="highlight"></span>, use this:</div><div class=""> ``</div><div class=""> requires=IS_IN_SET([&#x27;on&#x27;])</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/1970e6f5596a96358cbcba2202bc1fa69211a389">1970e6f</a><ul><li>Date : 2013-04-21</li><li>updates</li></ul></li></ul>
<div class="row-fluid" id="com_1970e6f5596a96358cbcba2202bc1fa69211a389">
    <div class="span6"><div class="diff"><div class="insert">+For a form checkbox, use this:</div><div class="insert">+``</div><div class="insert">+requires=IS_IN_SET([&#x27;on&#x27;])</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class=""> #### Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div><div class=""> #### List of tuples example:</div><div class=""> requires = IS_IN_SET([(&#x27;A&#x27;,&#x27;Apple&#x27;),(&#x27;B&#x27;,&#x27;Banana&#x27;),(&#x27;C&#x27;,&#x27;Cherry&#x27;)])</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> You may also use a dictionary or a list of tuples to make the drop down list more descriptive:</div><div class=""> ``</div><div class=""> #### Dictionary example:</div><div class=""> requires = IS_IN_SET({&#x27;A&#x27;:&#x27;Apple&#x27;,&#x27;B&#x27;:&#x27;Banana&#x27;,&#x27;C&#x27;:&#x27;Cherry&#x27;},zero=None)</div><div class=""> #### List of tuples example:</div><div class=""> requires = IS_IN_SET([(&#x27;A&#x27;,&#x27;Apple&#x27;),(&#x27;B&#x27;,&#x27;Banana&#x27;),(&#x27;C&#x27;,&#x27;Cherry&#x27;)])</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/de5bac8c4346c1a5dc33dea9e20875e087ab4727">de5bac8</a><ul><li>Date : 2013-04-18</li><li>Clarified writable=False and assignments to form.vars.field</li></ul></li></ul>
<div class="row-fluid" id="com_de5bac8c4346c1a5dc33dea9e20875e087ab4727">
    <div class="span6"><div class="diff"><div class="insert">When a <span class="highlight">f</span>ield is marked with ``writable=False``, the field is not shown in create forms, and it is shown readonly in update forms. If a field is marked as ``writable=False`` and ``readable=False``, then the field is not shown at all, not even in update forms.</div><div class=""> </div><div class=""> Forms created with</div><div class=""> ``</div><div class=""> form = SQLFORM(...,ignore_rw=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ignore the ``readable`` and ``writable`` attributes and always show all fields. Forms in ``appadmin`` ignore them by default.</div><div class=""> </div><div class=""> Forms created with</div><div class=""> ``</div><div class=""> form = SQLFORM(table,record_id,readonly=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> always show all fields in readonly mode, and they cannot be accepted.</div><div class=""> </div><div class="insert">+Marking a field with ``writable=False`` prevents the field from being part of the form, and causes the form processing to disregard the value of ``request.vars.field`` when processing the form.  However, if you assign a value to ``form.vars.field``, this value &#x27;&#x27;will&#x27;&#x27; be part of the insert or update when the form is processed. </div><div class="insert">+This enables you to change the value of fields that for some reason you do not wish to include in a form.</div><div class="insert">+</div><div class="insert">+</div><div class=""> #### ``SQLFORM`` in HTML</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">When a <span class="highlight">F</span>ield is marked with ``writable=False``, the field is not shown in create forms, and it is shown readonly in update forms. If a field is marked as ``writable=False`` and ``readable=False``, then the field is not shown at all, not even in update forms.</div><div class=""> </div><div class=""> Forms created with</div><div class=""> ``</div><div class=""> form = SQLFORM(...,ignore_rw=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ignore the ``readable`` and ``writable`` attributes and always show all fields. Forms in ``appadmin`` ignore them by default.</div><div class=""> </div><div class=""> Forms created with</div><div class=""> ``</div><div class=""> form = SQLFORM(table,record_id,readonly=True)</div><div class=""> ``:code</div><div class=""> </div><div class=""> always show all fields in readonly mode, and they cannot be accepted.</div><div class=""> </div><div class=""> #### ``SQLFORM`` in HTML</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/739a4c66c06a1aa5de5f4bd07b49e2f04ec30290">739a4c6</a><ul><li>Date : 2013-04-04</li><li>English 5th: Various text corrections</li></ul></li></ul>
<div class="row-fluid" id="com_739a4c66c06a1aa5de5f4bd07b49e2f04ec30290">
    <div class="span6"><div class="diff"><div class=""> The process function takes some extra argument that ``accepts`` does not take:</div><div class=""> - ``message_onsuccess``</div><div class=""> - ``onsuccess``: if equal to &#x27;flash&#x27; (default) and the form is accepted it will flash the above `message_onsuccess``</div><div class=""> - ``message_onfailure``</div><div class=""> - ``onfailure``: if equal to &#x27;flash&#x27; (default) and the form fails validation, it will flash the above `message_onfailure``</div><div class="insert">- ``next`` <span class="highlight">indica</span>t<span class="highlight">es w</span>he<span class="highlight">r</span>e<span class="highlight"></span> to redirect<span class="highlight"> the user</span> after the form is accepted.</div><div class=""> ``onsuccess`` and ``onfailure`` can be functions like ``lambda form: do_something(form)``.</div><div class=""> </div><div class=""> ``</div><div class=""> form.validate(...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> is a shortcut for</div><div class=""> </div><div class=""> ``</div><div class=""> form.process(...,dbio=False).accepted</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### Hidden fields</div><div class=""> </div><div class=""> When the above form object is serialized by ``{{=form}}``, and because of the previous call to the ``accepts`` method, it now looks like this:</div><div class=""> ``</div><div class=""> &lt;form enctype=&quot;multipart/form-data&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</div><div class=""> your name:</div><div class=""> &lt;input name=&quot;name&quot; /&gt;</div><div class=""> &lt;input type=&quot;submit&quot; /&gt;</div><div class=""> The ``SQLFORM`` constructor allows various customizations, such as displaying on</div><div class=""> </div><div class=""> The class ``SQLFORM`` is defined in &quot;gluon/sqlhtml.py&quot;. It can be easily extended by overriding its ``xml`` method, the method that serializes the objects, to change its output.</div><div class=""> </div><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class=""> SQLFORM(table, record = None,</div><div class="">         deletable = False, linkto = None,</div><div class="">         upload = None, fields = None, labels = None,</div><div class="">         col3 = {}, submit_button = &#x27;Submit&#x27;,</div><div class="">         delete_label = &#x27;Check to delete:&#x27;,</div><div class="">         showid = True, readonly = False,</div><div class="">         comments = True, keepopts = [],</div><div class="">         ignore_rw = False, record_id = None,</div><div class="">         formstyle = &#x27;table3cols&#x27;,</div><div class="">         buttons = [&#x27;submit&#x27;], separator = &#x27;: &#x27;,</div><div class="">         **attributes)</div><div class=""> </div><div class=""> ``:code</div><div class=""> - The optional second argument turns the INSERT form into an UPDATE form for the specified record (see next subsection). ``showid``:inxx ``delete_label``:inxx ``id_label``:inxx ``submit_button``:inxx</div><div class="insert">- If ``deletable`` is set to ``True``, the UPDATE form displays a &quot;Check to delete&quot; checkbox. The value of the label <span class="highlight"></span>f<span class="highlight">or</span> this field is set via the ``delete_label`` argument.</div><div class=""> - ``submit_button`` sets the value of the submit button.</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> ``:code</div><div class=""> - ``linkto`` and ``upload`` are optional URLs to user-defined controllers that allow the form to deal with reference fields. This is discussed in more detail later in the section.</div><div class=""> - ``readonly``. If set to True, displays the form as readonly</div><div class=""> - ``comments``. If set to False, does not display the col3 comments</div><div class=""> - ``ignore_rw``. Normally, for a create/update form, only fields marked as writable=True are shown, and for readonly forms, only fields marked as readable=True are shown. Setting ``ignore_rw=True`` causes those constraints to be ignored, and all fields are displayed. This is mostly used in the appadmin interface to display all fields for each table, overriding what the model indicates.</div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="insert">Because the function that contains the grid may itself manipulate the command line arguments, the grid needs to know which args should be handled by the grid and which not. <span class="highlight">Here is an</span> example <span class="highlight"></span>of code that allows one to manage any table:</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The process function takes some extra argument that ``accepts`` does not take:</div><div class=""> - ``message_onsuccess``</div><div class=""> - ``onsuccess``: if equal to &#x27;flash&#x27; (default) and the form is accepted it will flash the above `message_onsuccess``</div><div class=""> - ``message_onfailure``</div><div class=""> - ``onfailure``: if equal to &#x27;flash&#x27; (default) and the form fails validation, it will flash the above `message_onfailure``</div><div class="delete">- ``next`` <span class="highlight"></span>t<span class="highlight"></span>he<span class="highlight"> us</span>e<span class="highlight">r</span> to redirect<span class="highlight"></span> after the form is accepted.</div><div class=""> ``onsuccess`` and ``onfailure`` can be functions like ``lambda form: do_something(form)``.</div><div class=""> </div><div class=""> ``</div><div class=""> form.validate(...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> is a shortcut for</div><div class=""> </div><div class=""> ``</div><div class=""> form.process(...,dbio=False).accepted</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### Hidden fields</div><div class=""> </div><div class=""> When the above form object is serialized by ``{{=form}}``, and because of the previous call to the ``accepts`` method, it now looks like this:</div><div class=""> ``</div><div class=""> &lt;form enctype=&quot;multipart/form-data&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</div><div class=""> your name:</div><div class=""> &lt;input name=&quot;name&quot; /&gt;</div><div class=""> &lt;input type=&quot;submit&quot; /&gt;</div><div class=""> The ``SQLFORM`` constructor allows various customizations, such as displaying on</div><div class=""> </div><div class=""> The class ``SQLFORM`` is defined in &quot;gluon/sqlhtml.py&quot;. It can be easily extended by overriding its ``xml`` method, the method that serializes the objects, to change its output.</div><div class=""> </div><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class=""> SQLFORM(table, record = None,</div><div class="">         deletable = False, linkto = None,</div><div class="">         upload = None, fields = None, labels = None,</div><div class="">         col3 = {}, submit_button = &#x27;Submit&#x27;,</div><div class="">         delete_label = &#x27;Check to delete:&#x27;,</div><div class="">         showid = True, readonly = False,</div><div class="">         comments = True, keepopts = [],</div><div class="">         ignore_rw = False, record_id = None,</div><div class="">         formstyle = &#x27;table3cols&#x27;,</div><div class="">         buttons = [&#x27;submit&#x27;], separator = &#x27;: &#x27;,</div><div class="">         **attributes)</div><div class=""> </div><div class=""> ``:code</div><div class=""> - The optional second argument turns the INSERT form into an UPDATE form for the specified record (see next subsection). ``showid``:inxx ``delete_label``:inxx ``id_label``:inxx ``submit_button``:inxx</div><div class="delete">- If ``deletable`` is set to ``True``, the UPDATE form displays a &quot;Check to delete&quot; checkbox. The value of the label <span class="highlight">i</span>f<span class="highlight"></span> this field is set via the ``delete_label`` argument.</div><div class=""> - ``submit_button`` sets the value of the submit button.</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> ``:code</div><div class=""> - ``linkto`` and ``upload`` are optional URLs to user-defined controllers that allow the form to deal with reference fields. This is discussed in more detail later in the section.</div><div class=""> - ``readonly``. If set to True, displays the form as readonly</div><div class=""> - ``comments``. If set to False, does not display the col3 comments</div><div class=""> - ``ignore_rw``. Normally, for a create/update form, only fields marked as writable=True are shown, and for readonly forms, only fields marked as readable=True are shown. Setting ``ignore_rw=True`` causes those constraints to be ignored, and all fields are displayed. This is mostly used in the appadmin interface to display all fields for each table, overriding what the model indicates.</div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class="delete">Because the function that contains the grid may itself manipulate the command line arguments, the grid needs to know which args should be handled by the grid and which not. <span class="highlight">For</span> example <span class="highlight">here is an example </span>of code that allows one to manage any table:</div></div></div>
</div>
<hr />





<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/9ca549ebbdf32a059b682fa3299049073a1ee27d">9ca549e</a><ul><li>Date : 2013-02-19</li><li>Added text about creating SQLFORM.factory with form=SQLFORM.factory(*fields)</li></ul></li></ul>
<div class="row-fluid" id="com_9ca549ebbdf32a059b682fa3299049073a1ee27d">
    <div class="span6"><div class="diff"><div class="insert">+The Field object in the SQLFORM.factory() constructor is fully documented in the DAL chapter.</div><div class="insert">+A run-time construction technique for SQLFORM.factory() is</div><div class="insert">+``</div><div class="insert">+fields = []</div><div class="insert">+fields.append(Field(...))</div><div class="insert">+form=SQLFORM.factory(*fields)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class="insert">+</div><div class="insert">+</div><div class=""> #### One form for multiple tables</div></div></div>
    <div class="span6"><div class="diff"><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class=""> #### One form for multiple tables</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/bd59eba2e974f5812ef1a16eeb67c6e70f1be664">bd59eba</a><ul><li>Date : 2013-02-05</li><li>revised reference to the views chapter for more ways of modifying FORM helpers</li></ul></li></ul>
<div class="row-fluid" id="com_bd59eba2e974f5812ef1a16eeb67c6e70f1be664">
    <div class="span6"><div class="diff"><div class="insert">+#### More about manipulation of FORMs</div><div class="insert">+As discussed in the Views chapter, a FORM is an HTML helper. Helpers can be manipulated as Python lists and as dictionaries, which enables run-time creation and modification.</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-#### Dynamically creating forms</div><div class="delete">-A helper (a FORM) acts as a list. You can append(), insert() and del its elements.</div><div class="delete">-</div><div class="delete">-For example:</div><div class="delete">-``</div><div class="delete">-form.append(SPAN(LABEL(I),&quot;:&quot;,INPUT(_name=l)))</div><div class="delete">-``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/b5ec2af9b064c76ede72c312a0520bda83fa6c97">b5ec2af</a><ul><li>Date : 2013-02-04</li><li>moved license</li></ul></li></ul>
<div class="row-fluid" id="com_b5ec2af9b064c76ede72c312a0520bda83fa6c97">
    <div class="span6"><div class="diff"><div class="insert">``FORM`` and ``SQLFORM`` are helpers and they can be manipulated in a<span class="highlight"></span> similar way as the ``DIV``. For example you can set a form style:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(..)</div><div class=""> form[&#x27;_style&#x27;]=&#x27;border:1px solid black&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### ``FORM``</div><div class=""> ``form``:inxx ``accepts``:inxx ``formname``:inxx</div><div class=""> </div><div class=""> Consider as an example a **test** application with the following &quot;default.py&quot; controller:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">     return dict()</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the associated &quot;default/display_form.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> &lt;h2&gt;Input form&lt;/h2&gt;</div><div class=""> &lt;form enctype=&quot;multipart/form-data&quot;</div><div class="">       action=&quot;{{=URL()}}&quot; method=&quot;post&quot;&gt;</div><div class=""> Your name:</div><div class=""> &lt;input name=&quot;name&quot; /&gt;</div><div class=""> &lt;input type=&quot;submit&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> &lt;h2&gt;Submitted variables&lt;/h2&gt;</div><div class=""> {{=BEAUTIFY(request.vars)}}</div><div class=""> ``:code</div><div class=""> </div><div class="insert">This is a regular HTML form that asks for the user&#x27;s name. When you fill the form and click the submit button, the form self-submits, and the variable ``request.vars.name`` a<span class="highlight">long with its </span>p<span class="highlight">rovided value is disp</span>layed at the bottom.</div><div class=""> </div><div class="insert">You can generate the same form using helpers. This can be done in the view or in the action. Since web2py processed the form in the action, it is <span class="highlight">better</span> to define the form in the action<span class="highlight"> itself</span>.</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">``FORM`` and ``SQLFORM`` are helpers and they can be manipulated in a<span class="highlight">s</span> similar way as the ``DIV``. For example you can set a form style:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM(..)</div><div class=""> form[&#x27;_style&#x27;]=&#x27;border:1px solid black&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### ``FORM``</div><div class=""> ``form``:inxx ``accepts``:inxx ``formname``:inxx</div><div class=""> </div><div class=""> Consider as an example a **test** application with the following &quot;default.py&quot; controller:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">     return dict()</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the associated &quot;default/display_form.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> &lt;h2&gt;Input form&lt;/h2&gt;</div><div class=""> &lt;form enctype=&quot;multipart/form-data&quot;</div><div class="">       action=&quot;{{=URL()}}&quot; method=&quot;post&quot;&gt;</div><div class=""> Your name:</div><div class=""> &lt;input name=&quot;name&quot; /&gt;</div><div class=""> &lt;input type=&quot;submit&quot; /&gt;</div><div class=""> &lt;/form&gt;</div><div class=""> &lt;h2&gt;Submitted variables&lt;/h2&gt;</div><div class=""> {{=BEAUTIFY(request.vars)}}</div><div class=""> ``:code</div><div class=""> </div><div class="delete">This is a regular HTML form that asks for the user&#x27;s name. When you fill the form and click the submit button, the form self-submits, and the variable ``request.vars.name`` a<span class="highlight">nd its value is dis</span>p<span class="highlight"></span>layed at the bottom.</div><div class=""> </div><div class="delete">You can generate the same form using helpers. This can be done in the view or in the action. Since web2py processed the form in the action, it is <span class="highlight">OK</span> to define the form in the action<span class="highlight"></span>.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/d864cef3b68d807ffe8dbc10c26845734fefb97b">d864cef</a><ul><li>Date : 2013-02-04</li><li>fixed all but chap 6</li></ul></li></ul>
<div class="row-fluid" id="com_d864cef3b68d807ffe8dbc10c26845734fefb97b">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="insert">config = dict(color=&#x27;black&#x27;, language=&#x27;<span class="highlight">E</span>nglish&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you need a form to allow the visitor to modify this dictionary.</div><div class=""> This can be done with:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM.dictform(config)</div><div class=""> if form.process().accepted: config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The form will display one INPUT field for each item in the dictionary. It will use dictionary keys as INPUT names and labels and current values to infer types (string, int, double, date, datetime, boolean).</div><div class=""> </div><div class=""> This works great but leave to you the logic of making the config dictionary persistent. For example you may want to store the ``config`` in a session.</div><div class=""> </div><div class=""> ``</div><div class="insert">session.config or dict(color=&#x27;black&#x27;, language=&#x27;<span class="highlight">E</span>nglish&#x27;)</div><div class=""> form = SQLFORM.dictform(session.config)</div><div class=""> if form.process().accepted:</div><div class="">     session.config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> For example, to have a &quot;string&quot; field represented by a textarea:</div><div class=""> Field(&#x27;comment&#x27;, &#x27;string&#x27;, widget=SQLFORM.widgets.text.widget)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Widgets can also be assigned to fields &#x27;&#x27;a posteriori&#x27;&#x27;:</div><div class=""> </div><div class=""> ``</div><div class=""> db.mytable.myfield.widget = SQLFORM.widgets.string.widget</div><div class=""> ``</div><div class=""> </div><div class=""> Sometimes widgets take additional arguments and one needs to specify their values. In this case one can use ``lambda``</div><div class=""> </div><div class=""> ``</div><div class=""> db.mytable.myfield.widget = lambda field,value: \</div><div class="">     SQLFORM.widgets.string.widget(field,value,_style=&#x27;color:blue&#x27;)</div><div class=""> ``</div><div class=""> </div><div class=""> Widgets are helper factories and their first two arguments are always ``field`` and ``value``. The other arguments can include normal helper attributes such as ``_style``, ``_class``, etc. Some widgets also take special arguments. In particular ``SQLFORM.widgets.radio`` and ``SQLFORM.widgets.checkboxes`` take a ``style`` argument (not to be confused with ``_style``) which can be set to &quot;table&quot;, &quot;ul&quot;, or &quot;divs&quot; in order to match the ``formstyle`` of the containing form.</div><div class=""> </div><div class=""> You can create new widgets or extend existing widgets.</div><div class=""> </div><div class="insert">``SQLFORM.widgets[type]`` is a class and ``SQLFORM.widgets[type].widget`` is a static member function of the corresponding class. Each widget function takes two arguments: the field object, and the current value of that field. It returns a representation of the widget. As an example, the string widget could be re<span class="highlight">-</span>coded as follows:</div><div class=""> ``</div><div class=""> def my_string_widget(field, value):</div><div class="">     return INPUT(_name=field.name,</div><div class="">                  _id=&quot;%s_%s&quot; % (field._tablename, field.name),</div><div class="">                  _class=field.type,</div><div class="">                  _value=value,</div><div class="">                  requires=field.requires)</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="delete">config = dict(color=&#x27;black&#x27;, language=&#x27;<span class="highlight">e</span>nglish&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you need a form to allow the visitor to modify this dictionary.</div><div class=""> This can be done with:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM.dictform(config)</div><div class=""> if form.process().accepted: config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The form will display one INPUT field for each item in the dictionary. It will use dictionary keys as INPUT names and labels and current values to infer types (string, int, double, date, datetime, boolean).</div><div class=""> </div><div class=""> This works great but leave to you the logic of making the config dictionary persistent. For example you may want to store the ``config`` in a session.</div><div class=""> </div><div class=""> ``</div><div class="delete">session.config or dict(color=&#x27;black&#x27;, language=&#x27;<span class="highlight">e</span>nglish&#x27;)</div><div class=""> form = SQLFORM.dictform(session.config)</div><div class=""> if form.process().accepted:</div><div class="">     session.config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> For example, to have a &quot;string&quot; field represented by a textarea:</div><div class=""> Field(&#x27;comment&#x27;, &#x27;string&#x27;, widget=SQLFORM.widgets.text.widget)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Widgets can also be assigned to fields &#x27;&#x27;a posteriori&#x27;&#x27;:</div><div class=""> </div><div class=""> ``</div><div class=""> db.mytable.myfield.widget = SQLFORM.widgets.string.widget</div><div class=""> ``</div><div class=""> </div><div class=""> Sometimes widgets take additional arguments and one needs to specify their values. In this case one can use ``lambda``</div><div class=""> </div><div class=""> ``</div><div class=""> db.mytable.myfield.widget = lambda field,value: \</div><div class="">     SQLFORM.widgets.string.widget(field,value,_style=&#x27;color:blue&#x27;)</div><div class=""> ``</div><div class=""> </div><div class=""> Widgets are helper factories and their first two arguments are always ``field`` and ``value``. The other arguments can include normal helper attributes such as ``_style``, ``_class``, etc. Some widgets also take special arguments. In particular ``SQLFORM.widgets.radio`` and ``SQLFORM.widgets.checkboxes`` take a ``style`` argument (not to be confused with ``_style``) which can be set to &quot;table&quot;, &quot;ul&quot;, or &quot;divs&quot; in order to match the ``formstyle`` of the containing form.</div><div class=""> </div><div class=""> You can create new widgets or extend existing widgets.</div><div class=""> </div><div class="delete">``SQLFORM.widgets[type]`` is a class and ``SQLFORM.widgets[type].widget`` is a static member function of the corresponding class. Each widget function takes two arguments: the field object, and the current value of that field. It returns a representation of the widget. As an example, the string widget could be re<span class="highlight"></span>coded as follows:</div><div class=""> ``</div><div class=""> def my_string_widget(field, value):</div><div class="">     return INPUT(_name=field.name,</div><div class="">                  _id=&quot;%s_%s&quot; % (field._tablename, field.name),</div><div class="">                  _class=field.type,</div><div class="">                  _value=value,</div><div class="">                  requires=field.requires)</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/588bb98fc4707b9e90172a5490f44644e776f0a0">588bb98</a><ul><li>Date : 2013-02-04</li><li>Helpers, like FORM, are lists</li></ul></li></ul>
<div class="row-fluid" id="com_588bb98fc4707b9e90172a5490f44644e776f0a0">
    <div class="span6"><div class="diff"><div class="insert">+#### Dynamically creating forms</div><div class="insert">+A helper (a FORM) acts as a list. You can append(), insert() and del its elements.</div><div class="insert">+</div><div class="insert">+For example:</div><div class="insert">+``</div><div class="insert">+form.append(SPAN(LABEL(I),&quot;:&quot;,INPUT(_name=l)))</div><div class="insert">+``:code</div><div class="insert">+ </div><div class=""> ### ``SQLFORM``</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ### ``SQLFORM``</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/77e0846262922b8d1f776f23ca079114677b4048">77e0846</a><ul><li>Date : 2012-12-28</li><li>fixed comment-&gt;post</li></ul></li></ul>
<div class="row-fluid" id="com_77e0846262922b8d1f776f23ca079114677b4048">
    <div class="span6"><div class="diff"><div class=""> The ``SQLFORM``, upon deleting a record, does not delete the physical uploaded file(s) referenced by the record. The reason is that web2py does not know whether the same file is used/linked by other tables or used for other purpose. If you know it is safe to delete the actual file when the corresponding record is deleted, you can do the following:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="insert">    Field(&#x27;<span class="highlight">sourc</span>e&#x27;,&#x27;upload&#x27;,autodelete=True))</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``autodelete`` attribute is ``False`` by default. When set to ``True`` is makes sure the file is deleted when the record is deleted.</div><div class=""> </div><div class=""> #### Links to referencing records</div><div class=""> </div><div class=""> Now consider the case of two tables linked by a reference field. For example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.define_table(&#x27;dog&#x27;,</div><div class="">     Field(&#x27;owner&#x27;, &#x27;reference person&#x27;),</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.dog.owner.requires = IS_IN_DB(db,db.person.id,&#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> A person has dogs, and each dog belongs to an owner, which is a person. The dog owner is required to reference a valid ``db.person.id`` by ``&#x27;%(name)s&#x27;``.</div><div class=""> </div><div class=""> Let&#x27;s use the **appadmin** interface for this application to add a</div><div class=""> few persons and their dogs.</div><div class=""> In the case of a table including an &quot;upload&quot;-type field (&quot;fieldname&quot;), both ``pr</div><div class=""> The name assigned by web2py to the uploaded file can be found in:</div><div class=""> ``</div><div class=""> form.vars.fieldname</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### Other types of Forms</div><div class=""> </div><div class=""> #### ``SQLFORM.factory``</div><div class=""> </div><div class=""> There are cases when you want to generate forms &#x27;&#x27;as if&#x27;&#x27; you had a database table but you do not want the database table. You simply want to take advantage of the ``SQLFORM`` capability to generate a nice looking CSS-friendly form and perhaps perform file upload and renaming.</div><div class=""> </div><div class=""> This can be done via a ``form_factory``. Here is an example where you generate the form, perform validation, upload a file and store everything in the ``session`` :</div><div class=""> ``</div><div class=""> def form_from_factory():</div><div class="">     form = SQLFORM.factory(</div><div class="">         Field(&#x27;your_name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">         Field(&#x27;your_image&#x27;, &#x27;upload&#x27;))</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">         session.your_name = form.vars.your_name</div><div class="insert">        session.<span class="highlight">your_</span>i<span class="highlight">m</span>a<span class="highlight">g</span>e = form.vars.your_image</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class=""> #### One form for multiple tables</div><div class=""> </div><div class=""> db.define_table(&#x27;mytable&#x27;,</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is nothing special about these fields and you may give them any name you like. They are filled before the record is archived and are archived with each copy of the record.  The archive table name and/or reference field name can be changed like this:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;myhistory&#x27;,</div><div class="">     Field(&#x27;parent_record&#x27;, &#x27;reference mytable&#x27;),</div><div class="">     db.mytable)</div><div class=""> ## ...</div><div class=""> form = SQLFORM(db.mytable,myrecord)</div><div class=""> form.process(onsuccess = lambda form:auth.archive(form,</div><div class="">              archive_table=db.myhistory,</div><div class="">              current_record=&#x27;parent_record&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### Custom forms</div><div class=""> </div><div class=""> If a form is created with SQLFORM, SQLFORM.factory or CRUD, there are multiple ways it can be embedded in a view allowing multiple degrees of customization. Consider for example the following model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="insert">+    Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="insert">+    Field(&#x27;source&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="">     return dict(form=SQLFORM(db.image).process())</div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class=""> Image name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class="insert">Image file: &lt;div&gt;{{=form.custom.widget.<span class="highlight">sourc</span>e}}&lt;/div&gt;</div><div class=""> Click here to upload: {{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class=""> A similar result could have been obtained without using a custom form:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM(...,formstyle=&#x27;table2cols&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or in case of CRUD forms with the following parameter:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent,left=db.child.on(db.child.parent==db.parent.id))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.smartgrid you can put all the data in one gadget that spawns both tables:</div><div class=""> </div><div class=""> ``</div><div class="insert">@auth.requires_login()<span class="highlight"></span></div><div class=""> def manage():</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The ``SQLFORM``, upon deleting a record, does not delete the physical uploaded file(s) referenced by the record. The reason is that web2py does not know whether the same file is used/linked by other tables or used for other purpose. If you know it is safe to delete the actual file when the corresponding record is deleted, you can do the following:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="delete">    Field(&#x27;<span class="highlight">fil</span>e&#x27;,&#x27;upload&#x27;,autodelete=True))</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``autodelete`` attribute is ``False`` by default. When set to ``True`` is makes sure the file is deleted when the record is deleted.</div><div class=""> </div><div class=""> #### Links to referencing records</div><div class=""> </div><div class=""> Now consider the case of two tables linked by a reference field. For example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.define_table(&#x27;dog&#x27;,</div><div class="">     Field(&#x27;owner&#x27;, &#x27;reference person&#x27;),</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.dog.owner.requires = IS_IN_DB(db,db.person.id,&#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> A person has dogs, and each dog belongs to an owner, which is a person. The dog owner is required to reference a valid ``db.person.id`` by ``&#x27;%(name)s&#x27;``.</div><div class=""> </div><div class=""> Let&#x27;s use the **appadmin** interface for this application to add a</div><div class=""> few persons and their dogs.</div><div class=""> In the case of a table including an &quot;upload&quot;-type field (&quot;fieldname&quot;), both ``pr</div><div class=""> The name assigned by web2py to the uploaded file can be found in:</div><div class=""> ``</div><div class=""> form.vars.fieldname</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### Other types of Forms</div><div class=""> </div><div class=""> #### ``SQLFORM.factory``</div><div class=""> </div><div class=""> There are cases when you want to generate forms &#x27;&#x27;as if&#x27;&#x27; you had a database table but you do not want the database table. You simply want to take advantage of the ``SQLFORM`` capability to generate a nice looking CSS-friendly form and perhaps perform file upload and renaming.</div><div class=""> </div><div class=""> This can be done via a ``form_factory``. Here is an example where you generate the form, perform validation, upload a file and store everything in the ``session`` :</div><div class=""> ``</div><div class=""> def form_from_factory():</div><div class="">     form = SQLFORM.factory(</div><div class="">         Field(&#x27;your_name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">         Field(&#x27;your_image&#x27;, &#x27;upload&#x27;))</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">         session.your_name = form.vars.your_name</div><div class="delete">        session.<span class="highlight">f</span>i<span class="highlight">len</span>a<span class="highlight">m</span>e = form.vars.your_image</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class=""> #### One form for multiple tables</div><div class=""> </div><div class=""> db.define_table(&#x27;mytable&#x27;,</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is nothing special about these fields and you may give them any name you like. They are filled before the record is archived and are archived with each copy of the record.  The archive table name and/or reference field name can be changed like this:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;myhistory&#x27;,</div><div class="">     Field(&#x27;parent_record&#x27;, &#x27;reference mytable&#x27;),</div><div class="">     db.mytable)</div><div class=""> ## ...</div><div class=""> form = SQLFORM(db.mytable,myrecord)</div><div class=""> form.process(onsuccess = lambda form:auth.archive(form,</div><div class="">              archive_table=db.myhistory,</div><div class="">              current_record=&#x27;parent_record&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ### Custom forms</div><div class=""> </div><div class=""> If a form is created with SQLFORM, SQLFORM.factory or CRUD, there are multiple ways it can be embedded in a view allowing multiple degrees of customization. Consider for example the following model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;image&#x27;,</div><div class="delete">-    Field(&#x27;name&#x27;),</div><div class="delete">-    Field(&#x27;file&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="">     return dict(form=SQLFORM(db.image).process())</div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class=""> Image name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class="delete">Image file: &lt;div&gt;{{=form.custom.widget.<span class="highlight">fil</span>e}}&lt;/div&gt;</div><div class=""> Click here to upload: {{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class=""> A similar result could have been obtained without using a custom form:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM(...,formstyle=&#x27;table2cols&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or in case of CRUD forms with the following parameter:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent,left=db.child.on(db.child.parent==db.parent.id))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.smartgrid you can put all the data in one gadget that spawns both tables:</div><div class=""> </div><div class=""> ``</div><div class="delete">@auth.requires_login()<span class="highlight">:</span></div><div class=""> def manage():</div><div class="">     grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="">     return locals()</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/c482e34c27660c375ad9174f7c87d3df40a6eb62">c482e34</a><ul><li>Date : 2012-12-28</li><li>Typos</li></ul></li></ul>
<div class="row-fluid" id="com_c482e34c27660c375ad9174f7c87d3df40a6eb62">
    <div class="span6"><div class="diff"><div class="insert">Often you need<span class="highlight"> a form with a confirmation</span> choice. The form should be accepted if the choice is accepted and none otherwise. The form may have additional options that link other web pages. web2py provides a simple way to do this:</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">Often you need<span class="highlight">s a form with to confirma</span> choice. The form should be accepted if the choice is accepted and none otherwise. The form may have additional options that link other web pages. web2py provides a simple way to do this:</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/a6910f421c90f921dd54c06026a1ea1177a416aa">a6910f4</a><ul><li>Date : 2012-12-28</li><li>removed duplicated IS_LOWER</li></ul></li></ul>
<div class="row-fluid" id="com_a6910f421c90f921dd54c06026a1ea1177a416aa">
    <div class="span6"><div class="diff"><div class=""> ##### ``IS_UPPER``</div><div class=""> ``IS_UPPER``:inxx</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-##### ``IS_LOWER``</div><div class="delete">-``IS_LOWER``:inxx</div><div class="delete">-</div><div class="delete">-This validator never returns an error. It converts the value to lower case.</div><div class="delete">-``</div><div class="delete">-requires = IS_LOWER()</div><div class="delete">-``:code</div><div class="delete">-</div><div class=""> ##### ``IS_UPPER``</div><div class=""> ``IS_UPPER``:inxx</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/097d699dc16179206ccb7e4aee863d6523cd471c">097d699</a><ul><li>Date : 2012-12-27</li><li>fixed typo, thanks Andrew</li></ul></li></ul>
<div class="row-fluid" id="com_097d699dc16179206ccb7e4aee863d6523cd471c">
    <div class="span6"><div class="diff"><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class=""> SQLFORM(table, record = None,</div><div class="">         deletable = False, linkto = None,</div><div class="">         upload = None, fields = None, labels = None,</div><div class="">         col3 = {}, submit_button = &#x27;Submit&#x27;,</div><div class="">         delete_label = &#x27;Check to delete:&#x27;,</div><div class="">         showid = True, readonly = False,</div><div class="">         comments = True, keepopts = [],</div><div class="">         ignore_rw = False, record_id = None,</div><div class="">         formstyle = &#x27;table3cols&#x27;,</div><div class="insert"><span class="highlight">        </span>buttons = [&#x27;submit&#x27;], separator = &#x27;: &#x27;,</div><div class="">         **attributes)</div><div class=""> </div><div class=""> ``:code</div><div class=""> - The optional second argument turns the INSERT form into an UPDATE form for the specified record (see next subsection). ``showid``:inxx ``delete_label``:inxx ``id_label``:inxx ``submit_button``:inxx</div><div class=""> - If ``deletable`` is set to ``True``, the UPDATE form displays a &quot;Check to delete&quot; checkbox. The value of the label if this field is set via the ``delete_label`` argument.</div><div class=""> - ``submit_button`` sets the value of the submit button.</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> crud.settings.delete_next = URL(&#x27;index&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify the URL to be used for linking uploaded files:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.download_url = URL(&#x27;download&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after standard validation procedures for ``crud.create`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onvalidation = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``StorageList`` is the same as a ``Storage`` object, they are both defined in the file &quot;gluon/storage.py&quot;, but it defaults to ``[]`` as opposed to ``None``. It allows the following syntax:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onvalidation.mytablename.append(lambda form:....)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">To specify extra functions to be executed after<span class="highlight">        </span>standard validation procedures for ``crud.update`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.update_onvalidation = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.create`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onaccept = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.update`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.update_onaccept = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.update`` if record is deleted:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` is the only gadget in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ..., singular=&quot;Child&quot;, plural=&quot;Children&quot;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or with: ``singular``:inxx ``plural``:inxx</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ...)</div><div class=""> db.child._singular = &quot;Child&quot;</div><div class=""> db.child._plural = &quot;Children&quot;</div><div class=""> ``:code</div><div class=""> </div><div class=""> They should also be internationalized using the ``T`` operator.</div><div class=""> </div><div class=""> The plural and singular values are then used by ``smartgrid``</div><div class=""> to provide correct names for headers and links.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``fields``:inxx ``labels``:inxx</div><div class=""> The signature for the ``SQLFORM`` constructor is the following:</div><div class=""> ``</div><div class=""> SQLFORM(table, record = None,</div><div class="">         deletable = False, linkto = None,</div><div class="">         upload = None, fields = None, labels = None,</div><div class="">         col3 = {}, submit_button = &#x27;Submit&#x27;,</div><div class="">         delete_label = &#x27;Check to delete:&#x27;,</div><div class="">         showid = True, readonly = False,</div><div class="">         comments = True, keepopts = [],</div><div class="">         ignore_rw = False, record_id = None,</div><div class="">         formstyle = &#x27;table3cols&#x27;,</div><div class="delete"><span class="highlight">	</span>buttons = [&#x27;submit&#x27;], separator = &#x27;: &#x27;,</div><div class="">         **attributes)</div><div class=""> </div><div class=""> ``:code</div><div class=""> - The optional second argument turns the INSERT form into an UPDATE form for the specified record (see next subsection). ``showid``:inxx ``delete_label``:inxx ``id_label``:inxx ``submit_button``:inxx</div><div class=""> - If ``deletable`` is set to ``True``, the UPDATE form displays a &quot;Check to delete&quot; checkbox. The value of the label if this field is set via the ``delete_label`` argument.</div><div class=""> - ``submit_button`` sets the value of the submit button.</div><div class=""> - ``id_label`` sets the label of the record &quot;id&quot;</div><div class=""> - The &quot;id&quot; of the record is not shown if ``showid`` is set to ``False``.</div><div class=""> - ``fields`` is an optional list of field names that you want to display. If a list is provided, only fields in the list are displayed. For example:</div><div class=""> ``</div><div class=""> fields = [&#x27;name&#x27;]</div><div class=""> ``:code</div><div class=""> - ``labels`` is a dictionary of field labels. The dictionary key is a field name and the corresponding value is what gets displayed as its label. If a label is not provided, web2py derives the label from the field name (it capitalizes the field name and replaces underscores with spaces). For example:</div><div class=""> ``</div><div class=""> labels = {&#x27;name&#x27;:&#x27;Your Full Name:&#x27;}</div><div class=""> ``:code</div><div class=""> - ``col3`` is a dictionary of values for the third column. For example:</div><div class=""> ``</div><div class=""> col3 = {&#x27;name&#x27;:A(&#x27;what is this?&#x27;,</div><div class="">       _href=&#x27;http://www.google.com/search?q=define:name&#x27;)}</div><div class=""> crud.settings.delete_next = URL(&#x27;index&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify the URL to be used for linking uploaded files:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.download_url = URL(&#x27;download&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after standard validation procedures for ``crud.create`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onvalidation = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``StorageList`` is the same as a ``Storage`` object, they are both defined in the file &quot;gluon/storage.py&quot;, but it defaults to ``[]`` as opposed to ``None``. It allows the following syntax:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onvalidation.mytablename.append(lambda form:....)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">To specify extra functions to be executed after<span class="highlight">	</span>standard validation procedures for ``crud.update`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.update_onvalidation = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.create`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.create_onaccept = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.update`` forms:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.update_onaccept = StorageList()</div><div class=""> ``:code</div><div class=""> </div><div class=""> To specify extra functions to be executed after completion of ``crud.update`` if record is deleted:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` is the only gadget in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ..., singular=&quot;Child&quot;, plural=&quot;Children&quot;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or with: ``singular``:inxx ``plural``:inxx</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ...)</div><div class=""> db.child._singular = &quot;Child&quot;</div><div class=""> db.child._plural = &quot;Children&quot;</div><div class=""> ``:code</div><div class=""> </div><div class=""> They should also be internationalized using the ``T`` operator.</div><div class=""> </div><div class=""> The plural and singular values are then used by ``smartgrid``</div><div class=""> to provide correct names for headers and links.</div><div class="delete">-</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/49f38ab7ef56de1eb4ef48f68427ebf8a46b505d">49f38ab</a><ul><li>Date : 2012-12-26</li><li>more small edits</li></ul></li></ul>
<div class="row-fluid" id="com_49f38ab7ef56de1eb4ef48f68427ebf8a46b505d">
    <div class="span6"><div class="diff"><div class=""> The plural and singular values are then used by ``smartgrid``</div><div class=""> to provide correct names for headers and links.</div><div class="insert">+</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The plural and singular values are then used by ``smartgrid``</div><div class=""> to provide correct names for headers and links.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/eaaa0e14bf17cdc4d0edd2ea9daa9af5f3484c09">eaaa0e1</a><ul><li>Date : 2012-12-25</li><li>changes to style</li></ul></li></ul>
<div class="row-fluid" id="com_eaaa0e14bf17cdc4d0edd2ea9daa9af5f3484c09">
    <div class="span6"><div class="diff"><div class="insert">    <span class="highlight">buttonview=&#x27;icon magnifier&#x27;</span>)</div><div class=""> ``:code</div><div class="insert">+</div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``showbutton`` allows to turn off all buttons.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as </div><div class="insert">+  </div><div class="insert">+``</div><div class="insert">+csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class="insert">+csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class="insert">+xml=(ExporterXML, &#x27;XML&#x27;),</div><div class="insert">+html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class="insert">+tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class="insert">+tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. If you pass a dict like ``dict(xml=False, html=False)`` you will disable the xml and html export formats.</div><div class="insert">+</div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> def manage():</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class="insert"><span class="highlight">``:co</span>de<span class="highlight"></span></div><div class=""> </div><div class="insert">+In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> -------</div><div class=""> The grid and smartgrid gadgets are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class="insert"><span class="highlight"></span>``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class="insert"><span class="highlight"></span>``:code</div><div class=""> </div><div class=""> The ``smartgrid`` is the only gadget in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ..., singular=&quot;Child&quot;, plural=&quot;Children&quot;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or with: ``singular``:inxx ``plural``:inxx</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ...)</div><div class=""> db.child._singular = &quot;Child&quot;</div><div class=""> db.child._plural = &quot;Children&quot;</div><div class=""> ``:code</div><div class=""> </div><div class=""> They should also be internationalized using the ``T`` operator.</div><div class=""> </div><div class="insert">+The plural and singular values are then used by ``smartgrid``</div><div class="insert">+to provide correct names for headers and links.</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-    buttonview=&#x27;icon magnifier&#x27;</div><div class="delete">    <span class="highlight"></span>)</div><div class=""> ``:code</div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbuttontext`` allows to have buttons without text (there will effectively be only icons)</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``showbutton`` allows to turn off all buttons.</div><div class=""> - ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as </div><div class="delete">-  ``csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class="delete">-    csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class="delete">-    xml=(ExporterXML, &#x27;XML&#x27;),</div><div class="delete">-    html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class="delete">-    tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class="delete">-    tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class="delete">-``:code</div><div class="delete">-  ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. </div><div class="delete">-  If you pass a dict like</div><div class="delete">-  ``dict(</div><div class="delete">-    xml=False,</div><div class="delete">-    html=False</div><div class="delete">-    )</div><div class="delete">-``:code you will disable the xml and html export formats.</div><div class=""> - ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> - ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> def manage():</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class=""> ``:code</div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class="delete">-````:code</div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class="delete">-````:code</div><div class="delete"><span class="highlight">In this way we ma</span>de<span class="highlight"> parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</span></div><div class=""> </div><div class=""> </div><div class=""> -------</div><div class=""> The grid and smartgrid gadgets are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class="delete"><span class="highlight">``</span>``:code</div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class="delete"><span class="highlight">``</span>``:code</div><div class=""> </div><div class=""> The ``smartgrid`` is the only gadget in web2py that displays the table name and it need both the singular and the plural. For example one parent can have one &quot;Child&quot; or many &quot;Children&quot;. Therefore a table object needs to know its own singular and plural names. web2py normally guesses them but you can set the explicitly:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ..., singular=&quot;Child&quot;, plural=&quot;Children&quot;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> or with: ``singular``:inxx ``plural``:inxx</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;child&#x27;, ...)</div><div class=""> db.child._singular = &quot;Child&quot;</div><div class=""> db.child._plural = &quot;Children&quot;</div><div class=""> ``:code</div><div class=""> </div><div class=""> They should also be internationalized using the ``T`` operator.</div><div class=""> </div><div class="delete">-The plural and singular values are then used by ``smartgrid`` to provide correct names for headers and links.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/77c615188200e8a913f15370ef4b371c94908182">77c6151</a><ul><li>Date : 2012-12-24</li><li>added form.custom.delete</li></ul></li></ul>
<div class="row-fluid" id="com_77c615188200e8a913f15370ef4b371c94908182">
    <div class="span6"><div class="diff"><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="insert">    return dict(form=<span class="highlight">SQLFORM</span>(db.image)<span class="highlight">.process(</span>)<span class="highlight">)</span></div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class=""> Image name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class=""> Image file: &lt;div&gt;{{=form.custom.widget.file}}&lt;/div&gt;</div><div class=""> Click here to upload: {{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class="insert">+A similar result could have been obtained without using a custom form:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+SQLFORM(...,formstyle=&#x27;table2cols&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+or in case of CRUD forms with the following parameter:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class="insert"><span class="highlight"></span>Other possible ``formstyle``s are &quot;table3cols&quot; (the default), &quot;divs&quot; and &quot;ul&quot;.</div><div class=""> </div><div class=""> If you do not wish to use the widgets serialized by web2py, you can replace them with HTML. There are some variables that will be useful for this:</div><div class=""> - ``form.custom.label[fieldname]`` contains the label for the field.</div><div class=""> - ``form.custom.comment[fieldname]`` contains the comment for the field.</div><div class=""> - ``form.custom.dspval[fieldname]`` form-type and field-type dependent display representation of the field.</div><div class=""> - ``form.custom.inpval[fieldname]`` form-type and field-type dependent values to be used in field code.</div><div class=""> </div><div class="insert">+If you form has ``deletable=True`` you should also insert</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+{{=form.custom.delete}}</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+to display the delete checkbox.</div><div class="insert">+</div><div class=""> It is important to follow the conventions described below.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> and upload action</div><div class=""> ``</div><div class=""> def upload_image():</div><div class="delete">    return dict(form=<span class="highlight">crud.create</span>(db.image)<span class="highlight"></span>)<span class="highlight"></span></div><div class=""> ``:code</div><div class=""> </div><div class=""> The simplest way to embed the form in the view for ``upload_image`` is</div><div class=""> ``</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> This results in a standard table layout. If you wish to use a different layout, you can break the form into components</div><div class=""> ``</div><div class=""> {{=form.custom.begin}}</div><div class=""> Image name: &lt;div&gt;{{=form.custom.widget.name}}&lt;/div&gt;</div><div class=""> Image file: &lt;div&gt;{{=form.custom.widget.file}}&lt;/div&gt;</div><div class=""> Click here to upload: {{=form.custom.submit}}</div><div class=""> {{=form.custom.end}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> where ``form.custom.widget[fieldname]`` gets serialized into the proper widget for the field. If the form is submitted and it contains errors, they are appended below the widgets, as usual.</div><div class=""> </div><div class=""> The above sample form is show in the image below.</div><div class=""> </div><div class=""> [[image @///image/en6500.png center 300px]]</div><div class=""> </div><div class="delete">-Notice that a similar result could have been obtained with:</div><div class=""> </div><div class=""> ``</div><div class=""> crud.settings.formstyle=&#x27;table2cols&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class="delete"><span class="highlight">without using a custom form. </span>Other possible ``formstyle``s are &quot;table3cols&quot; (the default), &quot;divs&quot; and &quot;ul&quot;.</div><div class=""> </div><div class=""> If you do not wish to use the widgets serialized by web2py, you can replace them with HTML. There are some variables that will be useful for this:</div><div class=""> - ``form.custom.label[fieldname]`` contains the label for the field.</div><div class=""> - ``form.custom.comment[fieldname]`` contains the comment for the field.</div><div class=""> - ``form.custom.dspval[fieldname]`` form-type and field-type dependent display representation of the field.</div><div class=""> - ``form.custom.inpval[fieldname]`` form-type and field-type dependent values to be used in field code.</div><div class=""> </div><div class=""> It is important to follow the conventions described below.</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/89985891355b955b825fd874d470a5e6f09e8d92">8998589</a><ul><li>Date : 2012-12-20</li><li>fixed formatting bug</li></ul></li></ul>
<div class="row-fluid" id="com_89985891355b955b825fd874d470a5e6f09e8d92">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class="delete">-``</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/94fc4e6bc3687fcf3cacb3a587bb3e0b2b71cfd0">94fc4e6</a><ul><li>Date : 2012-12-20</li><li>better grid documentation, thanks Niphlod</li></ul></li></ul>
<div class="row-fluid" id="com_94fc4e6bc3687fcf3cacb3a587bb3e0b2b71cfd0">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class="insert">+``:code</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class="insert">``<span class="highlight">:code</span></div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class="insert">+To make the default search grid work in more than one LOADed grid, please use a different ``formname`` for each one.</div><div class=""> -----</div><div class=""> </div><div class=""> Because the function that contains the grid may itself manipulate the command line arguments, the grid needs to know which args should be handled by the grid and which not. For example here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class="insert">``<span class="highlight">:code</span></div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the gadget. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the gadget.</div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class="insert">+SQLFORM.grid(</div><div class="insert">+    query,</div><div class="insert">+    fields=None,</div><div class="insert">+    field_id=None,</div><div class="insert">+    left=None,</div><div class="insert">+    headers={},</div><div class="insert">+    orderby=None,</div><div class="insert">+    groupby=None,</div><div class="insert">+    searchable=True,</div><div class="insert">+    sortable=True,</div><div class="insert">+    paginate=20,</div><div class="insert">+    deletable=True,</div><div class="insert">+    editable=True,</div><div class="insert">+    details=True,</div><div class="insert">+    selectable=None,</div><div class="insert">+    create=True,</div><div class="insert">+    csv=True,</div><div class="insert">+    links=None,</div><div class="insert">+    links_in_grid=True,</div><div class="insert">+    upload=&#x27;&lt;default&gt;&#x27;,</div><div class="insert">+    args=[],</div><div class="insert">+    user_signature=True,</div><div class="insert">+    maxtextlengths={},</div><div class="insert">+    maxtextlength=20,</div><div class="insert">+    onvalidation=None,</div><div class="insert">+    oncreate=None,</div><div class="insert">+    onupdate=None,</div><div class="insert">+    ondelete=None,</div><div class="insert">+    sorter_icons=(XML(&#x27;&amp;#x2191;&#x27;), XML(&#x27;&amp;#x2193;&#x27;)),</div><div class="insert">+    ui = &#x27;web2py&#x27;,</div><div class="insert">+    showbuttontext=True,</div><div class="insert">+    _class=&quot;web2py_grid&quot;,</div><div class="insert">+    formname=&#x27;web2py_grid&#x27;,</div><div class="insert">+    search_widget=&#x27;default&#x27;,</div><div class="insert">+    ignore_rw = False,</div><div class="insert">+    formstyle = &#x27;table3cols&#x27;,</div><div class="insert">+    exportclasses = None,</div><div class="insert">+    formargs={},</div><div class="insert">+    createargs={},</div><div class="insert">+    editargs={},</div><div class="insert">+    viewargs={},</div><div class="insert">+    buttons_placement = &#x27;right&#x27;,</div><div class="insert">+    links_placement = &#x27;right&#x27;</div><div class="insert">+    )</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view.</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class="insert">+- ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label, e.g. ``{&#x27;auth_user.email&#x27; : &#x27;Email Address&#x27;}``</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class="insert">+- ``groupby`` is used to group the set. Use the same syntax as you were passing in a simple ``select(groupby=...)``.</div><div class="insert">+- ``searchable``, ``sortable``, ``deletable``, ``editable``, ``details``, ``create`` determine whether one can search, sort, delete, edit, view details, and create new records respectively.</div><div class="insert">+- ``selectable`` can be used to call a custom function on multiple records (a checkbox will be inserted for every row) e.g.</div><div class="insert">+  ``</div><div class="insert">+   selectable = lambda ids : redirect(URL(&#x27;default&#x27;, &#x27;mapping_multiple&#x27;, vars=dict(id=ids)))</div><div class="insert">+``:code</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class="insert">+- ``csv`` if set to true allows to download the grid in various format (more on that later).</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class="insert">+- ``links_in_grid`` if set to False, links will only be displayed in the &quot;details&quot; and &quot;edit&quot; page (so, not on the main grid)</div><div class="insert">+- ``upload`` same as SQLFORM&#x27;s one. web2py uses the action at that URL to download the file</div><div class="insert">+- ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length e.g. ``{&#x27;auth_user.email&#x27; : 50}``</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input.</div><div class=""> - ``sorter_icons`` is a list of two strings (or helpers) that will be used to represent the up and down sorting options for each field.</div><div class=""> - ``ui`` can be set equal to &#x27;web2py&#x27; and will generate web2py friendly class names, can be set equal to ``jquery-ui`` and will generate jquery UI friendly class names, but it can also be its own set of class names for the various grid components:</div><div class="insert">+  ``</div><div class="insert">+ui = dict(</div><div class="insert">+    widget=&#x27;&#x27;,</div><div class="insert">+    header=&#x27;&#x27;,</div><div class="insert">+    content=&#x27;&#x27;,</div><div class="insert">+    default=&#x27;&#x27;,</div><div class="insert">+    cornerall=&#x27;&#x27;,</div><div class="insert">+    cornertop=&#x27;&#x27;,</div><div class="insert">+    cornerbottom=&#x27;&#x27;,</div><div class="insert">+    button=&#x27;button&#x27;,</div><div class="insert">+    buttontext=&#x27;buttontext button&#x27;,</div><div class="insert">+    buttonadd=&#x27;icon plus&#x27;,</div><div class="insert">+    buttonback=&#x27;icon leftarrow&#x27;,</div><div class="insert">+    buttonexport=&#x27;icon downarrow&#x27;,</div><div class="insert">+    buttondelete=&#x27;icon trash&#x27;,</div><div class="insert">+    buttonedit=&#x27;icon pen&#x27;,</div><div class="insert">+    buttontable=&#x27;icon rightarrow&#x27;,</div><div class="insert">+    buttonview=&#x27;icon magnifier&#x27;</div><div class="insert">+    )</div><div class=""> ``:code</div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class="insert">- ``showbutton<span class="highlight">text</span>`` allows to <span class="highlight">h</span>a<span class="highlight">ve</span> buttons<span class="highlight"> without text (there will effectively be only icons)</span></div><div class=""> - ``_class`` is the class for the grid container.</div><div class="insert">+- ``showbutton`` allows to turn off all buttons.</div><div class="insert">+- ``exportclasses`` takes a dictionary of tuples: by default it&#x27;s defined as </div><div class="insert">+  ``csv_with_hidden_cols=(ExporterCSV, &#x27;CSV (hidden cols)&#x27;),</div><div class="insert">+    csv=(ExporterCSV, &#x27;CSV&#x27;),</div><div class="insert">+    xml=(ExporterXML, &#x27;XML&#x27;),</div><div class="insert">+    html=(ExporterHTML, &#x27;HTML&#x27;),</div><div class="insert">+    tsv_with_hidden_cols=(ExporterTSV, &#x27;TSV (Excel compatible, hidden cols)&#x27;),</div><div class="insert">+    tsv=(ExporterTSV, &#x27;TSV (Excel compatible)&#x27;))</div><div class="insert">+``:code</div><div class="insert">+  ExporterCSV, ExporterXML, ExporterHTML and ExporterTSV are all defined in gluon/sqlhtml.py. Take a look at those for creating your own exporter. </div><div class="insert">+  If you pass a dict like</div><div class="insert">+  ``dict(</div><div class="insert">+    xml=False,</div><div class="insert">+    html=False</div><div class="insert">+    )</div><div class="insert">+``:code you will disable the xml and html export formats.</div><div class="insert">+- ``formargs`` is passed to all SQLFORM objects used by the grid, while ``createargs``,``editargs`` and ``viewargs`` are passed only to the specific create, edit and details SQLFORMs</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class="insert"><span class="highlight">- ``buttons_placement`` and ``links_placement`` both take a parameter (&#x27;right&#x27;, &#x27;left&#x27;, &#x27;both&#x27;) that will affect where on the row the buttons (or the links) will be placed</span></div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> def manage():</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class="insert">+- ``divider`` allows to specify a character to use in the breadcrumb navigator, ``breadcrumbs_class`` will apply the class to the breadcrumb element</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="insert">``<span class="highlight">:code</span></div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class="insert">``<span class="highlight">``:code</span></div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class="insert">``<span class="highlight">``:code</span></div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> </div><div class=""> -------</div><div class=""> The grid and smartgrid gadgets are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class="insert">``<span class="highlight">``:code</span></div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class="insert">``<span class="highlight">``:code</span></div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> ``</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user,user_signature=False)</div><div class="">     return locals()</div><div class="delete">``<span class="highlight"></span></div><div class=""> </div><div class=""> but we do not recommend it.</div><div class=""> </div><div class=""> -----</div><div class=""> Because of the way grid works one can only have one grid per controller function, unless they are embedded as components via ``LOAD``.</div><div class=""> -----</div><div class=""> </div><div class=""> Because the function that contains the grid may itself manipulate the command line arguments, the grid needs to know which args should be handled by the grid and which not. For example here is an example of code that allows one to manage any table:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class="delete">``<span class="highlight"></span></div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the gadget. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the gadget.</div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class="delete">-SQLFORM.grid(query,</div><div class="delete">-             fields=None,</div><div class="delete">-             field_id=None,</div><div class="delete">-             left=None,</div><div class="delete">-             headers={},</div><div class="delete">-             orderby=None,</div><div class="delete">-	     groupby=None,</div><div class="delete">-             searchable=True,</div><div class="delete">-             sortable=True,</div><div class="delete">-             deletable=True,</div><div class="delete">-             editable=True,</div><div class="delete">-             details=True,</div><div class="delete">-             create=True,</div><div class="delete">-             csv=True,</div><div class="delete">-             paginate=20,</div><div class="delete">-             selectable=None,</div><div class="delete">-             links=None,</div><div class="delete">-             upload = &#x27;&lt;default&gt;&#x27;,</div><div class="delete">-             args=[],</div><div class="delete">-             user_signature = True,</div><div class="delete">-             maxtextlengths={},</div><div class="delete">-             maxtextlength=20,</div><div class="delete">-             onvalidation=None,</div><div class="delete">-             oncreate=None,</div><div class="delete">-             onupdate=None,</div><div class="delete">-             ondelete=None,</div><div class="delete">-             sorter_icons=(&#x27;[^]&#x27;,&#x27;[v]&#x27;),</div><div class="delete">-             ui = &#x27;web2py&#x27;,</div><div class="delete">-             showbuttontext=True,</div><div class="delete">-             search_widget=&#x27;default&#x27;,</div><div class="delete">-             _class=&quot;web2py_grid&quot;,</div><div class="delete">-             formname=&#x27;web2py_grid&#x27;,</div><div class="delete">-             ignore_rw = False,</div><div class="delete">-             formstyle = &#x27;table3cols&#x27;):</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``fields`` is a list of fields to be fetched from the database. It is also used to determine which fields to be shown in the grid view.</div><div class=""> - ``field_id`` must be the field of the table to be used as ID, for example ``db.mytable.id``.</div><div class="delete">-- ``headers`` is a dictionary that maps &#x27;tablename.fieldname&#x27; into the corresponding header label.</div><div class=""> - ``left`` is an optional left join expressions used to build ``...select(left=...)``.</div><div class=""> - ``orderby`` is used as default ordering for the rows.</div><div class="delete">-- ``searchable``, ``sortable``, ``deletable``, ``details``, ``create`` determine whether one can search, sort, delete, view details, and create new records respectively.</div><div class="delete">-- ``csv`` if set to true allows to download the grid in CSV.</div><div class=""> - ``paginate`` sets the max number of rows per page.</div><div class=""> - ``links`` is used to display new columns which can be links to other pages. The ``links`` argument must be a list of  ``dict(header=&#x27;name&#x27;,body=lambda row: A(...))`` where ``header`` is the header of the new column and ``body`` is a function that takes a row and returns a value. In the example, the value is a ``A(...)`` helper.</div><div class="delete">-- ``maxtextlength`` sets the maximum length of text to be displayed for each field value, in the grid view. This value can be overwritten for each field using ``maxtextlengths``, a dictionary of &#x27;tablename.fieldname&#x27;:length.</div><div class=""> - ``onvalidation``, ``oncreate``, ``onupdate`` and ``ondelete`` are callback functions. All but ``ondelete`` take a form object as input.</div><div class=""> - ``sorter_icons`` is a list of two strings (or helpers) that will be used to represent the up and down sorting options for each field.</div><div class=""> - ``ui`` can be set equal to &#x27;web2py&#x27; and will generate web2py friendly class names, can be set equal to ``jquery-ui`` and will generate jquery UI friendly class names, but it can also be its own set of class names for the various grid components:</div><div class="delete">-</div><div class="delete">-``</div><div class="delete">-ui = dict(widget=&#x27;&#x27;,</div><div class="delete">-          header=&#x27;&#x27;,</div><div class="delete">-          content=&#x27;&#x27;,</div><div class="delete">-          default=&#x27;&#x27;,</div><div class="delete">-          cornerall=&#x27;&#x27;,</div><div class="delete">-          cornertop=&#x27;&#x27;,</div><div class="delete">-          cornerbottom=&#x27;&#x27;,</div><div class="delete">-          button=&#x27;button&#x27;,</div><div class="delete">-          buttontext=&#x27;buttontext button&#x27;,</div><div class="delete">-          buttonadd=&#x27;icon plus&#x27;,</div><div class="delete">-          buttonback=&#x27;icon leftarrow&#x27;,</div><div class="delete">-          buttonexport=&#x27;icon downarrow&#x27;,</div><div class="delete">-          buttondelete=&#x27;icon trash&#x27;,</div><div class="delete">-          buttonedit=&#x27;icon pen&#x27;,</div><div class="delete">-          buttontable=&#x27;icon rightarrow&#x27;,</div><div class="delete">-          buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class="delete">-</div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class="delete">- ``showbutton<span class="highlight"></span>`` allows to <span class="highlight">turn off </span>a<span class="highlight">ll</span> buttons<span class="highlight">.</span></div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class="delete"><span class="highlight"></span></div><div class=""> ------</div><div class=""> ``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corresponding button or not.</div><div class=""> -----</div><div class=""> </div><div class=""> A ``SQLFORM.smartgrid`` looks a lot like a ``grid``, in fact it contains a grid but it is designed to take as input not a query but only one table and to browse said table and selected referencing tables.</div><div class=""> </div><div class=""> For example consider the following table structure:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;parent&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;child&#x27;,Field(&#x27;name&#x27;),Field(&#x27;parent&#x27;,&#x27;reference parent&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> With SQLFORM.grid you can list all parents:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> def manage():</div><div class=""> ``:code</div><div class=""> </div><div class=""> If the ``linked_tables`` argument is not specified all referencing tables are automatically linked. Anyway, to avoid accidentally exposing data we recommend explicitly listing tables that should be linked.</div><div class=""> </div><div class=""> The following code creates a very powerful management interface for all tables in the system:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_membership(&#x27;managers&#x27;):</div><div class=""> def manage():</div><div class="">     table = request.args(0) or &#x27;auth_user&#x27;</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.smartgrid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``smartgrid`` takes the same arguments as a ``grid`` and some more with some caveats:</div><div class=""> </div><div class=""> - The first argument is a table, not a query</div><div class=""> - There is a extra argument ``constraints`` which is a dictionary of &#x27;tablename&#x27;:query which can be used to further restrict access to the records displayed in the &#x27;tablename&#x27; grid.</div><div class=""> - There is a extra argument ``linked_tables`` which is a list of tablenames of tables that should be accessible via the smartgrid.</div><div class=""> - All the arguments but the table, ``args``, ``linked_tables`` and ``user_signatures`` can be dictionaries as explained below.</div><div class=""> </div><div class=""> Consider the previous grid:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;])</div><div class="delete">``<span class="highlight"></span></div><div class=""> It allows one to access both a ``db.parent`` and a ``db.child``. Apart for navigation controls, for each one table, a smarttable is nothing but a grid. This means that, in this case, one smartgrid can create a grid for parent and one grid for child. We may want to pass different sets of parameters to these grids. For example different sets of ``searchable`` parameters.</div><div class=""> </div><div class=""> While for a grid we would pass a boolean:</div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.parent,searchable=True)</div><div class="delete">``<span class="highlight"></span></div><div class=""> for a smartgrid we would pass a dictionary of booleans:</div><div class=""> ``</div><div class=""> grid = SQLFORM.smartgrid(db.parent,linked_tables=[&#x27;child&#x27;],</div><div class="">      searchable= dict(parent=True, child=False))</div><div class="delete">``<span class="highlight"></span></div><div class=""> In this way we made parents searchable but children for each parent not searchable (there should not be that many to need the search widget).</div><div class=""> </div><div class=""> </div><div class=""> -------</div><div class=""> The grid and smartgrid gadgets are here to stay but they are marked experimental because the actual html layout of what they return and the exact set of parameters one can pass to them  may be subject to change as new functionalities are added.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> ``grid`` and ``smartgrid`` do not automatically enforce access control like crud does but you can integrate it with ``auth`` using explicit permission checking:</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_membership(&#x27;managers&#x27;),</div><div class="">      deletable = auth.has_membership(&#x27;managers&#x27;))</div><div class="delete">``<span class="highlight"></span></div><div class=""> </div><div class=""> or</div><div class=""> </div><div class=""> ``</div><div class=""> grid = SQLFORM.grid(db.auth_user,</div><div class="">      editable = auth.has_permission(&#x27;edit&#x27;,&#x27;auth_user&#x27;),</div><div class="">      deletable = auth.has_permission(&#x27;delete&#x27;,&#x27;auth_user&#x27;))</div><div class="delete">``<span class="highlight"></span></div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/82dc64e7baa231edd3896ca7a0d41393e426f123">82dc64e</a><ul><li>Date : 2012-12-19</li><li>lots of small additions</li></ul></li></ul>
<div class="row-fluid" id="com_82dc64e7baa231edd3896ca7a0d41393e426f123">
    <div class="span6"><div class="diff"><div class="insert">+------</div><div class=""> Notice that ``crud.messages`` belongs to the class ``gluon.storage.Message`` which is similar to ``gluon.storage.Storage`` but it automatically translates its values, without need for the ``T`` operator.</div><div class="insert">+------</div><div class=""> </div><div class=""> Log messages are used if and only if CRUD is connected to Auth as discussed in Chapter 9. The events are logged in the Auth table &quot;auth_events&quot;.</div><div class=""> </div><div class=""> #### Methods</div><div class=""> </div><div class=""> The behavior of CRUD methods can also be customized on a per call basis. Here are their signatures:</div><div class=""> ``</div><div class=""> crud.tables()</div><div class=""> crud.create(table, next, onvalidation, onaccept, log, message)</div><div class=""> crud.read(table, record)</div><div class=""> crud.update(table, record, next, onvalidation, onaccept, ondelete, log, message, deletable)</div><div class=""> crud.delete(table, record_id, next, message)</div><div class=""> crud.select(table, query, fields, orderby, limitby, headers, **attr)</div><div class=""> crud.search(table, query, queries, query_labels, fields, field_labels, zero, showall, chkall)</div><div class=""> ``:code</div><div class=""> - ``table`` is a DAL table or a tablename the method should act on.</div><div class=""> - ``record`` and ``record_id`` are the id of the record the method should act on.</div><div class=""> - ``next`` is the URL to redirect to after success. If the URL contains the substring &quot;[id]&quot; this will be replaced by the id of the record currently created/updated.</div><div class=""> - ``onvalidation`` has the same function as SQLFORM(..., onvalidation)</div><div class=""> - ``onaccept`` is a function to be called after the form submission is accepted and acted upon, but before redirection.</div><div class=""> requires = IS_MATCH(&#x27;^\d{1,3}(\.\d{1,3}){3}$&#x27;,</div><div class=""> </div><div class=""> Here is an example of usage to validate a US phone number:</div><div class=""> ``</div><div class=""> requires = IS_MATCH(&#x27;^1?((-)\d{3}-?|\(\d{3}\))\d{3}-?\d{4}$&#x27;,</div><div class="">          error_message=&#x27;not a phone number&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For more information on Python regular expressions, refer to the official Python documentation.</div><div class=""> </div><div class=""> ``IS_MATCH`` takes an optional argument ``strict`` which defaults to ``False``. When set to ``True`` it only matches the beginning of the string:</div><div class=""> </div><div class=""> ``</div><div class=""> &gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;)(&#x27;ba&#x27;)</div><div class=""> (&#x27;ba&#x27;, &lt;lazyT &#x27;invalid expression&#x27;&gt;) # no pass</div><div class=""> &gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;,strict=False)(&#x27;ab&#x27;)</div><div class=""> (&#x27;a&#x27;, None)                          # pass!</div><div class=""> ``</div><div class=""> </div><div class=""> ``IS_MATCH`` takes an other optional argument ``search`` which defaults to ``False``. When set to ``True``, it uses regex method ``search`` instead of method ``match`` to validate the string.</div><div class=""> </div><div class="insert">+``IS_MATCH(&#x27;...&#x27;, extract=True)`` filters and extract only the first matching </div><div class="insert">+substring rather than the original value.</div><div class="insert">+</div><div class=""> ##### ``IS_NOT_EMPTY``</div><div class=""> ``IS_NOT_EMPTY``:inxx</div></div></div>
    <div class="span6"><div class="diff"><div class=""> Notice that ``crud.messages`` belongs to the class ``gluon.storage.Message`` which is similar to ``gluon.storage.Storage`` but it automatically translates its values, without need for the ``T`` operator.</div><div class=""> </div><div class=""> Log messages are used if and only if CRUD is connected to Auth as discussed in Chapter 9. The events are logged in the Auth table &quot;auth_events&quot;.</div><div class=""> </div><div class=""> #### Methods</div><div class=""> </div><div class=""> The behavior of CRUD methods can also be customized on a per call basis. Here are their signatures:</div><div class=""> ``</div><div class=""> crud.tables()</div><div class=""> crud.create(table, next, onvalidation, onaccept, log, message)</div><div class=""> crud.read(table, record)</div><div class=""> crud.update(table, record, next, onvalidation, onaccept, ondelete, log, message, deletable)</div><div class=""> crud.delete(table, record_id, next, message)</div><div class=""> crud.select(table, query, fields, orderby, limitby, headers, **attr)</div><div class=""> crud.search(table, query, queries, query_labels, fields, field_labels, zero, showall, chkall)</div><div class=""> ``:code</div><div class=""> - ``table`` is a DAL table or a tablename the method should act on.</div><div class=""> - ``record`` and ``record_id`` are the id of the record the method should act on.</div><div class=""> - ``next`` is the URL to redirect to after success. If the URL contains the substring &quot;[id]&quot; this will be replaced by the id of the record currently created/updated.</div><div class=""> - ``onvalidation`` has the same function as SQLFORM(..., onvalidation)</div><div class=""> - ``onaccept`` is a function to be called after the form submission is accepted and acted upon, but before redirection.</div><div class=""> requires = IS_MATCH(&#x27;^\d{1,3}(\.\d{1,3}){3}$&#x27;,</div><div class=""> </div><div class=""> Here is an example of usage to validate a US phone number:</div><div class=""> ``</div><div class=""> requires = IS_MATCH(&#x27;^1?((-)\d{3}-?|\(\d{3}\))\d{3}-?\d{4}$&#x27;,</div><div class="">          error_message=&#x27;not a phone number&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> For more information on Python regular expressions, refer to the official Python documentation.</div><div class=""> </div><div class=""> ``IS_MATCH`` takes an optional argument ``strict`` which defaults to ``False``. When set to ``True`` it only matches the beginning of the string:</div><div class=""> </div><div class=""> ``</div><div class=""> &gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;)(&#x27;ba&#x27;)</div><div class=""> (&#x27;ba&#x27;, &lt;lazyT &#x27;invalid expression&#x27;&gt;) # no pass</div><div class=""> &gt;&gt;&gt; IS_MATCH(&#x27;a&#x27;,strict=False)(&#x27;ab&#x27;)</div><div class=""> (&#x27;a&#x27;, None)                          # pass!</div><div class=""> ``</div><div class=""> </div><div class=""> ``IS_MATCH`` takes an other optional argument ``search`` which defaults to ``False``. When set to ``True``, it uses regex method ``search`` instead of method ``match`` to validate the string.</div><div class=""> </div><div class=""> ##### ``IS_NOT_EMPTY``</div><div class=""> ``IS_NOT_EMPTY``:inxx</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/704f1913e25162dcf68e21710945bd58d04b0b85">704f191</a><ul><li>Date : 2012-12-12</li><li>Document CRYPT's salt parameter; correct identification of pbkdf2 hash algorithm</li></ul></li></ul>
<div class="row-fluid" id="com_704f1913e25162dcf68e21710945bd58d04b0b85">
    <div class="span6"><div class="diff"><div class="insert">By default, CRYPT uses 1000 iterations of the pbkdf2 algorithm combined with SHA<span class="highlight">5</span>1<span class="highlight">2</span> to produce a 20-byte-long hash. Older versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class=""> </div><div class=""> If a key is specified, CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> This is the recommended syntax. The key must be a unique string associated with the database used. The key can never be changed. If you lose the key, the previously hashed values become useless.</div><div class=""> </div><div class="insert">+By default, CRYPT uses random salt, such that each result is different. To use a constant salt value, specify its value:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+requires = CRYPT(salt=&#x27;mysaltvalue&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Or, to use no salt:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+requires = CRYPT(salt=False)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument, which defaults to zero.</div><div class=""> </div><div class="insert">+The resulting hash takes the form ``alg$salt$hash``, where ``alg`` is the hash algorithm used, ``salt`` is the salt string (which can be empty), and ``hash`` is the algorithm&#x27;s output. Consequently, the hash is self-identifying, allowing, for example, the algorithm to be changed without invalidating previous hashes. The key, however, must remain the same.</div><div class="insert">+</div><div class=""> #### Database validators</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">By default, CRYPT uses 1000 iterations of the pbkdf2 algorithm combined with SHA<span class="highlight"></span>1<span class="highlight"></span> to produce a 20-byte-long hash. Older versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class=""> </div><div class=""> If a key is specified, CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> This is the recommended syntax. The key must be a unique string associated with the database used. The key can never be changed. If you lose the key, the previously hashed values become useless.</div><div class=""> </div><div class=""> The CRYPT validator hashes its input, and this makes it somewhat special. If you need to validate a password field before it is hashed, you can use CRYPT in a list of validators, but must make sure it is the last of the list, so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument, which defaults to zero.</div><div class=""> </div><div class=""> #### Database validators</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/2ed9a599998afba93644ff8a38f44b3b5bb4468e">2ed9a59</a><ul><li>Date : 2012-09-14</li><li>fixed example or linkto, thanks martzi</li></ul></li></ul>
<div class="row-fluid" id="com_2ed9a599998afba93644ff8a38f44b3b5bb4468e">
    <div class="span6"><div class="diff"><div class=""> If you click on the link you get directed to:</div><div class=""> ``</div><div class="insert">/test/default/list_records/dog?query=d<span class="highlight">b.d</span>og.owner%3D<span class="highlight">%3D</span>5</div><div class=""> ``:code</div><div class=""> </div><div class=""> &quot;list_records&quot; is the specified action, with ``request.args(0)`` set to the name of the referencing table and ``request.vars.query`` set to the SQL query string.</div><div class=""> The query string in the URL</div><div class=""> contains the value &quot;dog.owner=5&quot; appropriately url-encoded</div><div class=""> (web2py decodes this automatically when the URL is parsed).</div><div class=""> </div><div class=""> You can easily implement a very general &quot;list_records&quot; action as follows:</div><div class=""> ``</div><div class=""> def list_records():</div><div class="insert">+    REGEX = re.compile(&#x27;^(\w+)\.(\w+)\.(\w+)\=\=(\d+)$&#x27;)</div><div class="insert">+    match = REGEX.match(request.vars.query)</div><div class="insert">+    if not match:</div><div class="insert">+        redirect(URL(&#x27;error&#x27;))</div><div class="insert">+    table, field, id = match.group(2), match.group(3), match.group(4)</div><div class="insert">+    records = db(db[table][field]==id).select()</div><div class="">     return dict(records=records)</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> If you click on the link you get directed to:</div><div class=""> ``</div><div class="delete">/test/default/list_records/dog?query=d<span class="highlight"></span>og.owner%3D<span class="highlight"></span>5</div><div class=""> ``:code</div><div class=""> </div><div class=""> &quot;list_records&quot; is the specified action, with ``request.args(0)`` set to the name of the referencing table and ``request.vars.query`` set to the SQL query string.</div><div class=""> The query string in the URL</div><div class=""> contains the value &quot;dog.owner=5&quot; appropriately url-encoded</div><div class=""> (web2py decodes this automatically when the URL is parsed).</div><div class=""> </div><div class=""> You can easily implement a very general &quot;list_records&quot; action as follows:</div><div class=""> ``</div><div class=""> def list_records():</div><div class="delete">-    table = request.args(0)</div><div class="delete">-    query = request.vars.query</div><div class="delete">-    records = db(query).select(db[table].ALL)</div><div class="">     return dict(records=records)</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/5c22fefb0f31fbe2f9627b98ae4f95140d42a7a3">5c22fef</a><ul><li>Date : 2012-09-06</li><li>Update sources/29-web2py-english/07.markmin</li></ul></li></ul>
<div class="row-fluid" id="com_5c22fefb0f31fbe2f9627b98ae4f95140d42a7a3">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class="insert">SQLFORM.grid(db.parent,left=db.child.on(db.child.parent=<span class="highlight">=</span>db.parent.id))</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> SQLFORM.grid(db.parent)</div><div class=""> ``:code</div><div class=""> all children:</div><div class=""> ``</div><div class=""> SQLFORM.grid(db.child)</div><div class=""> ``:code</div><div class=""> and all parents and children in one table:</div><div class=""> ``</div><div class="delete">SQLFORM.grid(db.parent,left=db.child.on(db.child.parent=<span class="highlight"></span>db.parent.id))</div><div class=""> ``:code</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/c0da1a23055a3368a1a4b20f5e90fcd6ef18f4f8">c0da1a2</a><ul><li>Date : 2012-09-06</li><li>fix more typos</li></ul></li></ul>
<div class="row-fluid" id="com_c0da1a23055a3368a1a4b20f5e90fcd6ef18f4f8">
    <div class="span6"><div class="diff"><div class=""> Normally uploaded files are stored into &quot;app/uploads&quot; but you can specify an alternate location:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadfolder=&#x27;...&#x27;)</div><div class=""> ``</div><div class="insert">In most operating system, accessi<span class="highlight">n</span>g the file system can become slow when there are many files in the same folder. If you plan to upload more than 1000 files you can ask web2py to organize the uploads in subfolders:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadseparate=True)</div><div class=""> ``</div><div class=""> </div><div class=""> </div><div class=""> #### Storing the original filename</div><div class=""> </div><div class=""> web2py automatically stores the original filename inside the new UUID filename and retrieves it when the file is downloaded. Upon download, the original filename is stored in the content-disposition header of the HTTP response. This is all done transparently without the need for programming.</div><div class=""> </div><div class=""> Occasionally you may want to store the original filename in a database field. In this case, you need to modify the model and add a field to store it in:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;image_filename&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> then you need to modify the controller to handle it:</div><div class=""> ``</div><div class=""> def display_form():</div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> -------</div><div class=""> This only works when the tables don&#x27;t have field names in common.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> #### Confirmation Forms</div><div class=""> </div><div class=""> ``confirm``:inxx</div><div class=""> </div><div class=""> Often you needs a form with to confirma choice. The form should be accepted if the choice is accepted and none otherwise. The form may have additional options that link other web pages. web2py provides a simple way to do this:</div><div class=""> </div><div class=""> ``</div><div class=""> form = FORM.confirm(&#x27;Are you sure?&#x27;)</div><div class=""> if form.accepted: do_what_needs_to_be_done()</div><div class=""> ``:code</div><div class=""> </div><div class="insert">Notice that t<span class="highlight">he</span> confirm form does not need and must not call ``.accepts`` or ``.process`` because this is done internally. You can add buttons with links to the confirmation form in the form of a dictionary of ``{&#x27;value&#x27;:&#x27;link&#x27;}``:</div><div class=""> </div><div class=""> ``</div><div class=""> form = FORM.confirm(&#x27;Are you sure?&#x27;,{&#x27;Back&#x27;:URL(&#x27;other_page&#x27;)})</div><div class=""> if form.accepted: do_what_needs_to_be_done()</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### Form to edit a dictionary</div><div class=""> </div><div class=""> Imagine a system that stores configurations options in a dictionary,</div><div class=""> </div><div class=""> ``</div><div class="insert">config = dict(color=&#x27;black&#x27;, lang<span class="highlight">u</span>a<span class="highlight"></span>ge=&#x27;english&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you need a form to allow the visitor to modify this dictionary.</div><div class=""> This can be done with:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM.dictform(config)</div><div class=""> if form.process().accepted: config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">The form will display one INPUT field for each item in the dictionary. It will use dictionary keys as INPUT names and lab<span class="highlight">el</span>s and current values to infer types (string, int, double, date, datetime, boolean).</div><div class=""> </div><div class=""> This works great but leave to you the logic of making the config dictionary persistent. For example you may want to store the ``config`` in a session.</div><div class=""> </div><div class=""> ``</div><div class="insert">session.config or dict(color=&#x27;black&#x27;, lang<span class="highlight">u</span>a<span class="highlight"></span>ge=&#x27;english&#x27;)</div><div class=""> form = SQLFORM.dictform(session.config)</div><div class=""> if form.process().accepted:</div><div class="">     session.config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> The ``IS_EMPTY_OR`` validator allows this:</div><div class=""> ``</div><div class=""> requires = IS_EMPTY_OR(IS_DATE())</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``CLEANUP``</div><div class=""> ``CLEANUP``:inxx</div><div class=""> </div><div class=""> This is a filter. It never fails. It just removes all characters whose decimal ASCII codes are not in the list [10, 13, 32-127].</div><div class=""> ``</div><div class=""> requires = CLEANUP()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``CRYPT``</div><div class=""> ``CRYPT``:inxx</div><div class=""> </div><div class=""> This is also a filter. It performs a secure hash on the input and it is used to prevent passwords from being passed in the clear to the database.</div><div class=""> ``</div><div class=""> requires = CRYPT()</div><div class=""> ``:code</div><div class=""> </div><div class="insert">By default<span class="highlight">,</span> CRYPT uses <span class="highlight"></span>1000 itera<span class="highlight">tions of the pbkdf2 algorithm </span>c<span class="highlight">o</span>m<span class="highlight">bined with</span> SHA1 to produce a 20<span class="highlight">-byte-</span>long hash. <span class="highlight">O</span>lder versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class=""> </div><div class="insert">If a key is specified<span class="highlight">,</span> CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="insert">This is the recommended syntax. The key <span class="highlight">mu</span>s<span class="highlight"></span>t<span class="highlight"></span> be a unique string associated <span class="highlight">wi</span>t<span class="highlight">h</span> the database used. The key can never be changed. If you lose the key<span class="highlight">,</span> the previously hashed values become useless.</div><div class=""> </div><div class="insert">The CRYPT validator hashe<span class="highlight">s its input,</span> and this makes it somewhat special. If you need to validate a password field<span class="highlight"></span> before it is hash<span class="highlight">ed</span>, you can use CRYPT in a list of validators<span class="highlight">,</span> but must make sure it is the last of the list<span class="highlight">,</span> so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class="insert">``CRYPT`` also takes a ``min_length`` argument<span class="highlight">,</span> which defaults to zero.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class=""> ### ``SQLFORM.grid`` and ``SQLFORM.smartgrid``</div><div class=""> </div><div class=""> -------</div><div class="insert">Attention: grid and smartgrid were experimental prior web2py version 2.0 and <span class="highlight">were </span>vulnerable to information leakage. The grid and smartgrid are no longer experimental<span class="highlight">,</span> but we are still not promising backward com<span class="highlight">patibi</span>lity of the presentation layer of the grid, only of its APIs.</div><div class=""> -------</div><div class=""> </div><div class=""> These are two high level gadgets that create complex CRUD controls. They provide pagination, the ability to browser, search, sort, create, update and delete records from a single gadgets.</div><div class=""> </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> ui = dict(widget=&#x27;&#x27;,</div><div class="">           cornerall=&#x27;&#x27;,</div><div class="">           cornertop=&#x27;&#x27;,</div><div class="">           cornerbottom=&#x27;&#x27;,</div><div class="">           button=&#x27;button&#x27;,</div><div class="">           buttontext=&#x27;buttontext button&#x27;,</div><div class="">           buttonadd=&#x27;icon plus&#x27;,</div><div class="">           buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">           buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">           buttondelete=&#x27;icon trash&#x27;,</div><div class="">           buttonedit=&#x27;icon pen&#x27;,</div><div class="">           buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">           buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbutton`` allows to turn off all buttons.</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> </div><div class=""> ------</div><div class="insert">``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corr<span class="highlight">e</span>sponding button or not.</div><div class=""> -----</div></div></div>
    <div class="span6"><div class="diff"><div class=""> Normally uploaded files are stored into &quot;app/uploads&quot; but you can specify an alternate location:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadfolder=&#x27;...&#x27;)</div><div class=""> ``</div><div class="delete">In most operating system, accessi<span class="highlight"></span>g the file system can become slow when there are many files in the same folder. If you plan to upload more than 1000 files you can ask web2py to organize the uploads in subfolders:</div><div class=""> ``</div><div class=""> Field(&#x27;image&#x27;, &#x27;upload&#x27;, uploadseparate=True)</div><div class=""> ``</div><div class=""> </div><div class=""> </div><div class=""> #### Storing the original filename</div><div class=""> </div><div class=""> web2py automatically stores the original filename inside the new UUID filename and retrieves it when the file is downloaded. Upon download, the original filename is stored in the content-disposition header of the HTTP response. This is all done transparently without the need for programming.</div><div class=""> </div><div class=""> Occasionally you may want to store the original filename in a database field. In this case, you need to modify the model and add a field to store it in:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">     Field(&#x27;image_filename&#x27;),</div><div class="">     Field(&#x27;image&#x27;, &#x27;upload&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> then you need to modify the controller to handle it:</div><div class=""> ``</div><div class=""> def display_form():</div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> -------</div><div class=""> This only works when the tables don&#x27;t have field names in common.</div><div class=""> -------</div><div class=""> </div><div class=""> </div><div class=""> #### Confirmation Forms</div><div class=""> </div><div class=""> ``confirm``:inxx</div><div class=""> </div><div class=""> Often you needs a form with to confirma choice. The form should be accepted if the choice is accepted and none otherwise. The form may have additional options that link other web pages. web2py provides a simple way to do this:</div><div class=""> </div><div class=""> ``</div><div class=""> form = FORM.confirm(&#x27;Are you sure?&#x27;)</div><div class=""> if form.accepted: do_what_needs_to_be_done()</div><div class=""> ``:code</div><div class=""> </div><div class="delete">Notice that t<span class="highlight">eh</span> confirm form does not need and must not call ``.accepts`` or ``.process`` because this is done internally. You can add buttons with links to the confirmation form in the form of a dictionary of ``{&#x27;value&#x27;:&#x27;link&#x27;}``:</div><div class=""> </div><div class=""> ``</div><div class=""> form = FORM.confirm(&#x27;Are you sure?&#x27;,{&#x27;Back&#x27;:URL(&#x27;other_page&#x27;)})</div><div class=""> if form.accepted: do_what_needs_to_be_done()</div><div class=""> ``:code</div><div class=""> </div><div class=""> #### Form to edit a dictionary</div><div class=""> </div><div class=""> Imagine a system that stores configurations options in a dictionary,</div><div class=""> </div><div class=""> ``</div><div class="delete">config = dict(color=&#x27;black&#x27;, lang<span class="highlight"></span>a<span class="highlight">u</span>ge=&#x27;english&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you need a form to allow the visitor to modify this dictionary.</div><div class=""> This can be done with:</div><div class=""> </div><div class=""> ``</div><div class=""> form = SQLFORM.dictform(config)</div><div class=""> if form.process().accepted: config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">The form will display one INPUT field for each item in the dictionary. It will use dictionary keys as INPUT names and lab<span class="highlight">le</span>s and current values to infer types (string, int, double, date, datetime, boolean).</div><div class=""> </div><div class=""> This works great but leave to you the logic of making the config dictionary persistent. For example you may want to store the ``config`` in a session.</div><div class=""> </div><div class=""> ``</div><div class="delete">session.config or dict(color=&#x27;black&#x27;, lang<span class="highlight"></span>a<span class="highlight">u</span>ge=&#x27;english&#x27;)</div><div class=""> form = SQLFORM.dictform(session.config)</div><div class=""> if form.process().accepted:</div><div class="">     session.config.update(form.vars)</div><div class=""> ``:code</div><div class=""> </div><div class=""> </div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> The ``IS_EMPTY_OR`` validator allows this:</div><div class=""> ``</div><div class=""> requires = IS_EMPTY_OR(IS_DATE())</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``CLEANUP``</div><div class=""> ``CLEANUP``:inxx</div><div class=""> </div><div class=""> This is a filter. It never fails. It just removes all characters whose decimal ASCII codes are not in the list [10, 13, 32-127].</div><div class=""> ``</div><div class=""> requires = CLEANUP()</div><div class=""> ``:code</div><div class=""> </div><div class=""> ##### ``CRYPT``</div><div class=""> ``CRYPT``:inxx</div><div class=""> </div><div class=""> This is also a filter. It performs a secure hash on the input and it is used to prevent passwords from being passed in the clear to the database.</div><div class=""> ``</div><div class=""> requires = CRYPT()</div><div class=""> ``:code</div><div class=""> </div><div class="delete">By default<span class="highlight"></span> CRYPT uses <span class="highlight">the </span>1000 itera<span class="highlight"></span>c<span class="highlight">tions of the pbkdf2 algorith</span>m<span class="highlight"> combined with the</span> SHA1 to produce a 20<span class="highlight"> bytes </span>long hash. <span class="highlight"> In o</span>lder versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class=""> </div><div class="delete">If a key is specified<span class="highlight"></span> CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">This is the recommended syntax. The key <span class="highlight">ha</span>s<span class="highlight"> </span>t<span class="highlight">o</span> be a unique string associated <span class="highlight"></span>t<span class="highlight">o</span> the database used. The key can never be changed. If you lose the key<span class="highlight"></span> the previously hashed values become useless.</div><div class=""> </div><div class="delete">The CRYPT validator hashe<span class="highlight">d the input</span> and this makes it somewhat special. If you need to validate a password field<span class="highlight">,</span> before it is hash<span class="highlight"></span>, you can use CRYPT in a list of validators<span class="highlight"></span> but must make sure it is the last of the list<span class="highlight"></span> so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class="delete">``CRYPT`` also takes a ``min_length`` argument<span class="highlight"></span> which defaults to zero.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> </div><div class=""> Consider the following example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> It requires that when you insert a new person, his/her name is not already in the database, ``db``, in the field ``person.name``. As with all other validators this requirement is enforced at the form processing level, not at the database level. This means that there is a small probability that, if two visitors try to concurrently insert records with the same person.name, this results in a race condition and both records are accepted. It is therefore safer to also inform the database that this field should have a unique value:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, unique=True))</div><div class=""> db.person.name.requires = IS_NOT_IN_DB(db, &#x27;person.name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now if a race condition occurs, the database raises an OperationalError and one of the two inserts is rejected.</div><div class=""> </div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class=""> ### ``SQLFORM.grid`` and ``SQLFORM.smartgrid``</div><div class=""> </div><div class=""> -------</div><div class="delete">Attention: grid and smartgrid were experimental prior web2py version 2.0 and <span class="highlight"></span>vulnerable to information leakage. The grid and smartgrid are no longer experimental<span class="highlight"></span> but we are still not promising backward com<span class="highlight">cpatib</span>lity of the presentation layer of the grid, only of its APIs.</div><div class=""> -------</div><div class=""> </div><div class=""> These are two high level gadgets that create complex CRUD controls. They provide pagination, the ability to browser, search, sort, create, update and delete records from a single gadgets.</div><div class=""> </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> ui = dict(widget=&#x27;&#x27;,</div><div class="">           cornerall=&#x27;&#x27;,</div><div class="">           cornertop=&#x27;&#x27;,</div><div class="">           cornerbottom=&#x27;&#x27;,</div><div class="">           button=&#x27;button&#x27;,</div><div class="">           buttontext=&#x27;buttontext button&#x27;,</div><div class="">           buttonadd=&#x27;icon plus&#x27;,</div><div class="">           buttonback=&#x27;icon leftarrow&#x27;,</div><div class="">           buttonexport=&#x27;icon downarrow&#x27;,</div><div class="">           buttondelete=&#x27;icon trash&#x27;,</div><div class="">           buttonedit=&#x27;icon pen&#x27;,</div><div class="">           buttontable=&#x27;icon rightarrow&#x27;,</div><div class="">           buttonview=&#x27;icon magnifier&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> - ``search_widget`` allows to override the default search widget and we refer the reader the source code in &quot;gluon/sqlhtml.py&quot; for details.</div><div class=""> - ``showbutton`` allows to turn off all buttons.</div><div class=""> - ``_class`` is the class for the grid container.</div><div class=""> - ``formname``, ``ignore_rw`` and ``formstyle`` are passed to the SQLFORM objects used by the grid for create/update forms.</div><div class=""> </div><div class=""> ------</div><div class="delete">``deletable``, ``editable`` and ``details`` are usually boolean values but they can be functions which take the row object and decide whether to display the corr<span class="highlight"></span>sponding button or not.</div><div class=""> -----</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/be8da74855713dabb0c2a0a05a7d67002ace209b">be8da74</a><ul><li>Date : 2012-09-02</li><li>more examples</li></ul></li></ul>
<div class="row-fluid" id="com_be8da74855713dabb0c2a0a05a7d67002ace209b">
    <div class="span6"><div class="diff"><div class="insert">+#### Adding buttons to FORMs</div><div class="insert">+</div><div class="insert">+Usually a form provides a single submit button. It is common to want to add a &quot;back&quot; button that instead of submitting the form, directs the visitor to a different page.</div><div class="insert">+</div><div class="insert">+``add_button``:inxx</div><div class="insert">+</div><div class="insert">+This can be done with the ``add_button`` method:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+form.add_button(&#x27;Back&#x27;, URL(&#x27;other_page&#x27;))</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+You can add more than one button to form. The arguments of ``add_button`` are the value of the button (its text) and the url where to redirect to.</div><div class="insert">+</div><div class=""> ### ``SQLFORM``</div><div class=""> </div><div class=""> We now move to the next level by providing the application with a model file:</div><div class=""> ``</div><div class=""> db = DAL(&#x27;sqlite://storage.sqlite&#x27;)</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Modify the controller as follows:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    form = SQLFORM(db.person)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class="">    else:</div><div class="">        response.flash = &#x27;please fill out the form&#x27;</div><div class="">    return dict(form=form)</div><div class=""> ``:code</div><div class=""> if form.process().accepted:</div><div class=""> ``:code</div><div class=""> </div><div class=""> into:</div><div class=""> ``</div><div class=""> form = SQLFORM(db.person,record)</div><div class=""> if form.validate():</div><div class="">     if form.deleted:</div><div class="">         db(db.person.id==record.id).delete()</div><div class="">     else:</div><div class="">         record.update_record(**dict(form.vars))</div><div class="">     response.flash = &#x27;record updated&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> In the case of a table including an &quot;upload&quot;-type field (&quot;fieldname&quot;), both ``process(dbio=False)`` and ``validate()`` deal with the storage of the uploaded file as if ``process(dbio=True)``, the default behavior.</div><div class=""> </div><div class=""> The name assigned by web2py to the uploaded file can be found in:</div><div class=""> ``</div><div class=""> form.vars.fieldname</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+### Other types of Forms</div><div class="insert">+</div><div class="insert">+#### ``SQLFORM.factory``</div><div class=""> </div><div class=""> There are cases when you want to generate forms &#x27;&#x27;as if&#x27;&#x27; you had a database table but you do not want the database table. You simply want to take advantage of the ``SQLFORM`` capability to generate a nice looking CSS-friendly form and perhaps perform file upload and renaming.</div><div class=""> </div><div class=""> This can be done via a ``form_factory``. Here is an example where you generate the form, perform validation, upload a file and store everything in the ``session`` :</div><div class=""> ``</div><div class=""> def form_from_factory():</div><div class="">     form = SQLFORM.factory(</div><div class="">         Field(&#x27;your_name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">         Field(&#x27;your_image&#x27;, &#x27;upload&#x27;))</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">         session.your_name = form.vars.your_name</div><div class="">         session.filename = form.vars.your_image</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> controller:</div><div class=""> ``</div><div class=""> def register():</div><div class="">     form=SQLFORM.factory(db.client,db.address)</div><div class="">     if form.process().accepted:</div><div class="">         id = db.client.insert(**db.client._filter_fields(form.vars))</div><div class="">         form.vars.client=id</div><div class="">         id = db.address.insert(**db.address._filter_fields(form.vars))</div><div class="">         response.flash=&#x27;Thanks for filling the form&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> -------</div><div class=""> This only works when the tables don&#x27;t have field names in common.</div><div class=""> -------</div><div class=""> </div><div class="insert">+</div><div class="insert">+#### Confirmation Forms</div><div class="insert">+</div><div class="insert">+``confirm``:inxx</div><div class="insert">+</div><div class="insert">+Often you needs a form with to confirma choice. The form should be accepted if the choice is accepted and none otherwise. The form may have additional options that link other web pages. web2py provides a simple way to do this:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+form = FORM.confirm(&#x27;Are you sure?&#x27;)</div><div class="insert">+if form.accepted: do_what_needs_to_be_done()</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Notice that teh confirm form does not need and must not call ``.accepts`` or ``.process`` because this is done internally. You can add buttons with links to the confirmation form in the form of a dictionary of ``{&#x27;value&#x27;:&#x27;link&#x27;}``:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+form = FORM.confirm(&#x27;Are you sure?&#x27;,{&#x27;Back&#x27;:URL(&#x27;other_page&#x27;)})</div><div class="insert">+if form.accepted: do_what_needs_to_be_done()</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+#### Form to edit a dictionary</div><div class="insert">+</div><div class="insert">+Imagine a system that stores configurations options in a dictionary,</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+config = dict(color=&#x27;black&#x27;, langauge=&#x27;english&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+and you need a form to allow the visitor to modify this dictionary.</div><div class="insert">+This can be done with:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+form = SQLFORM.dictform(config)</div><div class="insert">+if form.process().accepted: config.update(form.vars)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+The form will display one INPUT field for each item in the dictionary. It will use dictionary keys as INPUT names and lables and current values to infer types (string, int, double, date, datetime, boolean).</div><div class="insert">+</div><div class="insert">+This works great but leave to you the logic of making the config dictionary persistent. For example you may want to store the ``config`` in a session.</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+session.config or dict(color=&#x27;black&#x27;, langauge=&#x27;english&#x27;)</div><div class="insert">+form = SQLFORM.dictform(session.config)</div><div class="insert">+if form.process().accepted:</div><div class="insert">+    session.config.update(form.vars)</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+</div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> ``crud.tables``:inxx ``crud.create``:inxx ``crud.read``:inxx ``crud.update``:inxx ``crud.delete``:inxx ``crud.select``:inxx .</div><div class=""> - ``crud.tables()`` returns a list of tables defined in the database.</div><div class=""> - ``crud.create(db.tablename)`` returns a create form for table tablename.</div><div class=""> - ``crud.read(db.tablename, id)`` returns a readonly form for tablename and record id.</div><div class=""> - ``crud.update(db.tablename, id)`` returns an update form for tablename and record id.</div><div class=""> - ``crud.delete(db.tablename, id)`` deletes the record.</div><div class=""> The first case is easy:</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class="insert">+### ``SQLFORM.grid`` and ``SQLFORM.smartgrid``</div><div class="insert">+</div><div class="insert">+-------</div><div class="insert">+Attention: grid and smartgrid were experimental prior web2py version 2.0 and vulnerable to information leakage. The grid and smartgrid are no longer experimental but we are still not promising backward comcpatiblity of the presentation layer of the grid, only of its APIs.</div><div class="insert">+-------</div><div class=""> </div><div class=""> These are two high level gadgets that create complex CRUD controls. They provide pagination, the ability to browser, search, sort, create, update and delete records from a single gadgets.</div><div class=""> </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> Because the function that contains the grid may itself manipulate the command li</div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the gadget. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the gadget.</div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(query,</div><div class="">              fields=None,</div><div class="">              field_id=None,</div><div class="">              left=None,</div><div class="">              headers={},</div><div class="">              orderby=None,</div><div class="insert">+	     groupby=None,</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ### ``SQLFORM``</div><div class=""> </div><div class=""> We now move to the next level by providing the application with a model file:</div><div class=""> ``</div><div class=""> db = DAL(&#x27;sqlite://storage.sqlite&#x27;)</div><div class=""> db.define_table(&#x27;person&#x27;, Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> Modify the controller as follows:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    form = SQLFORM(db.person)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class="">    elif form.errors:</div><div class="">        response.flash = &#x27;form has errors&#x27;</div><div class="">    else:</div><div class="">        response.flash = &#x27;please fill out the form&#x27;</div><div class="">    return dict(form=form)</div><div class=""> ``:code</div><div class=""> if form.process().accepted:</div><div class=""> ``:code</div><div class=""> </div><div class=""> into:</div><div class=""> ``</div><div class=""> form = SQLFORM(db.person,record)</div><div class=""> if form.validate():</div><div class="">     if form.deleted:</div><div class="">         db(db.person.id==record.id).delete()</div><div class="">     else:</div><div class="">         record.update_record(**dict(form.vars))</div><div class="">     response.flash = &#x27;record updated&#x27;</div><div class=""> ``:code</div><div class=""> </div><div class=""> In the case of a table including an &quot;upload&quot;-type field (&quot;fieldname&quot;), both ``process(dbio=False)`` and ``validate()`` deal with the storage of the uploaded file as if ``process(dbio=True)``, the default behavior.</div><div class=""> </div><div class=""> The name assigned by web2py to the uploaded file can be found in:</div><div class=""> ``</div><div class=""> form.vars.fieldname</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-### ``SQLFORM.factory``</div><div class=""> </div><div class=""> There are cases when you want to generate forms &#x27;&#x27;as if&#x27;&#x27; you had a database table but you do not want the database table. You simply want to take advantage of the ``SQLFORM`` capability to generate a nice looking CSS-friendly form and perhaps perform file upload and renaming.</div><div class=""> </div><div class=""> This can be done via a ``form_factory``. Here is an example where you generate the form, perform validation, upload a file and store everything in the ``session`` :</div><div class=""> ``</div><div class=""> def form_from_factory():</div><div class="">     form = SQLFORM.factory(</div><div class="">         Field(&#x27;your_name&#x27;, requires=IS_NOT_EMPTY()),</div><div class="">         Field(&#x27;your_image&#x27;, &#x27;upload&#x27;))</div><div class="">     if form.process().accepted:</div><div class="">         response.flash = &#x27;form accepted&#x27;</div><div class="">         session.your_name = form.vars.your_name</div><div class="">         session.filename = form.vars.your_image</div><div class="">     elif form.errors:</div><div class="">         response.flash = &#x27;form has errors&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> ``</div><div class=""> controller:</div><div class=""> ``</div><div class=""> def register():</div><div class="">     form=SQLFORM.factory(db.client,db.address)</div><div class="">     if form.process().accepted:</div><div class="">         id = db.client.insert(**db.client._filter_fields(form.vars))</div><div class="">         form.vars.client=id</div><div class="">         id = db.address.insert(**db.address._filter_fields(form.vars))</div><div class="">         response.flash=&#x27;Thanks for filling the form&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> -------</div><div class=""> This only works when the tables don&#x27;t have field names in common.</div><div class=""> -------</div><div class=""> </div><div class=""> ### CRUD</div><div class=""> ``CRUD``:inxx ``crud.create``:inxx ``crud.update``:inxx ``crud.select``:inxx ``crud.search``:inxx ``crud.tables``:inxx ``crud.delete``:inxx</div><div class=""> </div><div class=""> One of the recent additions to web2py is the Create/Read/Update/Delete (CRUD) API on top of SQLFORM.</div><div class=""> CRUD creates an SQLFORM, but it simplifies the coding because it incorporates the creation of the form, the processing of the form, the notification, and the redirection, all in one single function.</div><div class=""> </div><div class=""> The first thing to notice is that CRUD differs from the other web2py APIs we have used so far because it is not already exposed. It must be imported. It also must be linked to a specific database. For example:</div><div class=""> ``</div><div class=""> from gluon.tools import Crud</div><div class=""> crud = Crud(db)</div><div class=""> ``:code</div><div class=""> </div><div class=""> The ``crud`` object defined above provides the following API:</div><div class=""> </div><div class=""> ``crud.tables``:inxx ``crud.create``:inxx ``crud.read``:inxx ``crud.update``:inxx ``crud.delete``:inxx ``crud.select``:inxx .</div><div class=""> - ``crud.tables()`` returns a list of tables defined in the database.</div><div class=""> - ``crud.create(db.tablename)`` returns a create form for table tablename.</div><div class=""> - ``crud.read(db.tablename, id)`` returns a readonly form for tablename and record id.</div><div class=""> - ``crud.update(db.tablename, id)`` returns an update form for tablename and record id.</div><div class=""> - ``crud.delete(db.tablename, id)`` deletes the record.</div><div class=""> The first case is easy:</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, limitby=(0,10), min_length=2)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Where ``limitby`` instructs the widget to display no more than 10 suggestions at the time, and ``min_length`` instructs the widget to perform an Ajax callback to fetch suggestions only after the user has typed at least 2 characters in the search box.</div><div class=""> </div><div class=""> The second case is more complex:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;category&#x27;,Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;product&#x27;,Field(&#x27;name&#x27;),Field(&#x27;category&#x27;))</div><div class=""> db.product.category.widget = SQLFORM.widgets.autocomplete(</div><div class="">      request, db.category.name, id_field=db.category.id)</div><div class=""> ``:code</div><div class=""> </div><div class=""> In this case the value of ``id_field`` tells the widget that even if the value to be autocompleted is a ``db.category.name``, the value to be stored is the corresponding ``db.category.id``. An optional parameter is ``orderby`` that instructs the widget on how to sort the suggestions (alphabetical by default).</div><div class=""> </div><div class=""> This widget works via Ajax. Where is the Ajax callback? Some magic is going on in this widget. The callback is a method of the widget object itself. How is it exposed? In web2py any piece of code can generate a response by raising an HTTP exception. This widget exploits this possibility in the following way: the widget sends the Ajax call to the same URL that generated the widget in the first place and puts a special token in the request.vars. Should the widget get instantiated again, it finds the token and raises an HTTP exception that responds to the request. All of this is done under the hood and hidden to the developer.</div><div class=""> </div><div class="delete">-### ``SQLFORM.grid`` and ``SQLFORM.smartgrid`` (experimental)</div><div class=""> </div><div class=""> These are two high level gadgets that create complex CRUD controls. They provide pagination, the ability to browser, search, sort, create, update and delete records from a single gadgets.</div><div class=""> </div><div class=""> The simplest of the two is ``SQLFORM.grid``. Here is an example of usage:</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage_users():</div><div class="">     grid = SQLFORM.grid(db.auth_user)</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> which produces the following page:</div><div class=""> </div><div class=""> [[image @///image/en6700.png center 480px]]</div><div class=""> </div><div class=""> The first argument of ``SQLFORM.grid`` can be a table or a query. The grid gadget will provide access to records matching the query.</div><div class=""> </div><div class=""> Before we dive into the long list of arguments of the grid gadget we need to understand how it works. The gadget looks at ``request.args`` in order to decide what to do (browse, search, create, update, delete, etc.). Each button created by the gadget links the same function (``manage_users`` in the above case) but passes different ``request.args``. By default all the URL generated by the grid are digitally signed and verified. This means one cannot perform certain actions (create, update, delete) without being logged-in. These restrictions can be relaxed:</div><div class=""> </div><div class=""> Because the function that contains the grid may itself manipulate the command li</div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def manage():</div><div class="">     table = request.args(0)</div><div class="">     if not table in db.tables(): redirect(URL(&#x27;error&#x27;))</div><div class="">     grid = SQLFORM.grid(db[table],args=request.args[:1])</div><div class="">     return locals()</div><div class=""> ``</div><div class=""> </div><div class=""> the ``args`` argument of the ``grid`` specifies which ``request.args`` should be passed along and ignored by the gadget. In our case ``request.args[:1]`` is the name of the table we want to manage and it is handled by the ``manage`` function itself, not by the gadget.</div><div class=""> </div><div class=""> The complete signature for the grid is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> SQLFORM.grid(query,</div><div class="">              fields=None,</div><div class="">              field_id=None,</div><div class="">              left=None,</div><div class="">              headers={},</div><div class="">              orderby=None,</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/ac4003f4349f9ee22c67309ceeb48de5539b0308">ac4003f</a><ul><li>Date : 2012-09-01</li><li>added lots of new features to book</li></ul></li></ul>
<div class="row-fluid" id="com_ac4003f4349f9ee22c67309ceeb48de5539b0308">
    <div class="span6"><div class="diff"><div class="insert">+By default CRYPT uses the 1000 iteractions of the pbkdf2 algorithm combined with the SHA1 to produce a 20 bytes long hash.  In older versions of web2py used &quot;md5&quot; or HMAC+SHA512 depending on whether a key was was specified or not.</div><div class="insert">+</div><div class="insert">+If a key is specified CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> This is the recommended syntax. The key has to be a unique string associated to the database used. The key can never be changed. If you lose the key the previously hashed values become useless.</div><div class=""> </div><div class=""> The CRYPT validator hashed the input and this makes it somewhat special. If you need to validate a password field, before it is hash, you can use CRYPT in a list of validators but must make sure it is the last of the list so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument which defaults to zero.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> </div><div class=""> def index():</div><div class="">     db.table.field.requires=IS_IN_DB(db(query),....)</div><div class="">     form=SQLFORM(...)</div><div class="">     if form.process().accepted: ...</div><div class="">     (...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> If you want the field validated, but you do not want a dropbox, you must put the validator in a list.</div><div class=""> </div><div class=""> ``</div><div class=""> db.dog.owner.requires = [IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``_and``:inxx</div><div class=""> Occasionally you want the drop-box (so you do not want to use the list syntax above) yet you want to use additional validators. For this purpose the ``IS_IN_DB`` validator takes an extra argument ``_and`` that can point to a list of other validators applied if the validated value passes the ``IS_IN_DB`` validation. For example to validate all dog owners in db that are not in a subset:</div><div class=""> ``</div><div class=""> subset=db(db.person.id&gt;100)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  _and=IS_NOT_IN_DB(subset,&#x27;person.id&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class="insert">+``IS_IN_DB`` has a boolean ``distinct`` argument which defaults to ``False``. When set to ``True`` it prevents repeated values in the dropdown.</div><div class="insert">+</div><div class=""> ``IS_IN_DB`` also takes a ``cache`` argument that works like the ``cache`` argument of select.</div><div class=""> </div><div class="insert">+</div><div class=""> ##### ``IS_IN_DB`` and Tagging</div><div class=""> ``tags``:inxx</div><div class=""> ``multiple``:inxx</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-If a key is not specified, it uses the MD5 algorithm. If a key is specified CRYPT uses the HMAC algorithm. The key may contain a prefix that determines the algorithm to use with HMAC, for example SHA512:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = CRYPT(key=&#x27;sha512:thisisthekey&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> This is the recommended syntax. The key has to be a unique string associated to the database used. The key can never be changed. If you lose the key the previously hashed values become useless.</div><div class=""> </div><div class=""> The CRYPT validator hashed the input and this makes it somewhat special. If you need to validate a password field, before it is hash, you can use CRYPT in a list of validators but must make sure it is the last of the list so that it is called last. For example:</div><div class=""> </div><div class=""> ``</div><div class=""> requires = [IS_STRONG(),CRYPT(key=&#x27;sha512:thisisthekey&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``CRYPT`` also takes a ``min_length`` argument which defaults to zero.</div><div class=""> </div><div class=""> #### Database validators</div><div class=""> </div><div class=""> ##### ``IS_NOT_IN_DB``</div><div class=""> ``IS_NOT_IN_DB``:inxx</div><div class=""> </div><div class=""> def index():</div><div class="">     db.table.field.requires=IS_IN_DB(db(query),....)</div><div class="">     form=SQLFORM(...)</div><div class="">     if form.process().accepted: ...</div><div class="">     (...)</div><div class=""> ``:code</div><div class=""> </div><div class=""> If you want the field validated, but you do not want a dropbox, you must put the validator in a list.</div><div class=""> </div><div class=""> ``</div><div class=""> db.dog.owner.requires = [IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;)]</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``_and``:inxx</div><div class=""> Occasionally you want the drop-box (so you do not want to use the list syntax above) yet you want to use additional validators. For this purpose the ``IS_IN_DB`` validator takes an extra argument ``_and`` that can point to a list of other validators applied if the validated value passes the ``IS_IN_DB`` validation. For example to validate all dog owners in db that are not in a subset:</div><div class=""> ``</div><div class=""> subset=db(db.person.id&gt;100)</div><div class=""> db.dog.owner.requires = IS_IN_DB(db, &#x27;person.id&#x27;, &#x27;%(name)s&#x27;,</div><div class="">                                  _and=IS_NOT_IN_DB(subset,&#x27;person.id&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``IS_IN_DB`` also takes a ``cache`` argument that works like the ``cache`` argument of select.</div><div class=""> </div><div class=""> ##### ``IS_IN_DB`` and Tagging</div><div class=""> ``tags``:inxx</div><div class=""> ``multiple``:inxx</div></div></div>
</div>
<hr />



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/93539678ed5ee942c5bd09736516134b7abd95fd">9353967</a><ul><li>Date : 2012-09-01</li><li>new style references</li></ul></li></ul>
<div class="row-fluid" id="com_93539678ed5ee942c5bd09736516134b7abd95fd">
    <div class="span6"><div class="diff"><div class=""> Now consider the case of two tables linked by a reference field. For example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.define_table(&#x27;dog&#x27;,</div><div class="insert">    Field(&#x27;owner&#x27;, <span class="highlight">&#x27;reference </span>person<span class="highlight">&#x27;</span>),</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.dog.owner.requires = IS_IN_DB(db,db.person.id,&#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> A person has dogs, and each dog belongs to an owner, which is a person. The dog owner is required to reference a valid ``db.person.id`` by ``&#x27;%(name)s&#x27;``.</div><div class=""> </div><div class=""> Let&#x27;s use the **appadmin** interface for this application to add a</div><div class=""> few persons and their dogs.</div><div class=""> </div><div class=""> When editing an existing person, the **appadmin** UPDATE form shows a link to a page that lists the dogs that belong to the person. This behavior can be replicated using the ``linkto`` argument of the ``SQLFORM``. ``linkto`` has to point to the URL of a new action that receives a query string from the ``SQLFORM`` and lists the corresponding records.</div><div class=""> Here is an example:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    record = db.person(request.args(0)) or redirect(URL(&#x27;index&#x27;))</div><div class="">    url = URL(&#x27;download&#x27;)</div><div class="">    link = URL(&#x27;list_records&#x27;, args=&#x27;db&#x27;)</div><div class="">    form = SQLFORM(db.person, record, deletable=True,</div><div class="">                   upload=url, linkto=link)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class=""> #### One form for multiple tables</div><div class=""> </div><div class=""> It often happens that you have two tables (for example &#x27;client&#x27; and</div><div class=""> &#x27;address&#x27; which are linked together by a reference and you want to</div><div class=""> create a single form that allows to insert info about one client and</div><div class=""> its default address. Here is how:</div><div class=""> </div><div class=""> model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;client&#x27;,</div><div class="">      Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;address&#x27;,</div><div class="insert">+    Field(&#x27;client&#x27;,&#x27;reference client&#x27;,</div><div class="insert">+          writable=False,readable=False),</div><div class="">     Field(&#x27;street&#x27;),Field(&#x27;city&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> controller:</div><div class=""> ``</div><div class=""> def register():</div><div class="">     form=SQLFORM.factory(db.client,db.address)</div><div class="">     if form.process().accepted:</div><div class="">         id = db.client.insert(**db.client._filter_fields(form.vars))</div><div class="">         form.vars.client=id</div><div class="">         id = db.address.insert(**db.address._filter_fields(form.vars))</div><div class="">         response.flash=&#x27;Thanks for filling the form&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> Notice the line ``table.id.represent=...`` that tells web2py to change the repre</div><div class=""> #### Record versioning</div><div class=""> </div><div class=""> Both SQLFORM and CRUD provides a utility to version database records:</div><div class=""> </div><div class=""> If you have a table (db.mytable) that needs full revision history you can just do:</div><div class=""> ``</div><div class=""> form = SQLFORM(db.mytable, myrecord).process(onsuccess=auth.archive)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``</div><div class=""> form = crud.update(db.mytable, myrecord, onaccept=auth.archive)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``auth.archive`` defines a new table called **db.mytable_archive** (the name is derived from the name of the table to which it refers) and on updating, it stores a copy of the record (as it was before the update) in the created archive table, including a reference to the current record.</div><div class=""> </div><div class=""> Because the record is actually updated (only its previous state is archived), references are never broken.</div><div class=""> </div><div class=""> This is all done under the hood.  Should you wish to access the archive table you should define it in a model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;mytable_archive&#x27;,</div><div class="insert">   Field(&#x27;current_record&#x27;,<span class="highlight"> &#x27;reference </span>mytable<span class="highlight">&#x27;</span>),</div><div class="">    db.mytable)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the table extends ``db.mytable`` (including all its fields), and adds  a reference to the ``current_record``.</div><div class=""> </div><div class=""> ``auth.archive`` does not timestamp the stored record unless your original table has timestamp fields, for example:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;mytable&#x27;,</div><div class="">     Field(&#x27;created_on&#x27;, &#x27;datetime&#x27;,</div><div class="">           default=request.now, update=request.now, writable=False),</div><div class="insert">    Field(&#x27;created_by&#x27;, <span class="highlight">&#x27;reference </span>auth_user<span class="highlight">&#x27;</span>,</div><div class="">           default=auth.user_id, update=auth.user_id, writable=False),</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is nothing special about these fields and you may give them any name you like. They are filled before the record is archived and are archived with each copy of the record.  The archive table name and/or reference field name can be changed like this:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;myhistory&#x27;,</div><div class="insert">    Field(&#x27;parent_record&#x27;,<span class="highlight"> &#x27;reference </span>mytable<span class="highlight">&#x27;</span>),</div><div class="">     db.mytable)</div><div class=""> ## ...</div><div class=""> form = SQLFORM(db.mytable,myrecord)</div><div class=""> form.process(onsuccess = lambda form:auth.archive(form,</div><div class="">              archive_table=db.myhistory,</div><div class="">              current_record=&#x27;parent_record&#x27;))</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> Now consider the case of two tables linked by a reference field. For example:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;person&#x27;,</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.define_table(&#x27;dog&#x27;,</div><div class="delete">    Field(&#x27;owner&#x27;, <span class="highlight">db.</span>person<span class="highlight"></span>),</div><div class="">     Field(&#x27;name&#x27;, requires=IS_NOT_EMPTY()))</div><div class=""> db.dog.owner.requires = IS_IN_DB(db,db.person.id,&#x27;%(name)s&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> A person has dogs, and each dog belongs to an owner, which is a person. The dog owner is required to reference a valid ``db.person.id`` by ``&#x27;%(name)s&#x27;``.</div><div class=""> </div><div class=""> Let&#x27;s use the **appadmin** interface for this application to add a</div><div class=""> few persons and their dogs.</div><div class=""> </div><div class=""> When editing an existing person, the **appadmin** UPDATE form shows a link to a page that lists the dogs that belong to the person. This behavior can be replicated using the ``linkto`` argument of the ``SQLFORM``. ``linkto`` has to point to the URL of a new action that receives a query string from the ``SQLFORM`` and lists the corresponding records.</div><div class=""> Here is an example:</div><div class=""> ``</div><div class=""> def display_form():</div><div class="">    record = db.person(request.args(0)) or redirect(URL(&#x27;index&#x27;))</div><div class="">    url = URL(&#x27;download&#x27;)</div><div class="">    link = URL(&#x27;list_records&#x27;, args=&#x27;db&#x27;)</div><div class="">    form = SQLFORM(db.person, record, deletable=True,</div><div class="">                   upload=url, linkto=link)</div><div class="">    if form.process().accepted:</div><div class="">        response.flash = &#x27;form accepted&#x27;</div><div class=""> Here is the &quot;default/form_from_factory.html&quot; view:</div><div class=""> </div><div class=""> You need to use an underscore instead of a space for field labels, or explicitly pass a dictionary of ``labels`` to ``form_factory``, as you would for a ``SQLFORM``. By default ``SQLFORM.factory`` generates the form using html &quot;id&quot; attributes generated as if the form was generated from a table called &quot;no_table&quot;. To change this dummy table name, use the ``table_name`` attribute for the factory:</div><div class=""> ``</div><div class=""> form = SQLFORM.factory(...,table_name=&#x27;other_dummy_name&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Changing the ``table_name`` is necessary if you need to place two factory generated forms in the same table and want to avoid CSS conflicts.</div><div class=""> </div><div class=""> #### One form for multiple tables</div><div class=""> </div><div class=""> It often happens that you have two tables (for example &#x27;client&#x27; and</div><div class=""> &#x27;address&#x27; which are linked together by a reference and you want to</div><div class=""> create a single form that allows to insert info about one client and</div><div class=""> its default address. Here is how:</div><div class=""> </div><div class=""> model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;client&#x27;,</div><div class="">      Field(&#x27;name&#x27;))</div><div class=""> db.define_table(&#x27;address&#x27;,</div><div class="delete">-    Field(&#x27;client&#x27;,db.client,writable=False,readable=False),</div><div class="">     Field(&#x27;street&#x27;),Field(&#x27;city&#x27;))</div><div class=""> ``:code</div><div class=""> </div><div class=""> controller:</div><div class=""> ``</div><div class=""> def register():</div><div class="">     form=SQLFORM.factory(db.client,db.address)</div><div class="">     if form.process().accepted:</div><div class="">         id = db.client.insert(**db.client._filter_fields(form.vars))</div><div class="">         form.vars.client=id</div><div class="">         id = db.address.insert(**db.address._filter_fields(form.vars))</div><div class="">         response.flash=&#x27;Thanks for filling the form&#x27;</div><div class="">     return dict(form=form)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the SQLFORM.factory (it makes ONE form using public fields from</div><div class=""> both tables and inherits their validators too).</div><div class=""> On form accepts this does two inserts, some data in one table and some</div><div class=""> data in the other.</div><div class=""> </div><div class=""> Notice the line ``table.id.represent=...`` that tells web2py to change the repre</div><div class=""> #### Record versioning</div><div class=""> </div><div class=""> Both SQLFORM and CRUD provides a utility to version database records:</div><div class=""> </div><div class=""> If you have a table (db.mytable) that needs full revision history you can just do:</div><div class=""> ``</div><div class=""> form = SQLFORM(db.mytable, myrecord).process(onsuccess=auth.archive)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``</div><div class=""> form = crud.update(db.mytable, myrecord, onaccept=auth.archive)</div><div class=""> ``:code</div><div class=""> </div><div class=""> ``auth.archive`` defines a new table called **db.mytable_archive** (the name is derived from the name of the table to which it refers) and on updating, it stores a copy of the record (as it was before the update) in the created archive table, including a reference to the current record.</div><div class=""> </div><div class=""> Because the record is actually updated (only its previous state is archived), references are never broken.</div><div class=""> </div><div class=""> This is all done under the hood.  Should you wish to access the archive table you should define it in a model:</div><div class=""> ``</div><div class=""> db.define_table(&#x27;mytable_archive&#x27;,</div><div class="delete">   Field(&#x27;current_record&#x27;,<span class="highlight">db.</span>mytable<span class="highlight"></span>),</div><div class="">    db.mytable)</div><div class=""> ``:code</div><div class=""> </div><div class=""> Notice the table extends ``db.mytable`` (including all its fields), and adds  a reference to the ``current_record``.</div><div class=""> </div><div class=""> ``auth.archive`` does not timestamp the stored record unless your original table has timestamp fields, for example:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;mytable&#x27;,</div><div class="">     Field(&#x27;created_on&#x27;, &#x27;datetime&#x27;,</div><div class="">           default=request.now, update=request.now, writable=False),</div><div class="delete">    Field(&#x27;created_by&#x27;, <span class="highlight">db.</span>auth_user<span class="highlight"></span>,</div><div class="">           default=auth.user_id, update=auth.user_id, writable=False),</div><div class=""> ``:code</div><div class=""> </div><div class=""> There is nothing special about these fields and you may give them any name you like. They are filled before the record is archived and are archived with each copy of the record.  The archive table name and/or reference field name can be changed like this:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;myhistory&#x27;,</div><div class="delete">    Field(&#x27;parent_record&#x27;,<span class="highlight">db.</span>mytable<span class="highlight"></span>),</div><div class="">     db.mytable)</div><div class=""> ## ...</div><div class=""> form = SQLFORM(db.mytable,myrecord)</div><div class=""> form.process(onsuccess = lambda form:auth.archive(form,</div><div class="">              archive_table=db.myhistory,</div><div class="">              current_record=&#x27;parent_record&#x27;))</div><div class=""> ``:code</div></div></div>
</div>
<hr />





        
      </div>

      <div id="push"></div>
    </div>

    <div id="footer">
      <div class="container-fluid">
          <div class="copyright pull-left">Copyright &#169; 2014</div>
          <div id="poweredBy" class="pull-right">
              Powered by
              <a href="http://www.web2py.com/">web2py</a>
          </div>
      </div>
    </div>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/web2py_bootstrap.js"></script>
</body>
</html>
