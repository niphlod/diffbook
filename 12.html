<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]><html class="ie ie6 ie-lte9 ie-lte8 ie-lte7 no-js" lang="en-us"> <![endif]-->
<!--[if IE 7]><html class="ie ie7 ie-lte9 ie-lte8 ie-lte7 no-js" lang="en-us"> <![endif]-->
<!--[if IE 8]><html class="ie ie8 ie-lte9 ie-lte8 no-js" lang="en-us"> <![endif]-->
<!--[if IE 9]><html class="ie9 ie-lte9 no-js" lang="en-us"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js" lang="en-us"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <!-- www.phpied.com/conditional-comments-block-downloads/ -->
  <!-- Always force latest IE rendering engine
       (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <![endif]-->

  <title>Diffbook</title>

  <!-- http://dev.w3.org/html5/markup/meta.name.html -->
  <meta name="application-name" content="diffbook" />

  <!-- Speaking of Google, don't forget to set your site up:
       http://google.com/webmasters -->
  <meta name="google-site-verification" content="" />

  <!--  Mobile Viewport Fix
        j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag
        device-width: Occupy full width of the screen in its current orientation
        initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
        user-scalable = yes allows the user to zoom in -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="shortcut icon" href="static/images/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="static/images/favicon.png">

  <!-- All JavaScript at the bottom, except for Modernizr which enables
       HTML5 elements & feature detects -->
  <script src="static/js/modernizr.custom.js"></script>

  <!-- include stylesheets -->
  

  <script type="text/javascript"><!--
    // These variables are used by the web2py_ajax_init function in web2py_ajax.js (which is loaded below).
    var w2p_ajax_confirm_message = "Are you sure you want to delete this object?";
    var w2p_ajax_date_format = "%Y-%m-%d";
    var w2p_ajax_datetime_format = "%Y-%m-%d %H:%M:%S";
    //--></script>
<meta name="keywords" content="web2py, python, framework" />

<meta name="description" content="a cool new app" />

<meta name="generator" content="Web2py Web Framework" />

<meta name="author" content="Your Name &lt;you@example.com&gt;" />
<script src="static/js/jquery.js" type="text/javascript"></script><link href="static/css/calendar.css" rel="stylesheet" type="text/css" /><script src="static/js/calendar.js" type="text/javascript"></script><script src="static/js/web2py.js" type="text/javascript"></script><link href="static/css/web2py.css" rel="stylesheet" type="text/css" /><link href="static/css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" /><link href="static/css/web2py_bootstrap.css" rel="stylesheet" type="text/css" />


  

  <!-- uncomment here to load jquery-ui
       <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" type="text/css" media="all" />
       <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
       uncomment to load jquery-ui //-->
  <noscript><link href="static/css/web2py_bootstrap_nojs.css" rel="stylesheet" type="text/css" /></noscript>
  
  <style type="text/css">

      /* Sticky footer styles
      -------------------------------------------------- */

      html,
      body {
        height: 100%;
        /* The html and body elements cannot have any padding or margin. */
      }

      /* Wrapper for page content to push down footer */
      #wrap {
        min-height: 100%;
        height: auto !important;
        height: 100%;
        /* Negative indent footer by it's height */
        margin: 0 auto -60px;
      }

      /* Set the fixed height of the footer here */
      #push,
      #footer {
        height: 60px;
      }
      #footer {
        background-color: #f5f5f5;
      }

      /* Lastly, apply responsive CSS fixes as necessary */
      @media (max-width: 767px) {
        #footer {
          margin-left: -20px;
          margin-right: -20px;
          padding-left: 20px;
          padding-right: 20px;
        }
      }



      /* Custom page CSS
      -------------------------------------------------- */
      /* Not required for template or sticky footer method. */

      .container {
        width: auto;
        max-width: 680px;
      }
      .container .credit {
        margin: 20px 0;
      }

    </style>
</head>

<body>
  
  <body>


    <!-- Part 1: Wrap all page content here -->
    <div id="wrap">

      <!-- Begin page content -->
      <div class="container-fluid">
        <div class="page-header">
          	<h1>
              Diffbook
              <small>easy? diffbook</small>
            </h1>
        </div>
        
        


<div class="pagination">
  <ul>

      <li><a href="/diffbook/0.html">Chapter 0</a></li>

      <li><a href="/diffbook/1.html">Chapter 1</a></li>

      <li><a href="/diffbook/2.html">Chapter 2</a></li>

      <li><a href="/diffbook/3.html">Chapter 3</a></li>

      <li><a href="/diffbook/4.html">Chapter 4</a></li>

      <li><a href="/diffbook/5.html">Chapter 5</a></li>

      <li><a href="/diffbook/6.html">Chapter 6</a></li>

      <li><a href="/diffbook/7.html">Chapter 7</a></li>

      <li><a href="/diffbook/8.html">Chapter 8</a></li>

      <li><a href="/diffbook/9.html">Chapter 9</a></li>

      <li><a href="/diffbook/10.html">Chapter 10</a></li>

      <li><a href="/diffbook/11.html">Chapter 11</a></li>

      <li><a href="/diffbook/12.html">Chapter 12</a></li>

  </ul>
</div>

<div class="pagination">
  <ul>

      <li><a href="#com_7bce1473ce90f4e60f49d72bf1b61d32f430cb54">7bce147</a></li>

      <li><a href="#com_df4ca32e45895ff30b9ff2465b997c895a46d525">df4ca32</a></li>

      <li><a href="#com_097d699dc16179206ccb7e4aee863d6523cd471c">097d699</a></li>

      <li><a href="#com_010aa0543ab690b5d1930c4b7d8584b4eb0fa73f">010aa05</a></li>

      <li><a href="#com_77e0846262922b8d1f776f23ca079114677b4048">77e0846</a></li>

      <li><a href="#com_ac4003f4349f9ee22c67309ceeb48de5539b0308">ac4003f</a></li>

  </ul>
</div>



<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/7bce1473ce90f4e60f49d72bf1b61d32f430cb54">7bce147</a><ul><li>Date : 2012-12-22</li><li>scheduler.queue_task</li></ul></li></ul>
<div class="row-fluid" id="com_7bce1473ce90f4e60f49d72bf1b61d32f430cb54">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="insert">    return dict(form=<span class="highlight">SQLFORM</span>(db.comment)<span class="highlight">.process()</span>,</div><div class="">                 comments=db(db.comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="">   on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> First, we create a model called &quot;models/plugin_comments.py&quot;:</div><div class=""> db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;, label=&#x27;Your comment&#x27;),</div><div class="">    Field(&#x27;posted_on&#x27;, &#x27;datetime&#x27;, default=request.now),</div><div class="">    Field(&#x27;posted_by&#x27;, db.auth_user, default=auth.user_id))</div><div class=""> db.plugin_comments_comment.posted_on.writable=False</div><div class=""> db.plugin_comments_comment.posted_on.readable=False</div><div class=""> db.plugin_comments_comment.posted_by.writable=False</div><div class=""> db.plugin_comments_comment.posted_by.readable=False</div><div class=""> </div><div class=""> def plugin_comments():</div><div class="">     return LOAD(&#x27;plugin_comments&#x27;,&#x27;post&#x27;,ajax=True)</div><div class=""> ``:code</div><div class=""> (notice the last two lines define a function that will simplify the embedding of the plugin)</div><div class=""> </div><div class=""> Second, we define a &quot;controllers/plugin_comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="">     comment = db.plugin_comments_comment</div><div class="insert">    return dict(form=<span class="highlight">SQLFORM</span>(comment)<span class="highlight">.process()</span>,</div><div class="">                 comments=db(comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> Third, we create a view called &quot;views/plugin_comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="">   on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now we can use **admin** to pack the plugin for distribution. Admin will save this plugin as:</div><div class=""> </div><div class=""> ``</div><div class=""> web2py.plugin.comments.w2p</div><div class=""> ``:code</div><div class=""> Third, modify the &quot;views/layout.html&quot; so that it simply reads:</div><div class=""> {{include}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div><div class=""> </div><div class=""> ### ``plugin_wiki``</div><div class=""> ``plugin_wiki``:inxx ``wiki``:inxx</div><div class=""> </div><div class=""> -----</div><div class=""> DISCLAIMER: plugin_wiki is still very much under development and therefore we do not promise backward compatibility to the same level as for web2py core functions.</div><div class=""> -----</div><div class=""> </div><div class=""> **plugin_wiki** is a plugin on steroids.  What we mean is that it defines multiple useful components and it may change the way you develop your applications:</div><div class=""> </div><div class=""> You can download it from</div><div class=""> </div><div class=""> ``</div><div class=""> http://web2py.com/examples/static/web2py.plugin.wiki.w2p</div><div class=""> ``:code</div><div class=""> </div><div class="insert">The idea behind **plugin_wiki** is that most applications include pages that are semi-static. These are pages that do not include complex custom logic. They contain structured text (think of a help page), images, audio, video, <span class="highlight"></span>forms, or a set of standard components (comments, tags, charts, maps), etc. These pages may be public, require login or have other authorization restrictions. These pages may be linked by a menu or only be reachable via wizard form. **plugin_wiki** provides an easy way to add pages that fit in this category to your regular web2py applications.</div><div class=""> </div><div class=""> In particular **plugin_wiki** provides:</div><div class=""> ``widget in plugin_wiki``:inxx</div><div class=""> </div><div class=""> - A wiki-like interface that allows to add pages to your app and reference them by a slug. These pages (which we will refer to as wiki pages) have versions and are stored in the database.</div><div class=""> - Public and private pages (require login). If a page requires login, it may also require that the user have a particular group membership.</div><div class=""> - Three levels: 1,2,3. At level 1, pages can only include text, images, audio and video. At level 2, pages can also include widgets (these are components as defined in the previous section that can be embedded in wiki pages). At level 3, pages can also include web2py template code.</div><div class=""> - A choice of editing pages with the markmin syntax or in HTML using a WYSIWYG editor.</div><div class=""> - A collection of widgets: implemented as components. They are self documenting and they can be embedded as regular components in normal web2py views or, using a simplified syntax, into wiki pages.</div><div class=""> - A set of special pages (``meta-code``, ``meta-menu``, etc.) that can be used to customize the plugin (for example define code the plugin should run, customize the menu, etc.)</div><div class=""> </div><div class=""> ------</div><div class=""> The **welcome** app plus the **plugin_wiki** can be thought of as a development environment in itself that is suitable for building simple web applications such as a blog.</div><div class=""> ------</div><div class=""> </div><div class=""> From here on we will assume the **plugin_wiki** is applied to a copy of the **welcome** scaffolding app.</div><div class=""> </div><div class=""> The first thing you notice after installing the plugin is that it adds a new menu item called &#x27;&#x27;pages&#x27;&#x27;.</div><div class=""> </div><div class=""> Click on the &#x27;&#x27;pages&#x27;&#x27; menu item and you will be redirected to the plugin action:</div><div class=""> Search Engines   None</div><div class="">    Bing          http://bing.com</div><div class=""> Help             page:help</div><div class=""> ``:code</div><div class=""> </div><div class=""> This renders as follows:</div><div class=""> </div><div class=""> [[image @///image/en8800.png center 480px]]</div><div class=""> </div><div class=""> ``meta-menu``:inxx ``meta-code``:inxx ``meta-header``:inxx ``meta-sidebar``:inxx ``meta-footer``:inxx</div><div class=""> **meta-code** is another special page and it must contain web2py code. This is an extension of your models, and in fact you can put model code here. It is executed when &quot;models/plugin_wiki.py&quot; code is executed.</div><div class=""> </div><div class=""> You can define tables in ``meta-code``.</div><div class=""> </div><div class=""> For example, you can create a simple table &quot;friends&quot; by placing this in ``meta-code``:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;friend&#x27;,Field(&#x27;name&#x27;,requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you can create a friend-management interface by embedding in a page of your choice the following code:</div><div class="insert">``jqGrid``:inxx<span class="highlight"></span></div><div class=""> </div><div class=""> ``</div><div class=""> ## List of friends</div><div class=""> !`!!`!</div><div class=""> name: jqgrid</div><div class=""> table: friend</div><div class=""> !`!!`!:widget</div><div class=""> </div><div class=""> ## New friend</div><div class=""> !`!!`!</div><div class=""> name: create</div><div class=""> table: friend</div><div class=""> !`!!`!:widget</div><div class=""> </div><div class=""> ``:code</div><div class=""> </div><div class="insert">The page has two headers (starting with #): &quot;List of friends&quot; and &quot;New friend&quot;. The page contains two widgets (under the corresponding headers): a jqgrid widget that lists friends and a cr<span class="highlight"></span>eate widget to add a new friend.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="delete">    return dict(form=<span class="highlight">crud.create</span>(db.comment)<span class="highlight"></span>,</div><div class="">                 comments=db(db.comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="">   on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> First, we create a model called &quot;models/plugin_comments.py&quot;:</div><div class=""> db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;, label=&#x27;Your comment&#x27;),</div><div class="">    Field(&#x27;posted_on&#x27;, &#x27;datetime&#x27;, default=request.now),</div><div class="">    Field(&#x27;posted_by&#x27;, db.auth_user, default=auth.user_id))</div><div class=""> db.plugin_comments_comment.posted_on.writable=False</div><div class=""> db.plugin_comments_comment.posted_on.readable=False</div><div class=""> db.plugin_comments_comment.posted_by.writable=False</div><div class=""> db.plugin_comments_comment.posted_by.readable=False</div><div class=""> </div><div class=""> def plugin_comments():</div><div class="">     return LOAD(&#x27;plugin_comments&#x27;,&#x27;post&#x27;,ajax=True)</div><div class=""> ``:code</div><div class=""> (notice the last two lines define a function that will simplify the embedding of the plugin)</div><div class=""> </div><div class=""> Second, we define a &quot;controllers/plugin_comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="">     comment = db.plugin_comments_comment</div><div class="delete">    return dict(form=<span class="highlight">crud.create</span>(comment)<span class="highlight"></span>,</div><div class="">                 comments=db(comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> Third, we create a view called &quot;views/plugin_comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="">   on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now we can use **admin** to pack the plugin for distribution. Admin will save this plugin as:</div><div class=""> </div><div class=""> ``</div><div class=""> web2py.plugin.comments.w2p</div><div class=""> ``:code</div><div class=""> Third, modify the &quot;views/layout.html&quot; so that it simply reads:</div><div class=""> {{include}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div><div class=""> </div><div class=""> ### ``plugin_wiki``</div><div class=""> ``plugin_wiki``:inxx ``wiki``:inxx</div><div class=""> </div><div class=""> -----</div><div class=""> DISCLAIMER: plugin_wiki is still very much under development and therefore we do not promise backward compatibility to the same level as for web2py core functions.</div><div class=""> -----</div><div class=""> </div><div class=""> **plugin_wiki** is a plugin on steroids.  What we mean is that it defines multiple useful components and it may change the way you develop your applications:</div><div class=""> </div><div class=""> You can download it from</div><div class=""> </div><div class=""> ``</div><div class=""> http://web2py.com/examples/static/web2py.plugin.wiki.w2p</div><div class=""> ``:code</div><div class=""> </div><div class="delete">The idea behind **plugin_wiki** is that most applications include pages that are semi-static. These are pages that do not include complex custom logic. They contain structured text (think of a help page), images, audio, video, <span class="highlight">crud </span>forms, or a set of standard components (comments, tags, charts, maps), etc. These pages may be public, require login or have other authorization restrictions. These pages may be linked by a menu or only be reachable via wizard form. **plugin_wiki** provides an easy way to add pages that fit in this category to your regular web2py applications.</div><div class=""> </div><div class=""> In particular **plugin_wiki** provides:</div><div class=""> ``widget in plugin_wiki``:inxx</div><div class=""> </div><div class=""> - A wiki-like interface that allows to add pages to your app and reference them by a slug. These pages (which we will refer to as wiki pages) have versions and are stored in the database.</div><div class=""> - Public and private pages (require login). If a page requires login, it may also require that the user have a particular group membership.</div><div class=""> - Three levels: 1,2,3. At level 1, pages can only include text, images, audio and video. At level 2, pages can also include widgets (these are components as defined in the previous section that can be embedded in wiki pages). At level 3, pages can also include web2py template code.</div><div class=""> - A choice of editing pages with the markmin syntax or in HTML using a WYSIWYG editor.</div><div class=""> - A collection of widgets: implemented as components. They are self documenting and they can be embedded as regular components in normal web2py views or, using a simplified syntax, into wiki pages.</div><div class=""> - A set of special pages (``meta-code``, ``meta-menu``, etc.) that can be used to customize the plugin (for example define code the plugin should run, customize the menu, etc.)</div><div class=""> </div><div class=""> ------</div><div class=""> The **welcome** app plus the **plugin_wiki** can be thought of as a development environment in itself that is suitable for building simple web applications such as a blog.</div><div class=""> ------</div><div class=""> </div><div class=""> From here on we will assume the **plugin_wiki** is applied to a copy of the **welcome** scaffolding app.</div><div class=""> </div><div class=""> The first thing you notice after installing the plugin is that it adds a new menu item called &#x27;&#x27;pages&#x27;&#x27;.</div><div class=""> </div><div class=""> Click on the &#x27;&#x27;pages&#x27;&#x27; menu item and you will be redirected to the plugin action:</div><div class=""> Search Engines   None</div><div class="">    Bing          http://bing.com</div><div class=""> Help             page:help</div><div class=""> ``:code</div><div class=""> </div><div class=""> This renders as follows:</div><div class=""> </div><div class=""> [[image @///image/en8800.png center 480px]]</div><div class=""> </div><div class=""> ``meta-menu``:inxx ``meta-code``:inxx ``meta-header``:inxx ``meta-sidebar``:inxx ``meta-footer``:inxx</div><div class=""> **meta-code** is another special page and it must contain web2py code. This is an extension of your models, and in fact you can put model code here. It is executed when &quot;models/plugin_wiki.py&quot; code is executed.</div><div class=""> </div><div class=""> You can define tables in ``meta-code``.</div><div class=""> </div><div class=""> For example, you can create a simple table &quot;friends&quot; by placing this in ``meta-code``:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;friend&#x27;,Field(&#x27;name&#x27;,requires=IS_NOT_EMPTY()))</div><div class=""> ``:code</div><div class=""> </div><div class=""> and you can create a friend-management interface by embedding in a page of your choice the following code:</div><div class="delete">``jqGrid``:inxx<span class="highlight"> ``CRUD``:inxx</span></div><div class=""> </div><div class=""> ``</div><div class=""> ## List of friends</div><div class=""> !`!!`!</div><div class=""> name: jqgrid</div><div class=""> table: friend</div><div class=""> !`!!`!:widget</div><div class=""> </div><div class=""> ## New friend</div><div class=""> !`!!`!</div><div class=""> name: create</div><div class=""> table: friend</div><div class=""> !`!!`!:widget</div><div class=""> </div><div class=""> ``:code</div><div class=""> </div><div class="delete">The page has two headers (starting with #): &quot;List of friends&quot; and &quot;New friend&quot;. The page contains two widgets (under the corresponding headers): a jqgrid widget that lists friends and a cr<span class="highlight">ud cr</span>eate widget to add a new friend.</div></div></div>
</div>
<hr />

<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/df4ca32e45895ff30b9ff2465b997c895a46d525">df4ca32</a><ul><li>Date : 2013-01-01</li><li>fixed plugin_comments shots</li></ul></li></ul>
<div class="row-fluid" id="com_df4ca32e45895ff30b9ff2465b997c895a46d525">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="insert">db.define_table(&#x27;<span class="highlight">comment_</span>post&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;,label=&#x27;Your comment&#x27;),</div><div class="insert"><span class="highlight">   auth</span>.<span class="highlight"></span>s<span class="highlight">igna</span>t<span class="highlight">u</span>re<span class="highlight">)</span></div><div class=""> ``:code</div><div class=""> </div><div class=""> one action in &quot;controllers/comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="insert">+    return dict(form=SQLFORM(db.comment_post).process(),</div><div class="insert">+                comments=db(db.comment_post).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{for post in comments:}}</div><div class=""> &lt;div class=&quot;post&quot;&gt;</div><div class="insert">  <span class="highlight">O</span>n {{=post.<span class="highlight">crea</span>ted_on}} {{=post.<span class="highlight">crea</span>ted_by.first_name}}</div><div class="">   says &lt;span class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> ``:code</div><div class=""> </div><div class=""> So far there is nothing special in this action, but we can turn it into a component by defining a new view with extension &quot;.load&quot; that does not extend the layout.</div><div class=""> </div><div class=""> Hence we create a &quot;views/comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{for post in comments:}}</div><div class=""> &lt;div class=&quot;post&quot;&gt;</div><div class="insert">+  On {{=post.created_on}} {{=post.created_by.first_name}}</div><div class="insert">+  says &lt;blockquote class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/blockquote&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> We can access it at the URL</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post.load</div><div class=""> ``:code</div><div class=""> </div><div class=""> This is a component that we can embed into any other page by simply doing</div><div class=""> </div><div class=""> ``</div><div class=""> {{=LOAD(&#x27;comments&#x27;,&#x27;post.load&#x27;,ajax=True)}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> For example in &quot;controllers/default.py&quot; we can edit</div><div class=""> </div><div class=""> ``</div><div class=""> def index():</div><div class="">     return dict()</div><div class=""> ``:code</div><div class=""> </div><div class=""> and in the corresponding view add the component:</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{=LOAD(&#x27;comments&#x27;,&#x27;post.load&#x27;,ajax=True)}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Visiting the page</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/default/index</div><div class=""> ``:code</div><div class=""> </div><div class=""> will show the normal content and the comments component:</div><div class=""> </div><div class=""> [[image @///image/en8100.png center 480px]]</div><div class=""> </div><div class=""> The ``{{=LOAD(...)}}`` component is rendered as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> &lt;script type=&quot;text/javascript&quot;&gt;&lt;!--</div><div class=""> web2py_component(&quot;/test/comment/post.load&quot;,&quot;c282718984176&quot;)</div><div class=""> //--&gt;&lt;/script&gt;&lt;div id=&quot;c282718984176&quot;&gt;loading...&lt;/div&gt;</div><div class=""> ``:code</div><div class=""> Plugins should include license and documentation. These should be placed in:</div><div class=""> **Rule 5**:</div><div class=""> The plugin can only rely on the existence of the global objects defined in scaffolding &quot;db.py&quot;, i.e.</div><div class=""> </div><div class=""> - a database connection called ``db``</div><div class=""> - an ``Auth`` instance called ``auth``</div><div class=""> - a ``Crud`` instance called ``crud``</div><div class=""> - a ``Service`` instance called ``service``</div><div class=""> </div><div class=""> Some plugins may be more sophisticated and have a configuration parameter in case more than one db instance exists.</div><div class=""> </div><div class=""> **Rule 6**:</div><div class=""> If a plugin needs configuration parameters, these should be set via a PluginManager as described below.</div><div class=""> ``PluginManager``:inxx</div><div class=""> </div><div class=""> By following the above rules we can make sure that:</div><div class=""> - **admin** recognizes all the ``plugin_``&#x27;&#x27;name&#x27;&#x27; files and folder as part of a single entity.</div><div class=""> - plugins do not interfere with each other.</div><div class=""> </div><div class=""> The rules above do not solve the problem of plugin versions and dependencies. That is beyond our scope.</div><div class=""> </div><div class="insert">+</div><div class=""> #### Component plugins</div><div class=""> ``component plugin``:inxx</div><div class=""> </div><div class=""> Component plugins are plugins that define components. Components usually access the database and define with their own models.</div><div class=""> </div><div class=""> Here we turn the previous ``comments`` component into a ``comments_plugin`` by using the same code we wrote before, but following all of the previous rules.</div><div class=""> </div><div class=""> First, we create a model called &quot;models/plugin_comments.py&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;, label=&#x27;Your comment&#x27;),</div><div class="insert"><span class="highlight">   auth</span>.<span class="highlight">signat</span>u<span class="highlight"></span>re<span class="highlight">)</span></div><div class=""> </div><div class=""> def plugin_comments():</div><div class="">     return LOAD(&#x27;plugin_comments&#x27;,&#x27;post&#x27;,ajax=True)</div><div class=""> ``:code</div><div class=""> (notice the last two lines define a function that will simplify the embedding of the plugin)</div><div class=""> </div><div class=""> Second, we define a &quot;controllers/plugin_comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> def post():</div><div class="insert">+    if not auth.user:</div><div class="insert">+        return A(&#x27;login to comment&#x27;,_href=URL(&#x27;default&#x27;,&#x27;user/login&#x27;))</div><div class="">     comment = db.plugin_comments_comment</div><div class="">     return dict(form=SQLFORM(comment).process(),</div><div class="">                 comments=db(comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> Third, we create a view called &quot;views/plugin_comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="insert">  on {{=comment.<span class="highlight">crea</span>ted_on}} {{=comment.<span class="highlight">crea</span>ted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now we can use **admin** to pack the plugin for distribution. Admin will save this plugin as:</div><div class=""> </div><div class=""> ``</div><div class=""> web2py.plugin.comments.w2p</div><div class=""> ``:code</div><div class=""> </div><div class=""> We can use the plugin in any view by simply installing the plugin via the **edit** page in **admin** and adding this to our own views</div><div class=""> </div><div class=""> ``</div><div class=""> {{=plugin_comments()}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Of course we can make the plugin more sophisticated by having components that take parameters and configuration options. The more complex the components, the more difficult it becomes to avoid name collisions. The Plugin Manager described below is designed to avoid this problem.</div><div class=""> </div><div class=""> #### Plugin manager</div><div class=""> </div><div class=""> The ``PluginManager`` is a class defined in ``gluon.tools``. Before we explain how it works inside, we will explain how to use it.</div><div class=""> </div><div class=""> Here we consider the previous ``comments_plugin`` and we make it better. We want to be able to customize:</div><div class=""> </div><div class=""> ``</div><div class=""> db.plugin_comments_comment.body.label</div><div class=""> ``:code</div><div class=""> </div><div class=""> without having to edit the plugin code itself.</div><div class=""> </div><div class=""> Here is how we can do it:</div><div class=""> </div><div class=""> First, rewrite the plugin &quot;models/plugin_comments.py&quot; in this way:</div><div class=""> </div><div class=""> ``</div><div class="insert">def <span class="highlight"></span>_<span class="highlight"></span>()<span class="highlight">:</span></div><div class="">     from gluon.tools import PluginManager</div><div class="">     plugins = PluginManager(&#x27;comments&#x27;, body_label=&#x27;Your comment&#x27;)</div><div class=""> </div><div class="insert">+    db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="insert">+        Field(&#x27;body&#x27;,&#x27;text&#x27;,label=plugins.comments.body_label),</div><div class="insert">+        auth.signature)</div><div class="insert">+    return lambda: LOAD(&#x27;plugin_comments&#x27;,&#x27;post.load&#x27;,ajax=True)</div><div class="insert">+plugin_comments = _()</div><div class=""> ``:code</div><div class=""> </div><div class="insert">Notice how all the code except the table definition is encapsulated in a single function<span class="highlight"> called ``_`` so that it does not pollute the global namespace</span>. Also notice how the function creates an instance of a ``PluginManager``.</div><div class=""> </div><div class=""> Now in any other model in your app, for example in &quot;models/db.py&quot;, you can configure this plugin as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> from gluon.tools import PluginManager</div><div class=""> plugins = PluginManager()</div><div class=""> plugins.comments.body_label = T(&#x27;Post a comment&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> -----</div><div class=""> The ``plugins`` object is already instantiated in the default scaffolding app in &quot;models/db.py&quot;</div><div class=""> -----</div><div class=""> </div><div class=""> The PluginManager object is a thread-level singleton Storage object of Storage objects. That means you can instantiate as many as you like within the same application but (whether they have the same name or not) they act as if there were a single PluginManager instance.</div><div class=""> </div><div class=""> In particular each plugin file can make its own PluginManager object and register itself and its default parameters with it:</div><div class=""> </div><div class=""> ``</div><div class=""> plugins = PluginManager(&#x27;name&#x27;, param1=&#x27;value&#x27;, param2=&#x27;value&#x27;)</div><div class=""> ``:code</div><div class=""> plugins.name3.param5 = &#x27;...&#x27;</div><div class=""> When the plugin is defined, the PluginManager must take arguments: the plugin name and optional named arguments which are default parameters. However, when the plugins are configured, the PluginManager constructor must take no arguments. The configuration must precede the definition of the plugin (i.e. it must be in a model file that comes first alphabetically).</div><div class=""> -----</div><div class=""> </div><div class=""> #### Layout plugins</div><div class=""> ``layout plugin``:inxx</div><div class=""> </div><div class=""> Layout plugins are simpler than component plugins because usually they do not contain code, but only views and static files. Yet you should still follow  good practice:</div><div class=""> </div><div class=""> First, create a folder called &quot;static/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/&quot; (where name is the name of your layout) and place all your static files there.</div><div class=""> </div><div class=""> Second, create a layout file called &quot;views/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/layout.html&quot; that contains your layout and links the images, CSS and JavaScript files in &quot;static/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/&quot;</div><div class=""> </div><div class=""> Third, modify the &quot;views/layout.html&quot; so that it simply reads:</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;plugin_layout_name/layout.html&#x27;}}</div><div class=""> {{include}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div><div class="insert">+</div><div class="insert">+#### Plugins repositories</div><div class="insert">+</div><div class="insert">+While there is no single repository of web2py plugins you can find many of them at one of the following to URLs:</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+http://dev.s-cubism.com/web2py_plugins</div><div class="insert">+http://web2py.com/plugins</div><div class="insert">+http://web2py.com/layouts</div><div class="insert">+``:code</div><div class="insert">+</div><div class="insert">+Here is a screenshot from the s-cubism repository:</div><div class="insert">+</div><div class="insert">+[[image @///image/plugins.png center 480px]]</div><div class="insert">+</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="delete">db.define_table(&#x27;<span class="highlight"></span>post&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;,label=&#x27;Your comment&#x27;),</div><div class="delete">-   Field(&#x27;posted_on&#x27;,&#x27;datetime&#x27;,default=request.now),</div><div class="delete">-   Field(&#x27;posted_by&#x27;,db.auth_user,default=auth.user_id))</div><div class="delete">-db.post.posted_on.writable = db.post.posted_on.readable = False</div><div class="delete"><span class="highlight">db</span>.<span class="highlight">po</span>s<span class="highlight"></span>t<span class="highlight">.posted_by.writable = db.post.posted_by.</span>re<span class="highlight">adable = False</span></div><div class=""> ``:code</div><div class=""> </div><div class=""> one action in &quot;controllers/comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="delete">-    return dict(form=SQLFORM(db.post).process(),</div><div class="delete">-                comments=db(db.post).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class=""> {{for post in comments:}}</div><div class=""> &lt;div class=&quot;post&quot;&gt;</div><div class="delete">  <span class="highlight">o</span>n {{=post.<span class="highlight">pos</span>ted_on}} {{=post.<span class="highlight">pos</span>ted_by.first_name}}</div><div class="">   says &lt;span class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-[[image @///image/en7900.png center 480px]]</div><div class="delete">-</div><div class=""> So far there is nothing special in this action, but we can turn it into a component by defining a new view with extension &quot;.load&quot; that does not extend the layout.</div><div class=""> </div><div class=""> Hence we create a &quot;views/comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class="delete">-{{#extend &#x27;layout.html&#x27; &lt;- notice this is commented out!}}</div><div class=""> {{for post in comments:}}</div><div class=""> &lt;div class=&quot;post&quot;&gt;</div><div class="delete">-  on {{=post.posted_on}} {{=post.posted_by.first_name}}</div><div class="delete">-  says &lt;span class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> We can access it at the URL</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post.load</div><div class=""> ``:code</div><div class=""> </div><div class="delete">-and it will look like this:</div><div class="delete">-</div><div class="delete">-[[image @///image/en8000.png center 480px]]</div><div class="delete">-</div><div class=""> This is a component that we can embed into any other page by simply doing</div><div class=""> </div><div class=""> ``</div><div class=""> {{=LOAD(&#x27;comments&#x27;,&#x27;post.load&#x27;,ajax=True)}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> For example in &quot;controllers/default.py&quot; we can edit</div><div class=""> </div><div class=""> ``</div><div class=""> def index():</div><div class="">     return dict()</div><div class=""> ``:code</div><div class=""> </div><div class=""> and in the corresponding view add the component:</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class="delete">-&lt;p&gt;{{=&#x27;bla &#x27;*100}}&lt;/p&gt;</div><div class=""> {{=LOAD(&#x27;comments&#x27;,&#x27;post.load&#x27;,ajax=True)}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Visiting the page</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/default/index</div><div class=""> ``:code</div><div class=""> </div><div class=""> will show the normal content and the comments component:</div><div class=""> </div><div class=""> [[image @///image/en8100.png center 480px]]</div><div class=""> </div><div class=""> The ``{{=LOAD(...)}}`` component is rendered as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> &lt;script type=&quot;text/javascript&quot;&gt;&lt;!--</div><div class=""> web2py_component(&quot;/test/comment/post.load&quot;,&quot;c282718984176&quot;)</div><div class=""> //--&gt;&lt;/script&gt;&lt;div id=&quot;c282718984176&quot;&gt;loading...&lt;/div&gt;</div><div class=""> ``:code</div><div class=""> Plugins should include license and documentation. These should be placed in:</div><div class=""> **Rule 5**:</div><div class=""> The plugin can only rely on the existence of the global objects defined in scaffolding &quot;db.py&quot;, i.e.</div><div class=""> </div><div class=""> - a database connection called ``db``</div><div class=""> - an ``Auth`` instance called ``auth``</div><div class=""> - a ``Crud`` instance called ``crud``</div><div class=""> - a ``Service`` instance called ``service``</div><div class=""> </div><div class=""> Some plugins may be more sophisticated and have a configuration parameter in case more than one db instance exists.</div><div class=""> </div><div class=""> **Rule 6**:</div><div class=""> If a plugin needs configuration parameters, these should be set via a PluginManager as described below.</div><div class=""> ``PluginManager``:inxx</div><div class=""> </div><div class=""> By following the above rules we can make sure that:</div><div class=""> - **admin** recognizes all the ``plugin_``&#x27;&#x27;name&#x27;&#x27; files and folder as part of a single entity.</div><div class=""> - plugins do not interfere with each other.</div><div class=""> </div><div class=""> The rules above do not solve the problem of plugin versions and dependencies. That is beyond our scope.</div><div class=""> </div><div class=""> #### Component plugins</div><div class=""> ``component plugin``:inxx</div><div class=""> </div><div class=""> Component plugins are plugins that define components. Components usually access the database and define with their own models.</div><div class=""> </div><div class=""> Here we turn the previous ``comments`` component into a ``comments_plugin`` by using the same code we wrote before, but following all of the previous rules.</div><div class=""> </div><div class=""> First, we create a model called &quot;models/plugin_comments.py&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;, label=&#x27;Your comment&#x27;),</div><div class="delete">-   Field(&#x27;posted_on&#x27;, &#x27;datetime&#x27;, default=request.now),</div><div class="delete">-   Field(&#x27;posted_by&#x27;, db.auth_user, default=auth.user_id))</div><div class="delete">-db.plugin_comments_comment.posted_on.writable=False</div><div class="delete">-db.plugin_comments_comment.posted_on.readable=False</div><div class="delete">-db.plugin_comments_comment.posted_by.writable=False</div><div class="delete"><span class="highlight">db</span>.<span class="highlight">pl</span>u<span class="highlight">gin_comments_comment.posted_by.</span>re<span class="highlight">adable=False</span></div><div class=""> </div><div class=""> def plugin_comments():</div><div class="">     return LOAD(&#x27;plugin_comments&#x27;,&#x27;post&#x27;,ajax=True)</div><div class=""> ``:code</div><div class=""> (notice the last two lines define a function that will simplify the embedding of the plugin)</div><div class=""> </div><div class=""> Second, we define a &quot;controllers/plugin_comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class="delete">-@auth.requires_login()</div><div class=""> def post():</div><div class="">     comment = db.plugin_comments_comment</div><div class="">     return dict(form=SQLFORM(comment).process(),</div><div class="">                 comments=db(comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> Third, we create a view called &quot;views/plugin_comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{for comment in comments:}}</div><div class=""> &lt;div class=&quot;comment&quot;&gt;</div><div class="delete">  on {{=comment.<span class="highlight">pos</span>ted_on}} {{=comment.<span class="highlight">pos</span>ted_by.first_name}}</div><div class="">   says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Now we can use **admin** to pack the plugin for distribution. Admin will save this plugin as:</div><div class=""> </div><div class=""> ``</div><div class=""> web2py.plugin.comments.w2p</div><div class=""> ``:code</div><div class=""> </div><div class=""> We can use the plugin in any view by simply installing the plugin via the **edit** page in **admin** and adding this to our own views</div><div class=""> </div><div class=""> ``</div><div class=""> {{=plugin_comments()}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> Of course we can make the plugin more sophisticated by having components that take parameters and configuration options. The more complex the components, the more difficult it becomes to avoid name collisions. The Plugin Manager described below is designed to avoid this problem.</div><div class=""> </div><div class=""> #### Plugin manager</div><div class=""> </div><div class=""> The ``PluginManager`` is a class defined in ``gluon.tools``. Before we explain how it works inside, we will explain how to use it.</div><div class=""> </div><div class=""> Here we consider the previous ``comments_plugin`` and we make it better. We want to be able to customize:</div><div class=""> </div><div class=""> ``</div><div class=""> db.plugin_comments_comment.body.label</div><div class=""> ``:code</div><div class=""> </div><div class=""> without having to edit the plugin code itself.</div><div class=""> </div><div class=""> Here is how we can do it:</div><div class=""> </div><div class=""> First, rewrite the plugin &quot;models/plugin_comments.py&quot; in this way:</div><div class=""> </div><div class=""> ``</div><div class="delete">-db.define_table(&#x27;plugin_comments_comment&#x27;,</div><div class="delete">-   Field(&#x27;body&#x27;,&#x27;text&#x27;,label=plugin_comments.comments.body_label),</div><div class="delete">-   Field(&#x27;posted_on&#x27;, &#x27;datetime&#x27;, default=request.now),</div><div class="delete">-   Field(&#x27;posted_by&#x27;, db.auth_user, default=auth.user_id))</div><div class="delete">-</div><div class="delete">def <span class="highlight">plugin</span>_<span class="highlight">comments</span>()<span class="highlight"></span></div><div class="">     from gluon.tools import PluginManager</div><div class="">     plugins = PluginManager(&#x27;comments&#x27;, body_label=&#x27;Your comment&#x27;)</div><div class=""> </div><div class="delete">-    comment = db.plugin_comments_comment</div><div class="delete">-    comment.label=plugins.comments.body_label</div><div class="delete">-    comment.posted_on.writable=False</div><div class="delete">-    comment.posted_on.readable=False</div><div class="delete">-    comment.posted_by.writable=False</div><div class="delete">-    comment.posted_by.readable=False</div><div class="delete">-    return LOAD(&#x27;plugin_comments&#x27;,&#x27;post.load&#x27;,ajax=True)</div><div class=""> ``:code</div><div class=""> </div><div class="delete">Notice how all the code except the table definition is encapsulated in a single function<span class="highlight"></span>. Also notice how the function creates an instance of a ``PluginManager``.</div><div class=""> </div><div class=""> Now in any other model in your app, for example in &quot;models/db.py&quot;, you can configure this plugin as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> from gluon.tools import PluginManager</div><div class=""> plugins = PluginManager()</div><div class=""> plugins.comments.body_label = T(&#x27;Post a comment&#x27;)</div><div class=""> ``:code</div><div class=""> </div><div class=""> -----</div><div class=""> The ``plugins`` object is already instantiated in the default scaffolding app in &quot;models/db.py&quot;</div><div class=""> -----</div><div class=""> </div><div class=""> The PluginManager object is a thread-level singleton Storage object of Storage objects. That means you can instantiate as many as you like within the same application but (whether they have the same name or not) they act as if there were a single PluginManager instance.</div><div class=""> </div><div class=""> In particular each plugin file can make its own PluginManager object and register itself and its default parameters with it:</div><div class=""> </div><div class=""> ``</div><div class=""> plugins = PluginManager(&#x27;name&#x27;, param1=&#x27;value&#x27;, param2=&#x27;value&#x27;)</div><div class=""> ``:code</div><div class=""> plugins.name3.param5 = &#x27;...&#x27;</div><div class=""> When the plugin is defined, the PluginManager must take arguments: the plugin name and optional named arguments which are default parameters. However, when the plugins are configured, the PluginManager constructor must take no arguments. The configuration must precede the definition of the plugin (i.e. it must be in a model file that comes first alphabetically).</div><div class=""> -----</div><div class=""> </div><div class=""> #### Layout plugins</div><div class=""> ``layout plugin``:inxx</div><div class=""> </div><div class=""> Layout plugins are simpler than component plugins because usually they do not contain code, but only views and static files. Yet you should still follow  good practice:</div><div class=""> </div><div class=""> First, create a folder called &quot;static/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/&quot; (where name is the name of your layout) and place all your static files there.</div><div class=""> </div><div class=""> Second, create a layout file called &quot;views/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/layout.html&quot; that contains your layout and links the images, CSS and JavaScript files in &quot;static/plugin_layout_&#x27;&#x27;name&#x27;&#x27;/&quot;</div><div class=""> </div><div class=""> Third, modify the &quot;views/layout.html&quot; so that it simply reads:</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;plugin_layout_name/layout.html&#x27;}}</div><div class=""> {{include}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div></div></div>
</div>
<hr />

<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/097d699dc16179206ccb7e4aee863d6523cd471c">097d699</a><ul><li>Date : 2012-12-27</li><li>fixed typo, thanks Andrew</li></ul></li></ul>
<div class="row-fluid" id="com_097d699dc16179206ccb7e4aee863d6523cd471c">
    <div class="span6"><div class="diff"><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div></div></div>
    <div class="span6"><div class="diff"><div class=""> The benefit of this design is that users of this plugin can install multiple layouts and choose which one to apply simply by editing &quot;views/layout.html&quot;. Moreover, &quot;views/layout.html&quot; will not be packed by **admin** together with the plugin, so there is no risk that the plugin will override the user&#x27;s code in the previously installed layout.</div><div class="delete">-</div></div></div>
</div>
<hr />

<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/010aa0543ab690b5d1930c4b7d8584b4eb0fa73f">010aa05</a><ul><li>Date : 2012-10-08</li><li>timeout and times LOAD options</li></ul></li></ul>
<div class="row-fluid" id="com_010aa0543ab690b5d1930c4b7d8584b4eb0fa73f">
    <div class="span6"><div class="diff"><div class=""> ## Components and plugins</div><div class=""> ``component``:inxx</div><div class=""> ``plugin``:inxx</div><div class=""> </div><div class=""> Components and plugins are relatively new features of web2py, and there is some disagreement between developers about what they are and what they should be. Most of the confusion stems from the different uses of these terms in other software projects and from the fact that developers are still working to finalize the specifications.</div><div class=""> </div><div class=""> However, plugin support is an important feature and we need to provide some definitions. These definitions are not meant to be final, just consistent with the programming patterns we want to discuss in this chapter.</div><div class=""> </div><div class=""> We will try to address two issues here:</div><div class=""> </div><div class=""> - How can we build modular applications that minimize server load and maximize code reuse?</div><div class=""> - How can we distribute pieces of code in a more or less plugin-and-play fashion?</div><div class=""> </div><div class=""> &#x27;&#x27;Components&#x27;&#x27; address the first issue; &#x27;&#x27;plugins&#x27;&#x27; address the second.</div><div class=""> </div><div class=""> ### Components</div><div class=""> ``load``:inxx</div><div class=""> ``LOAD``:inxx</div><div class=""> ``Ajax``:inxx</div><div class=""> </div><div class=""> will show the normal content and the comments component:</div><div class=""> </div><div class=""> The ``{{=LOAD(...)}}`` component is rendered as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> &lt;script type=&quot;text/javascript&quot;&gt;&lt;!--</div><div class=""> web2py_component(&quot;/test/comment/post.load&quot;,&quot;c282718984176&quot;)</div><div class=""> //--&gt;&lt;/script&gt;&lt;div id=&quot;c282718984176&quot;&gt;loading...&lt;/div&gt;</div><div class=""> ``:code</div><div class=""> </div><div class=""> (the actual generated code depends on the options passed to the LOAD function).</div><div class=""> </div><div class=""> The ``web2py_component(url,id)`` function is defined in &quot;web2py_ajax.html&quot; and it performs all the magic: it calls the ``url`` via Ajax and embeds the response into the DIV with corresponding ``id``; it traps every form submission into the DIV and submits those forms via Ajax. The Ajax target is always the DIV itself.</div><div class=""> </div><div class=""> The full signature of the LOAD helper is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> LOAD(c=None, f=&#x27;index&#x27;, args=[], vars={},</div><div class="">      extension=None, target=None,</div><div class="">      ajax=False, ajax_trap=False,</div><div class="">      url=None,user_signature=False,</div><div class="insert">+     timeout=None, times=1,</div><div class="">      content=&#x27;loading...&#x27;,**attr):</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here:</div><div class=""> - the first two arguments ``c`` and ``f`` are the controller and the function that we want to call respectively.</div><div class=""> - ``args`` and ``vars`` are the arguments and variables that we want to pass to the function. The former is a list, the latter is a dictionary.</div><div class=""> - ``extension`` is an optional extension. Notice that the extension can also be passed as part of the function as in ``f=&#x27;index.load&#x27;``.</div><div class=""> - ``target`` is the ``id`` of the target DIV. If it is not specified a random target ``id`` is generated.</div><div class=""> - ``ajax`` should be set to ``True`` if the DIV has to be filled via Ajax and to ``False`` if the DIV has to be filled before the current page is returned (thus avoiding the Ajax call).</div><div class=""> - ``ajax_trap=True`` means that any form submission in the DIV must be captured and submitted via Ajax, and the response must be rendered inside the DIV. ``ajax_trap=False`` indicates that forms must be submitted normally, thus reloading the entire page. ``ajax_trap`` is ignored and assumed to be ``True`` if ``ajax=True``.</div><div class=""> - ``url``, if specified, overrides the values of ``c``, ``f``, ``args``, ``vars``, and ``extension`` and loads the component at the ``url``. It is used to load as components pages served by other applications (which my or may not be created with web2py).</div><div class=""> - ``user_signature`` defaults to False but, if you are logged in, it should be set to True. This will make sure the ajax callback is digitally signed. This is documented in chapter 4.</div><div class="insert">+- ``times`` specifies how many times the component is to be requested. Use &quot;infinity&quot; to keep loading the component continuously. This option is useful for triggering regular routines for a given document request.</div><div class="insert">+- ``timeout`` sets the time to wait in milliseconds before starting the request or the frequency if ``times`` is greater than 1.</div><div class=""> - ``content`` is the content to be displayed while performing the ajax call. It can be a helper as in ``content=IMG(..)``.</div><div class=""> - optional ``**attr`` (attributes) can be passed to the contained ``DIV``.</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-</div><div class=""> ## Components and plugins</div><div class=""> ``component``:inxx</div><div class=""> ``plugin``:inxx</div><div class=""> </div><div class=""> Components and plugins are relatively new features of web2py, and there is some disagreement between developers about what they are and what they should be. Most of the confusion stems from the different uses of these terms in other software projects and from the fact that developers are still working to finalize the specifications.</div><div class=""> </div><div class=""> However, plugin support is an important feature and we need to provide some definitions. These definitions are not meant to be final, just consistent with the programming patterns we want to discuss in this chapter.</div><div class=""> </div><div class=""> We will try to address two issues here:</div><div class=""> </div><div class=""> - How can we build modular applications that minimize server load and maximize code reuse?</div><div class=""> - How can we distribute pieces of code in a more or less plugin-and-play fashion?</div><div class=""> </div><div class=""> &#x27;&#x27;Components&#x27;&#x27; address the first issue; &#x27;&#x27;plugins&#x27;&#x27; address the second.</div><div class=""> </div><div class=""> ### Components</div><div class=""> ``load``:inxx</div><div class=""> ``LOAD``:inxx</div><div class=""> ``Ajax``:inxx</div><div class=""> </div><div class=""> will show the normal content and the comments component:</div><div class=""> </div><div class=""> The ``{{=LOAD(...)}}`` component is rendered as follows:</div><div class=""> </div><div class=""> ``</div><div class=""> &lt;script type=&quot;text/javascript&quot;&gt;&lt;!--</div><div class=""> web2py_component(&quot;/test/comment/post.load&quot;,&quot;c282718984176&quot;)</div><div class=""> //--&gt;&lt;/script&gt;&lt;div id=&quot;c282718984176&quot;&gt;loading...&lt;/div&gt;</div><div class=""> ``:code</div><div class=""> </div><div class=""> (the actual generated code depends on the options passed to the LOAD function).</div><div class=""> </div><div class=""> The ``web2py_component(url,id)`` function is defined in &quot;web2py_ajax.html&quot; and it performs all the magic: it calls the ``url`` via Ajax and embeds the response into the DIV with corresponding ``id``; it traps every form submission into the DIV and submits those forms via Ajax. The Ajax target is always the DIV itself.</div><div class=""> </div><div class=""> The full signature of the LOAD helper is the following:</div><div class=""> </div><div class=""> ``</div><div class=""> LOAD(c=None, f=&#x27;index&#x27;, args=[], vars={},</div><div class="">      extension=None, target=None,</div><div class="">      ajax=False, ajax_trap=False,</div><div class="">      url=None,user_signature=False,</div><div class="">      content=&#x27;loading...&#x27;,**attr):</div><div class=""> ``:code</div><div class=""> </div><div class=""> Here:</div><div class=""> - the first two arguments ``c`` and ``f`` are the controller and the function that we want to call respectively.</div><div class=""> - ``args`` and ``vars`` are the arguments and variables that we want to pass to the function. The former is a list, the latter is a dictionary.</div><div class=""> - ``extension`` is an optional extension. Notice that the extension can also be passed as part of the function as in ``f=&#x27;index.load&#x27;``.</div><div class=""> - ``target`` is the ``id`` of the target DIV. If it is not specified a random target ``id`` is generated.</div><div class=""> - ``ajax`` should be set to ``True`` if the DIV has to be filled via Ajax and to ``False`` if the DIV has to be filled before the current page is returned (thus avoiding the Ajax call).</div><div class=""> - ``ajax_trap=True`` means that any form submission in the DIV must be captured and submitted via Ajax, and the response must be rendered inside the DIV. ``ajax_trap=False`` indicates that forms must be submitted normally, thus reloading the entire page. ``ajax_trap`` is ignored and assumed to be ``True`` if ``ajax=True``.</div><div class=""> - ``url``, if specified, overrides the values of ``c``, ``f``, ``args``, ``vars``, and ``extension`` and loads the component at the ``url``. It is used to load as components pages served by other applications (which my or may not be created with web2py).</div><div class=""> - ``user_signature`` defaults to False but, if you are logged in, it should be set to True. This will make sure the ajax callback is digitally signed. This is documented in chapter 4.</div><div class=""> - ``content`` is the content to be displayed while performing the ajax call. It can be a helper as in ``content=IMG(..)``.</div><div class=""> - optional ``**attr`` (attributes) can be passed to the contained ``DIV``.</div></div></div>
</div>
<hr />

<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/77e0846262922b8d1f776f23ca079114677b4048">77e0846</a><ul><li>Date : 2012-12-28</li><li>fixed comment-&gt;post</li></ul></li></ul>
<div class="row-fluid" id="com_77e0846262922b8d1f776f23ca079114677b4048">
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="insert">db.define_table(&#x27;<span class="highlight">p</span>o<span class="highlight">s</span>t&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;,label=&#x27;Your comment&#x27;),</div><div class="">    Field(&#x27;posted_on&#x27;,&#x27;datetime&#x27;,default=request.now),</div><div class="">    Field(&#x27;posted_by&#x27;,db.auth_user,default=auth.user_id))</div><div class="insert">+db.post.posted_on.writable = db.post.posted_on.readable = False</div><div class="insert">+db.post.posted_by.writable = db.post.posted_by.readable = False</div><div class=""> ``:code</div><div class=""> </div><div class=""> one action in &quot;controllers/comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="insert">+    return dict(form=SQLFORM(db.post).process(),</div><div class="insert">+                comments=db(db.post).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class="insert">+{{for post in comments:}}</div><div class="insert">+&lt;div class=&quot;post&quot;&gt;</div><div class="insert">+  on {{=post.posted_on}} {{=post.posted_by.first_name}}</div><div class="insert">+  says &lt;span class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> ``:code</div><div class=""> </div><div class=""> [[image @///image/en7900.png center 480px]]</div><div class=""> </div><div class=""> So far there is nothing special in this action, but we can turn it into a component by defining a new view with extension &quot;.load&quot; that does not extend the layout.</div><div class=""> </div><div class=""> Hence we create a &quot;views/comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{#extend &#x27;layout.html&#x27; &lt;- notice this is commented out!}}</div><div class="insert">+{{for post in comments:}}</div><div class="insert">+&lt;div class=&quot;post&quot;&gt;</div><div class="insert">+  on {{=post.posted_on}} {{=post.posted_by.first_name}}</div><div class="insert">+  says &lt;span class=&quot;post_body&quot;&gt;{{=post.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div></div></div>
    <div class="span6"><div class="diff"><div class=""> ``</div><div class="delete">db.define_table(&#x27;<span class="highlight">c</span>o<span class="highlight">mmen</span>t&#x27;,</div><div class="">    Field(&#x27;body&#x27;,&#x27;text&#x27;,label=&#x27;Your comment&#x27;),</div><div class="">    Field(&#x27;posted_on&#x27;,&#x27;datetime&#x27;,default=request.now),</div><div class="">    Field(&#x27;posted_by&#x27;,db.auth_user,default=auth.user_id))</div><div class="delete">-db.comment.posted_on.writable=db.comment.posted_on.readable=False</div><div class="delete">-db.comment.posted_by.writable=db.comment.posted_by.readable=False</div><div class=""> ``:code</div><div class=""> </div><div class=""> one action in &quot;controllers/comments.py&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> @auth.requires_login()</div><div class=""> def post():</div><div class="delete">-    return dict(form=SQLFORM(db.comment).process(),</div><div class="delete">-                comments=db(db.comment).select())</div><div class=""> ``:code</div><div class=""> </div><div class=""> and the corresponding &quot;views/comments/post.html&quot;</div><div class=""> </div><div class=""> ``</div><div class=""> {{extend &#x27;layout.html&#x27;}}</div><div class="delete">-{{for comment in comments:}}</div><div class="delete">-&lt;div class=&quot;comment&quot;&gt;</div><div class="delete">-  on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="delete">-  says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div><div class=""> </div><div class=""> You can access it as usual at:</div><div class=""> </div><div class=""> ``</div><div class=""> http://127.0.0.1:8000/test/comments/post</div><div class=""> ``:code</div><div class=""> </div><div class=""> [[image @///image/en7900.png center 480px]]</div><div class=""> </div><div class=""> So far there is nothing special in this action, but we can turn it into a component by defining a new view with extension &quot;.load&quot; that does not extend the layout.</div><div class=""> </div><div class=""> Hence we create a &quot;views/comments/post.load&quot;:</div><div class=""> </div><div class=""> ``</div><div class=""> {{#extend &#x27;layout.html&#x27; &lt;- notice this is commented out!}}</div><div class="delete">-{{for comment in comments:}}</div><div class="delete">-&lt;div class=&quot;comment&quot;&gt;</div><div class="delete">-  on {{=comment.posted_on}} {{=comment.posted_by.first_name}}</div><div class="delete">-  says &lt;span class=&quot;comment_body&quot;&gt;{{=comment.body}}&lt;/span&gt;</div><div class=""> &lt;/div&gt;</div><div class=""> {{pass}}</div><div class=""> {{=form}}</div><div class=""> ``:code</div></div></div>
</div>
<hr />

<ul><li><a href="https://github.com/mdipierro/web2py-book/commit/ac4003f4349f9ee22c67309ceeb48de5539b0308">ac4003f</a><ul><li>Date : 2012-09-01</li><li>added lots of new features to book</li></ul></li></ul>
<div class="row-fluid" id="com_ac4003f4349f9ee22c67309ceeb48de5539b0308">
    <div class="span6"><div class="diff"><div class="insert">+If you call an action via Ajax and you want the action to force a redirect of the parent page you can do it with</div><div class="insert">+</div><div class="insert">+``</div><div class="insert">+redirect(url,type=&#x27;auto&#x27;)</div><div class="insert">+``:code</div><div class="insert">+</div><div class=""> Because Ajax post does not support multipart forms, i.e. file uploads, upload fields will not work with the LOAD component. You could be fooled into thinking it would work because upload fields will function normally if POST is done from the individual component&#x27;s .load view. Instead, uploads are done with ajax-compatible 3rd-party widgets and web2py manual upload store commands.</div></div></div>
    <div class="span6"><div class="diff"><div class="delete">-*Please note:*</div><div class=""> Because Ajax post does not support multipart forms, i.e. file uploads, upload fields will not work with the LOAD component. You could be fooled into thinking it would work because upload fields will function normally if POST is done from the individual component&#x27;s .load view. Instead, uploads are done with ajax-compatible 3rd-party widgets and web2py manual upload store commands.</div></div></div>
</div>
<hr />


        
      </div>

      <div id="push"></div>
    </div>

    <div id="footer">
      <div class="container-fluid">
          <div class="copyright pull-left">Copyright &#169; 2013</div>
          <div id="poweredBy" class="pull-right">
              Powered by
              <a href="http://www.web2py.com/">web2py</a>
          </div>
      </div>
    </div>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/web2py_bootstrap.js"></script>
</body>
</html>
